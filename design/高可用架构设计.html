<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>liuxiaowei | liuxiaowei</title>
    <meta name="description" content="liuxiaowei">
    <link rel="preload stylesheet" href="/assets/style.cb03d06c.css" as="style">
    <link rel="modulepreload" href="/assets/app.467f35a9.js">
    <link rel="modulepreload" href="/assets/design_高可用架构设计.md.a2e8a8e3.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5211c0b1><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5211c0b1 data-v-8c0a9870><div class="VPNavBar has-sidebar" data-v-8c0a9870 data-v-1bbed88e><div class="container" data-v-1bbed88e><div class="VPNavBarTitle has-sidebar" data-v-1bbed88e data-v-d5925166><a class="title" href="/" data-v-d5925166><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-6db2186b><!--]--><!--[-->liuxiaowei<!--]--><!--[--><!--]--></a></div><div class="content" data-v-1bbed88e><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-1bbed88e data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://gitee.com/liuxiaowei2018" target="_blank" rel="noreferrer" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->gitee<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-1bbed88e data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-1bbed88e data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/liuxiaowei2018" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="..." target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Dribbble</title><path d="M12...6.38z"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-1bbed88e data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e4361c82><div class="item social-links" data-v-e4361c82><div class="VPSocialLinks social-links-list" data-v-e4361c82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/liuxiaowei2018" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="..." target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Dribbble</title><path d="M12...6.38z"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-1bbed88e data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-5211c0b1 data-v-b6162a8b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b6162a8b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b6162a8b><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b6162a8b>Menu</span></button><a class="top-link" href="#" data-v-b6162a8b> Return to top </a></div><aside class="VPSidebar" data-v-5211c0b1 data-v-a186aa16><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-a186aa16><span class="visually-hidden" id="sidebar-aria-label" data-v-a186aa16> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>架构设计</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/design/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>单点登录架构设计</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/design/%E7%94%B5%E5%95%86%E4%B8%9A%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>电商业务架构设计</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/design/%E8%AE%A2%E5%8D%95%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>订单系统架构设计</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/design/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>多级缓存架构设计</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/design/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%96%B9%E6%A1%88.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>分布式事务方案</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/design/%E5%88%86%E5%B8%83%E5%BC%8FID%E6%96%B9%E6%A1%88.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>分布式ID方案</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link active" href="/design/%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>高可用架构设计</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/design/%E7%81%B0%E5%BA%A6%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>灰度方案设计</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/design/%E6%8E%A5%E5%8F%A3%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>接口性能优化方案</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/design/%E6%9E%B6%E6%9E%84%E5%9B%BE%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>架构图设计方案</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/design/%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>秒杀系统架构设计</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/design/%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>日志系统架构设计</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5211c0b1 data-v-296cfad2><div class="VPDoc has-sidebar has-aside" data-v-296cfad2 data-v-cfb513e0><div class="container" data-v-cfb513e0><div class="aside" data-v-cfb513e0><div class="aside-curtain" data-v-cfb513e0></div><div class="aside-container" data-v-cfb513e0><div class="aside-content" data-v-cfb513e0><div class="VPDocAside" data-v-cfb513e0 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-cfb513e0><div class="content-container" data-v-cfb513e0><!--[--><!--]--><main class="main" data-v-cfb513e0><div style="position:relative;" class="vp-doc _design_%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1" data-v-cfb513e0><div><h2 id="高可用架构设计" tabindex="-1">高可用架构设计 <a class="header-anchor" href="#高可用架构设计" aria-hidden="true">#</a></h2><blockquote><p>大型互联网架构设计，需要考虑的点，<code>高并发</code>、<code>高性能</code>、<code>高可用</code>、<code>高扩展</code>。</p></blockquote><h3 id="一、系统拆分" tabindex="-1">一、系统拆分 <a class="header-anchor" href="#一、系统拆分" aria-hidden="true">#</a></h3><p>将一个复杂的业务域按DDD的思想拆分成若干子系统，每个子系统负责专属的业务功能，做好垂直化建设，各个子系统之间做好边界隔离，降低风险蔓延。</p><h3 id="二、解耦" tabindex="-1">二、解耦 <a class="header-anchor" href="#二、解耦" aria-hidden="true">#</a></h3><p>软件开发原则“高内聚、低耦合”。</p><p>小到<code>接口抽象</code>、<code>MVC 分层</code>，大到 <code>SOLID 原则</code>、<code>23种设计模式</code>。核心都是降低不同模块间的耦合度，避免一处错误改动影响到整个系统。</p><p>以<code>开闭原则</code>为例，对扩展是开放的，对修改是关闭的。随着业务功能迭代，如何做到每次改动不对原来的旧代码产生影响。</p><p>Spring 框架给我们提供了一个很好的思路，里面有个重要设计 <code>AOP</code> ，全称（Aspect Oriented Programming），面向切面编程。</p><p>核心就是采用动态代理技术，通过对字节码进行增强，在方法调用的时候进行拦截，以便于在方法调用前后，增加我们需要的额外处理逻辑。</p><p>还有一个重要思路就是<code>事件机制</code>，通过<code>发布订阅模式</code>，新增的需求，只需要订阅对应的<code>事件通知</code>，针对性消费即可。不会对原来的代码侵入性修改，是不是会好很多。</p><h3 id="三、异步" tabindex="-1">三、异步 <a class="header-anchor" href="#三、异步" aria-hidden="true">#</a></h3><p>同步指一个进程在执行请求的时候，若该请求需要一段时间才能返回信息，那么这个进程将会一直等待下去，直到收到返回信息才继续执行下去。</p><p>如果是非实时响应的动作可以采用异步来完成，线程不需要一直等待，而是继续执行后面的逻辑。</p><p>如：线程池（ThreadPoolExecutor）、消息队列 等都是这个原理</p><p>比如一个用户在淘宝下了一笔购物订单，关心的是订单是否创建成功，能否进行后续的付款流程</p><p>至于其他业务动作，如短信通知、邮件通知、生成订单快照、创建超时任务记录，这些非核心动作用户并不是特别关心。</p><p>我们可以采用消息队列的<code>发布/订阅</code> 机制，数据库插入订单记录后，发布一条消息到 MQ，然后就可以告知用户下单成功。</p><p>其他事情，由不同的 Task 任务订阅消息异步处理，彼此间互不干扰。</p><h3 id="四、重试" tabindex="-1">四、重试 <a class="header-anchor" href="#四、重试" aria-hidden="true">#</a></h3><p>重试主要是体现在远程的RPC调用，受 <code>网络抖动</code>、<code>线程资源阻塞</code> 等因素影响，请求无法及时响应。</p><p>为了提升用户体验，调用方可以通过 <code>重试</code> 方式再次发送请求，尝试获取结果。比过：浏览器的 F5 刷新机制就是类似道理。</p><p>接口重试是一把双刃剑，虽然客户端收到了<code>响应超时</code>结果，但是我们无法确定，服务端是否已经执行完成。如果盲目地重试，可能会带来严重后果。比如：银行转账。</p><p><code>重试</code>通常跟<code>幂等</code>组合使用，如果一个接口支持了 <code>幂等</code>，那你就可以随便重试</p><p>关于的 <code>幂等</code> 的解决方案</p><ul><li>插入前先执行查询操作，看是否存在，再决定是否插入</li><li>增加唯一索引</li><li>建防重表</li><li>引入状态机，比如付款后，订单状态调整为<code>已付款</code>，SQL 更新记录前 增加条件判断</li><li>增加分布式锁</li><li>采用 Token 机制，服务端增加 token 校验，只有第一次请求是合法的</li></ul><h3 id="五、补偿" tabindex="-1">五、补偿 <a class="header-anchor" href="#五、补偿" aria-hidden="true">#</a></h3><p>不是所有的请求都能收到成功响应。除了<code>重试</code> 机制外，还可以采用补偿玩法，实现数据<code>最终一致性</code>。</p><p>业务补偿根据处理的方向分为两部分：</p><ul><li>正向。多个操作构成一个分布式事务，如果部分成功、部分失败，我们会通过最大努力机制将<code>失败</code>的任务推进到成功状态</li><li>逆向。同上道理，我们也可以采用反向操作，将部分成功任务恢复到<code>初始状态</code></li></ul><blockquote><p>注意：补偿操作有个重要前提，业务能接受短时间内的数据不一致。</p></blockquote><p>补偿有很多的实现方式：</p><p>1、本地建表方式，存储相关数据，然后通过定时任务扫描提取，并借助反射机制触发执行</p><p>2、也可以采用简单的消息中间件，构建业务消息体，由下游的的消费任务执行。如果失败，可以借助MQ的重试机制，多次重试</p><h3 id="六、备份" tabindex="-1">六、备份 <a class="header-anchor" href="#六、备份" aria-hidden="true">#</a></h3><p>任何服务器都有宕机的可能性，一旦存储了数据，带上状态，如果发生故障，数据丢失，后果是我们无法承受的。</p><p>所以，<code>容灾备份</code>也就变成了互联网的基本能力。</p><p>如何备份，不同的框架有不用的玩法。以 Redis 为例：</p><p><img src="/assets/image-20220407140441861.692dc435.png" alt="image-20220407140441861"></p><p>Redis 借助 <code>RDB</code> 和 <code>AOF</code> 来实现两台服务器间的数据同步</p><ul><li>RDB，全量数据同步</li><li>AOF，增量数据同步，回放日志</li></ul><p>一旦主节点挂了怎么办？</p><p>这里引入哨兵机制。哨兵机制可以实现主从库的自动切换，有效解决了故障转移。整个过程分为三个阶段：监控、选主、通知。</p><p>除了 Redis 中间件外，其他常见的 MySQL、Kafka 消息中间件、HBase 、ES 等 ，凡是涉及到数据存储的介质，都有备份机制，一旦主节点挂了，会启用备份节点，保证数据不会丢失。</p><h3 id="七、多活策略" tabindex="-1">七、多活策略 <a class="header-anchor" href="#七、多活策略" aria-hidden="true">#</a></h3><p>在一些极端情况，如：机房断电、机房火灾、地震、山洪等不可抗力因素，所有的服务器都可能出现故障，无法对外提供服务，导致整体业务瘫痪。</p><p>为了降低风险，保证服务的24小时可用性，我们会采用 <code>多活策略</code>。</p><p>常见的<code>多活</code>方案有，<code>同城双活</code>、<code>两地三中心</code>、<code>三地五中心</code>、<code>异地双活</code>、<code>异地多活</code></p><h3 id="八、隔离" tabindex="-1">八、隔离 <a class="header-anchor" href="#八、隔离" aria-hidden="true">#</a></h3><p>隔离属于物理层面的分割，将若干的系统低耦合设计，独立部署，从物理上隔开。</p><p>每个子系统有自己独立的代码库，独立开发，独立发布。一旦出现故障，也不会相互干扰。当然如果不同子系统间有相互依赖，这种情况比较特殊，需要有默认值或者异常特殊处理，这属于业务层面解决方案。</p><p>隔离属于分布式技术的衍生产物，我们最常见的微服务解决方案。</p><p>将一个大型的复杂系统拆分成若干个微服务系统，这些微服务子系统通常由不同的团队开发、维护，独立部署，服务之间通过 <code>RPC</code> 远程调用。</p><p>隔离使得系统间边界更加清晰，故障可以更加隔离开来，问题的发现与解决也更加快速，系统的可用性也更高。</p><h3 id="九、限流" tabindex="-1">九、限流 <a class="header-anchor" href="#九、限流" aria-hidden="true">#</a></h3><p>高并发系统，如果遇到流量洪峰，超过了当前系统的承载能力。CPU、内存、Load负载飚的很高，最后处理不过来，所有请求都超时无法正常响应。</p><p>解决方案-<strong>限流</strong></p><p>限流定义：</p><blockquote><p>限制到达系统的并发请求数量，保证系统能够正常响应部分用户请求，而对于超过限制的流量，则通过拒绝服务的方式保证整体系统的可用性。</p></blockquote><p><strong>根据作用范围：限流分为单机版限流、分布式限流</strong></p><p>1、单机版限流</p><p>主要借助于本机内存来实现计数器，比如通过AtomicLong#incrementAndGet()，但是要注意之前不用的key定期做清理，释放内存。</p><p>纯内存实现，无需和其他节点统计汇总，性能最高。但是优点也是缺点，无法做到全局统一化的限流。</p><p>2、分布式限流</p><p>单机版限流仅能保护自身节点，但无法保护应用依赖的各种服务，并且在进行节点扩容、缩容时也无法准确控制整个服务的请求限制。而分布式限流，以集群为维度，可以方便的控制这个集群的请求限制，从而保护下游依赖的各种服务资源。</p><p><strong>限流支持多个维度：</strong></p><ul><li>整个系统一定时间内（比如每分钟）处理多少请求</li><li>单个接口一定时间内处理多少流量</li><li>单个IP、城市、渠道、设备id、用户id等在一定时间内发送的请求数</li><li>如果是开放平台，则为每个appkey设置独立的访问速率规则</li></ul><p><strong>常见的限流算法：</strong></p><ul><li>计数器限流</li><li>滑动窗口限流</li><li>漏桶限流</li><li>令牌桶限流</li></ul><h3 id="十、熔断" tabindex="-1">十、熔断 <a class="header-anchor" href="#十、熔断" aria-hidden="true">#</a></h3><p>熔断，其实是对调用链路中某个资源出现不稳定状态时（如：调用超时或异常比例升高），对这个资源的调用进行限制，让请求快速失败，避免影响到其它的资源而导致级联错误。</p><p>熔断的主要方式是使用断路器阻断对故障服务器的调用</p><p>断路器有三种状态，关闭、打开、半打开。</p><p><img src="/assets/image-20220407140708992.42a9a6ee.png" alt="image-20220407140708992"></p><p>1、关闭（Closed）状态：在这个状态下，请求都会被转发给后端服务。同时会记录请求失败的次数，当请求失败次数在一段时间超过一定次数就会进入打开状态。</p><p>2、打开（Open）状态：在这个状态下，熔断器会直接拒绝请求，返回错误，而不去调用后端服务。同时，会有一个定时器，时间到的时候会变成半打开状态。目的是假设服务会在一段时间内恢复正常。</p><p>3、半打开（Half Open）状态：在这个状态下，熔断器会尝试把部分请求转发给后端服务，目的是为了探测后端服务是否恢复。如果请求失败会进入打开状态，成功情况下会进入关闭状态，同时重置计数。</p><p>目前，市面流行的解决方案是阿里的开源框架 <code>Sentinel</code>，提供了Dashboard控制台用于定义资源以及规则配置</p><h3 id="十一、降级" tabindex="-1">十一、降级 <a class="header-anchor" href="#十一、降级" aria-hidden="true">#</a></h3><p><strong>降级是通过暂时关闭某些非核心服务或者组件从而保护核心系统的可用性。</strong></p><p>降级是系统保护的一种重要手段。使<code>有限资源</code>发挥最大价值，临时关闭一些非核心功能，减轻系统压力，并将有限资源留给核心业务。</p><p>比如电商大促，业务在峰值时刻，系统抵挡不住全部的流量时，系统的负载、CPU 的使用率都超过了预警水位，可以对一些非核心的功能进行降级，降低系统压力，比如把<code>商品评价</code>、<code>成交记录</code>等功能临时关掉。弃车保帅，保证 <code>创建订单</code>、<code>订单支付</code> 等核心功能的正常使用。</p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-cfb513e0 data-v-21f75714><!----><div class="prev-next" data-v-21f75714><div class="pager" data-v-21f75714><a class="pager-link prev" href="/design/%E5%88%86%E5%B8%83%E5%BC%8FID%E6%96%B9%E6%A1%88.html" data-v-21f75714><span class="desc" data-v-21f75714>Previous page</span><span class="title" data-v-21f75714>分布式ID方案</span></a></div><div class="has-prev pager" data-v-21f75714><a class="pager-link next" href="/design/%E7%81%B0%E5%BA%A6%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.html" data-v-21f75714><span class="desc" data-v-21f75714>Next page</span><span class="title" data-v-21f75714>灰度方案设计</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"book0002_04演进-消息队列_17-消息队列：秒杀如何处理每秒上万的下单请求？.md\":\"24f96a32\",\"book0002_05演进-分布式服务_23-rpc框架：10万qps下如何实现毫秒级的服务调用？.md\":\"f841844f\",\"book0002_01基础_05-系统设计目标（三）：如何让系统易于扩展？.md\":\"88268f05\",\"book0002_02演进-数据库_07-池化技术：如何减少频繁创建数据库连接的性能损耗？.md\":\"51257ed7\",\"book0002_00开篇_00-开篇词-为什么你要学习高并发系统设计？.md\":\"ac815b6f\",\"book0002_02演进-数据库_08-数据库优化方案（一）：查询请求增加时，如何做主从分离？.md\":\"d7f2261b\",\"design_灰度方案设计.md\":\"c91f4aa1\",\"book0002_05演进-分布式服务_24-注册中心：分布式系统如何寻址？.md\":\"8ca6a0da\",\"book0002_03演进-缓存_12-缓存：数据库成为瓶颈后，动态数据的查询要如何加速？.md\":\"854f8e33\",\"book0002_04演进-消息队列_18-消息投递：如何保证消息仅仅被消费一次？.md\":\"62691ff9\",\"book0002_05演进-分布式服务_28-多机房部署：跨地域的分布式系统如何做？.md\":\"f02dff08\",\"book0001_线上问题详解.md\":\"4320f2d7\",\"index.md\":\"1291ea6e\",\"second_cloud_spring_springcloudstream.md\":\"11b89ff2\",\"book0002_03演进-缓存_13-缓存的使用姿势（一）：如何选择缓存的读写策略？.md\":\"c0dadcb8\",\"second_mq_kafka.md\":\"101e5bd5\",\"book0002_05演进-分布式服务_29-service mesh：如何屏蔽服务化系统的服务治理细节？.md\":\"f8d79986\",\"design_高可用架构设计.md\":\"a2e8a8e3\",\"book0002_07实战_38-计数系统设计（二）：50万qps下如何设计未读数系统？.md\":\"e53a1291\",\"book0002_01基础_03-系统设计目标（一）：如何提升系统性能？.md\":\"f21717d6\",\"study_database_clickhouse.md\":\"b336ba9c\",\"book0002_01基础_01-高并发系统：它的通用设计方法是什么？.md\":\"cd6383ce\",\"second_flow_compileflow.md\":\"0154d8c1\",\"design_秒杀系统架构设计.md\":\"c7162221\",\"second_standard_p3c.md\":\"8fca9310\",\"book0002_08结束_结束语-学不可以已.md\":\"b0482458\",\"design_分布式id方案.md\":\"095c1928\",\"study_database_postgresql.md\":\"68f919c2\",\"book0002_02演进-数据库_09-数据库优化方案（二）：写入数据量增加时，如何实现分库分表？.md\":\"66090a93\",\"second_flow_liteflow.md\":\"970d2464\",\"design_订单系统架构设计.md\":\"37b0f88b\",\"book0002_05演进-分布式服务_22-微服务架构：微服务化后系统架构要如何改造？.md\":\"a49d9fb7\",\"book0002_05演进-分布式服务_26-负载均衡：怎样提升系统的横向扩展能力？.md\":\"d58eaf46\",\"study_algorithm_队列与栈.md\":\"e3696f54\",\"design_单点登录架构设计.md\":\"06029fcf\",\"book0002_06演进-维护_33-配置管理：成千上万的配置项要如何管理？.md\":\"697a3943\",\"book0002_07实战_40-信息流设计（二）：通用信息流系统的拉模式要如何做？.md\":\"e3987c21\",\"book0002_03演进-缓存_15-缓存的使用姿势（三）：缓存穿透了怎么办？.md\":\"9437b19d\",\"second_server_nginx.md\":\"9d072cd0\",\"book0002_06演进-维护_34-降级熔断：如何屏蔽非核心系统故障的影响？.md\":\"3d8ce79c\",\"book0002_06演进-维护_30-给系统加上眼睛：服务端监控要怎么做？.md\":\"f4cea8ac\",\"study_database_mongodb.md\":\"5bcdb4f2\",\"second_test_apachejmeter.md\":\"42202fa3\",\"second_cloud_spring_skywalking.md\":\"ba8996f6\",\"book0002_06演进-维护_32-压力测试：怎样设计全链路压力测试平台？.md\":\"ba495994\",\"book0002_02演进-数据库_10-发号器：如何保证分库分表后id的全局唯一性？.md\":\"61b6e855\",\"book0002_04演进-消息队列_20-当问到项目经历时，面试官究竟想要了解什么？.md\":\"4ca2ec3b\",\"book0002_03演进-缓存_16-cdn：静态资源如何加速？.md\":\"7cdc9e9f\",\"book0002_05演进-分布式服务_21-系统架构：每秒1万次请求的系统要做服务化拆分吗？.md\":\"0183563e\",\"book0002_04演进-消息队列_19-消息队列如何降低消息队列系统中消息的延迟？.md\":\"e4983700\",\"study_algorithm_数据结构设计.md\":\"56c5bcd6\",\"second_test_testablemock.md\":\"0c7e557f\",\"catalogue_index.md\":\"16a31a06\",\"second_test_jmh.md\":\"e294de45\",\"second_cloud_spring_hystrix.md\":\"bf0eff90\",\"study_alibaba_index.md\":\"2c7f002e\",\"second_cloud_alibaba_zookeeper.md\":\"d755f86d\",\"design_日志系统架构设计.md\":\"030a9987\",\"book0002_02演进-数据库_11-nosql：在高并发场景下，数据库和nosql如何做到互补？.md\":\"1be9ab3d\",\"second_server_tomcat.md\":\"27625349\",\"book0002_05演进-分布式服务_27-api网关：系统的门面要如何做呢？.md\":\"510f4107\",\"study_springcloud_index.md\":\"bf8fc74d\",\"book0003_如何设计一个秒杀系统-许令波.md\":\"c75fe870\",\"study_database_oracle.md\":\"17373dd1\",\"book0002_06演进-维护_35-流量控制：高并发系统中我们如何操纵流量？.md\":\"db4760eb\",\"study_database_memcached.md\":\"d225d529\",\"book0002_07实战_39-信息流设计（一）：通用信息流系统的推模式要如何做？.md\":\"af697f3b\",\"second_cloud_spring_springcloudgateway.md\":\"57e72a03\",\"study_orm_jpa.md\":\"993f9fde\",\"book0002_01基础_04-系统设计目标（二）：系统怎样做到高可用？.md\":\"01241333\",\"design_电商业务架构设计.md\":\"92d6a56d\",\"second_server_linux.md\":\"e6476a7c\",\"study_middleware_flow.md\":\"1ee7e386\",\"study_util_asynctool.md\":\"73f2f8c7\",\"study_middleware_server.md\":\"627edb6e\",\"book0002_01基础_02-架构分层：我们为什么一定要这么做？.md\":\"262ab58b\",\"book0002_03演进-缓存_14-缓存的使用姿势（二）：缓存如何做到高可用？.md\":\"9582697d\",\"study_bigdata_index.md\":\"57f86f5d\",\"study_middleware_canal.md\":\"428aab8f\",\"book0002_03演进-缓存_加餐-数据的签约应该如何做？.md\":\"f4acf726\",\"study_framework_springboot.md\":\"eaa0f737\",\"design_分布式事务方案.md\":\"97c8720e\",\"book0002_06演进-维护_31-应用性能管理：用户的使用体验应该如何监控？.md\":\"b9430a58\",\"second_cloud_alibaba_seata.md\":\"92f1824b\",\"second_mq_rabbitmq.md\":\"687486b8\",\"second_standard_checkstyle.md\":\"cda64564\",\"second_cloud_alibaba_nacos.md\":\"e47ef239\",\"study_orm_mybatisplus.md\":\"111c317d\",\"second_standard_sonarlint.md\":\"a14dabca\",\"design_index.md\":\"f85f8519\",\"book0002_05演进-分布式服务_25-分布式trace：横跨几十个分布式组件的慢请求要如何排查？.md\":\"4f73935b\",\"navigation_voice.md\":\"48122795\",\"study_database_fastdfs.md\":\"c63b4674\",\"study_algorithm_二叉树.md\":\"74171616\",\"study_middleware_mq.md\":\"9c708785\",\"second_cloud_alibaba_sentinel.md\":\"34203a78\",\"book0002_07实战_37-计数系统设计（一）：面对海量数据的计数器要如何做？.md\":\"3c1b4261\",\"study_database_hbase.md\":\"adf62f45\",\"design_接口性能优化方案.md\":\"3a8f98ac\",\"study_algorithm_数组与链表.md\":\"0ca9bebe\",\"study_middleware_satoken.md\":\"a9c45141\",\"second_test_mockito.md\":\"bbf922d4\",\"study_database_mysqlextend.md\":\"0cccd61d\",\"study_test_index.md\":\"f7cec1c6\",\"second_test_charles.md\":\"e60a2eed\",\"study_util_forest.md\":\"ec13a034\",\"study_java_java8新特性.md\":\"d1383fb9\",\"study_database_elasticsearch.md\":\"bb63a185\",\"second_server_openresty.md\":\"44e797bb\",\"design_架构图设计方案.md\":\"71949d89\",\"study_container_k8s.md\":\"0dc5b079\",\"second_cloud_alibaba_dubbo.md\":\"eeb37350\",\"study_util_feilong.md\":\"9b737c08\",\"study_util_tlog.md\":\"ca483b6f\",\"second_cloud_spring_openfeign.md\":\"76319fb4\",\"study_container_docker.md\":\"d2e5e652\",\"updated_index.md\":\"5d9a5de9\",\"study_algorithm_动态规划.md\":\"0f8d7184\",\"study_middleware_shardingjdbc.md\":\"e89b5cfc\",\"study_util_vavr.md\":\"228bb0f3\",\"design_多级缓存架构设计.md\":\"fc4d26f2\",\"study_util_mapstruct.md\":\"538d4e27\",\"study_database_redis.md\":\"72e8d6af\",\"study_util_swagger.md\":\"84148050\",\"study_util_guava.md\":\"8580e86d\",\"second_standard_ide.md\":\"ec3905f7\",\"second_mq_rocketmq.md\":\"a7bf28ef\",\"study_util_easyexcel.md\":\"c8db27bb\",\"study_java_java响应式编程.md\":\"33639322\",\"study_orm_mybatis.md\":\"509cd9a4\",\"study_orm_druid.md\":\"48687664\",\"study_database_mysql.md\":\"ddd18639\",\"study_util_hutool.md\":\"6e4f4b51\",\"second_server_netty.md\":\"03eefb15\",\"study_java_jvm.md\":\"c51125c8\",\"study_java_java基础.md\":\"a1c6be49\",\"study_framework_spring.md\":\"58ef2b3d\",\"study_java_juc.md\":\"82b29de8\"}")</script>
    <script type="module" async src="/assets/app.467f35a9.js"></script>
    
  </body>
</html>