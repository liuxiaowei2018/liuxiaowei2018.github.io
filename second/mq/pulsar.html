<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pulsar | 某不知名小开发</title>
    <meta name="description" content="在线文档">
    <link rel="preload stylesheet" href="/assets/style.edc773f7.css" as="style">
    
    <script type="module" src="/assets/app.562b944e.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.8048b864.js">
    <link rel="modulepreload" href="/assets/chunks/theme.0499af2d.js">
    <link rel="modulepreload" href="/assets/second_mq_pulsar.md.0577889b.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5a346dfe><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5a346dfe data-v-ae24b3ad><div class="VPNavBar has-sidebar" data-v-ae24b3ad data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle has-sidebar" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/" data-v-86d1bed8><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-8426fc1a><!--]--><!--[-->TheWe1<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="VPNavBarSearch search" data-v-a0fd61f4><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/updated/index.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>更新日志</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>大数据</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/bigdata/path.html" data-v-43f1e123><!--[-->大数据学习路线<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/bigdata/layering.html" data-v-43f1e123><!--[-->数仓分层设计架构<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>算法</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/alg/structure/index.html" data-v-43f1e123><!--[-->数据结构<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/alg/algorithm/index.html" data-v-43f1e123><!--[-->算法提升<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://doocs.github.io/leetcode/#/lcof2/README" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->剑指Offer<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://doocs.github.io/leetcode/#/" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->LeetCode<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>经验</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/problem/index.html" data-v-43f1e123><!--[-->生产问题排查<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/optimize/index.html" data-v-43f1e123><!--[-->生产性能优化<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/shorthand/index.html" data-v-43f1e123><!--[-->开发过程速记<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/utils/index.html" data-v-43f1e123><!--[-->常用工具类库<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/ide/index.html" data-v-43f1e123><!--[-->常用开发工具<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>文献</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/books/book0001/index.html" data-v-43f1e123><!--[-->如何设计一个秒杀系统<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/books/book0002/00%E5%BC%80%E7%AF%87/index.html" data-v-43f1e123><!--[-->高并发系统设计40问<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/books/book0003/index.html" data-v-43f1e123><!--[-->DDD领域驱动设计<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-e6aabb21 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a0fd61f4 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/liuxiaowei2018" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/liuxiaowei2018" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-5a346dfe data-v-79c8c1df><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-79c8c1df><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-79c8c1df><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-79c8c1df>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-5a346dfe data-v-b00e2fdd><div class="curtain" data-v-b00e2fdd></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-b00e2fdd><span class="visually-hidden" id="sidebar-aria-label" data-v-b00e2fdd> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 has-active" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>消息中间件</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/second/mq/rabbitMQ.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>rabbitMQ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/second/mq/rocketMQ.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>rocketMQ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/second/mq/kafka.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>kafka</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/second/mq/pulsar.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>pluar</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5a346dfe data-v-669faec9><div class="VPDoc has-sidebar has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-d330b1bb><div class="content" data-v-d330b1bb><div class="outline-marker" data-v-d330b1bb></div><div class="outline-title" role="heading" aria-level="2" data-v-d330b1bb>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-d330b1bb><span class="visually-hidden" id="doc-outline-aria-label" data-v-d330b1bb> Table of Contents for current page </span><ul class="root" data-v-d330b1bb data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _second_mq_pulsar" data-v-6b87e69f><div><h1 id="pulsar" tabindex="-1">Pulsar <a class="header-anchor" href="#pulsar" aria-label="Permalink to &quot;Pulsar&quot;">​</a></h1><nav class="table-of-contents"><ul><li><a href="#_1、pulsar应用">1、Pulsar应用</a><ul><li><a href="#集成-started">集成 started</a></li><li><a href="#生产-practice">生产 practice</a></li></ul></li><li><a href="#_2、pular扩展">2、Pular扩展</a><ul><li><a href="#组件">组件</a></li><li><a href="#架构">架构</a></li><li><a href="#核心概念">核心概念</a></li></ul></li></ul></nav><p>Pulsar 是基于云原生基础架构设计的一款消息队列，是Apache 软件基金会顶级项目。拥有诸多云原生应用特性，如无状态计算层、计算与存储分离，可以很好地利用云的弹性（伸缩能力），保证具有足够的可扩容性和容错性，能够很好地在容器化环境中运行。</p><h2 id="_1、pulsar应用" tabindex="-1">1、Pulsar应用 <a class="header-anchor" href="#_1、pulsar应用" aria-label="Permalink to &quot;1、Pulsar应用&quot;">​</a></h2><h3 id="集成-started" tabindex="-1">集成 started <a class="header-anchor" href="#集成-started" aria-label="Permalink to &quot;集成 started&quot;">​</a></h3><p><code>maven</code></p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;  </span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;org.apache.pulsar&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;  </span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;pulsar-client&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;  </span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">&gt;3.0.0&lt;/</span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">&gt;  </span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;  </span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;org.apache.pulsar&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;  </span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;pulsar-client&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;  </span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;3.0.0&lt;/</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;  </span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>实例化一个<code>PulsarClient</code>对象，只需要为pulsar集群提供一个URL，如下所示:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">PulsarClient client </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PulsarClient.</span><span style="color:#B392F0;">builder</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">serviceUrl</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;pulsar://localhost:6650&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">PulsarClient client </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PulsarClient.</span><span style="color:#6F42C1;">builder</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">serviceUrl</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;pulsar://localhost:6650&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">build</span><span style="color:#24292E;">();</span></span></code></pre></div><p>有多个代理，启动如下:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">PulsarClient client </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PulsarClient.</span><span style="color:#B392F0;">builder</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">serviceUrl</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;pulsar://localhost:6650,localhost:6651,localhost:6652&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">PulsarClient client </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PulsarClient.</span><span style="color:#6F42C1;">builder</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">serviceUrl</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;pulsar://localhost:6650,localhost:6651,localhost:6652&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">build</span><span style="color:#24292E;">();</span></span></code></pre></div><p><code>producer</code></p><p>实例化PulsarClient对象之后，就可以为特定的<code>topic</code>创建一个<code>Producer</code>。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">java复制代码Producer</span><span style="color:#F97583;">&lt;byte</span><span style="color:#E1E4E8;">[]</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> producer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> client.</span><span style="color:#B392F0;">newProducer</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-topic&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">();  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#6A737D;">// You can then send messages to the broker and topic you specified:  </span></span>
<span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;My message&quot;</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getBytes</span><span style="color:#E1E4E8;">());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">java复制代码Producer</span><span style="color:#D73A49;">&lt;byte</span><span style="color:#24292E;">[]</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> producer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> client.</span><span style="color:#6F42C1;">newProducer</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-topic&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">();  </span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;">// You can then send messages to the broker and topic you specified:  </span></span>
<span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;My message&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">());</span></span></code></pre></div><blockquote><p>默认情况下，producer生成由字节数组组成的消息。您可以通过指定消息模式来生成不同的类型，后面会详细介绍schema的定义。</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 指定消息类型为String</span></span>
<span class="line"><span style="color:#E1E4E8;">Producer&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">&gt; stringProducer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> client.</span><span style="color:#B392F0;">newProducer</span><span style="color:#E1E4E8;">(Schema.STRING)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-topic&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">();  </span></span>
<span class="line"><span style="color:#E1E4E8;">stringProducer.</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;My message&quot;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 指定消息类型为String</span></span>
<span class="line"><span style="color:#24292E;">Producer&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; stringProducer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> client.</span><span style="color:#6F42C1;">newProducer</span><span style="color:#24292E;">(Schema.STRING)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-topic&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">();  </span></span>
<span class="line"><span style="color:#24292E;">stringProducer.</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;My message&quot;</span><span style="color:#24292E;">);</span></span></code></pre></div><p>如果不需要时，请确保关闭他们。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">client.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//也可以异步关闭</span></span>
<span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">closeAsync</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">thenRun</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Producer closed&quot;</span><span style="color:#E1E4E8;">))  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">exceptionally</span><span style="color:#E1E4E8;">((ex) </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> {  </span></span>
<span class="line"><span style="color:#E1E4E8;">System.err.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Failed to close producer: &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> ex);  </span></span>
<span class="line"><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;  </span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//也可以异步关闭</span></span>
<span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">closeAsync</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">thenRun</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Producer closed&quot;</span><span style="color:#24292E;">))  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">exceptionally</span><span style="color:#24292E;">((ex) </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> {  </span></span>
<span class="line"><span style="color:#24292E;">System.err.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Failed to close producer: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> ex);  </span></span>
<span class="line"><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;  </span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p><code>consumer</code></p><p>在Pulsar中，消费者订阅主题并处理生产者发布到这些主题的消息。您可以通过首先实例化PulsarClient对象并创建一个新的消费者。</p><p>在实例化了PulsarClient对象之后，可以通过指定主题和订阅名来创建Consumer。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Consumer consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> client.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-topic&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-subscription&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Consumer consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> client.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-topic&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-subscription&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span></code></pre></div><p><code>subscribe</code>将自动订阅消费者指定的<code>topic</code>。可以设置一个while循环来持续监听消息。在下面这个示例中，打印counser接收到的任何消息的内容，然后确认消息已被处理（<code>acknowledgment</code>）。如果处理逻辑失败，您可以使用<code>negative acknowledgment</code>稍后重新传递消息</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">while</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">) {  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Wait for a message  </span></span>
<span class="line"><span style="color:#E1E4E8;">    Message msg </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> consumer.</span><span style="color:#B392F0;">receive</span><span style="color:#E1E4E8;">();  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {  </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Do something with the message  </span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Message received: &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">(msg.</span><span style="color:#B392F0;">getData</span><span style="color:#E1E4E8;">()));  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Acknowledge the message  </span></span>
<span class="line"><span style="color:#E1E4E8;">        consumer.</span><span style="color:#B392F0;">acknowledge</span><span style="color:#E1E4E8;">(msg);  </span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (Exception </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {  </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Message failed to process, redeliver later  </span></span>
<span class="line"><span style="color:#E1E4E8;">        consumer.</span><span style="color:#B392F0;">negativeAcknowledge</span><span style="color:#E1E4E8;">(msg);  </span></span>
<span class="line"><span style="color:#E1E4E8;">    }  </span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">) {  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Wait for a message  </span></span>
<span class="line"><span style="color:#24292E;">    Message msg </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> consumer.</span><span style="color:#6F42C1;">receive</span><span style="color:#24292E;">();  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {  </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Do something with the message  </span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Message received: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">String</span><span style="color:#24292E;">(msg.</span><span style="color:#6F42C1;">getData</span><span style="color:#24292E;">()));  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Acknowledge the message  </span></span>
<span class="line"><span style="color:#24292E;">        consumer.</span><span style="color:#6F42C1;">acknowledge</span><span style="color:#24292E;">(msg);  </span></span>
<span class="line"><span style="color:#24292E;">    } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Exception </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {  </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Message failed to process, redeliver later  </span></span>
<span class="line"><span style="color:#24292E;">        consumer.</span><span style="color:#6F42C1;">negativeAcknowledge</span><span style="color:#24292E;">(msg);  </span></span>
<span class="line"><span style="color:#24292E;">    }  </span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>如果不想阻塞主线程，但又不断地监听新消息，可以考虑使用<code>MessageListener</code>。<code>MessageListener</code>使用客户机内部的线程池。您可以在ClientBuilder中设置消息侦听器的线程数。<strong>MessageListener将使用PulsarClient内部的线程池</strong>。您可以在ClientBuilder中设置用于消息侦听器的线程数。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">MessageListener myMessageListener </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (consumer, msg) </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> {  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {  </span></span>
<span class="line"><span style="color:#E1E4E8;">        System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Message received: &quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">(msg.</span><span style="color:#B392F0;">getData</span><span style="color:#E1E4E8;">()));  </span></span>
<span class="line"><span style="color:#E1E4E8;">        consumer.</span><span style="color:#B392F0;">acknowledge</span><span style="color:#E1E4E8;">(msg);  </span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (Exception </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {  </span></span>
<span class="line"><span style="color:#E1E4E8;">        consumer.</span><span style="color:#B392F0;">negativeAcknowledge</span><span style="color:#E1E4E8;">(msg);  </span></span>
<span class="line"><span style="color:#E1E4E8;">    }  </span></span>
<span class="line"><span style="color:#E1E4E8;">}  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">Consumer consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> client.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-topic&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-subscription&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">messageListener</span><span style="color:#E1E4E8;">(myMessageListener)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">MessageListener myMessageListener </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (consumer, msg) </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> {  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {  </span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Message received: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">String</span><span style="color:#24292E;">(msg.</span><span style="color:#6F42C1;">getData</span><span style="color:#24292E;">()));  </span></span>
<span class="line"><span style="color:#24292E;">        consumer.</span><span style="color:#6F42C1;">acknowledge</span><span style="color:#24292E;">(msg);  </span></span>
<span class="line"><span style="color:#24292E;">    } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Exception </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {  </span></span>
<span class="line"><span style="color:#24292E;">        consumer.</span><span style="color:#6F42C1;">negativeAcknowledge</span><span style="color:#24292E;">(msg);  </span></span>
<span class="line"><span style="color:#24292E;">    }  </span></span>
<span class="line"><span style="color:#24292E;">}  </span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">Consumer consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> client.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-topic&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-subscription&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">messageListener</span><span style="color:#24292E;">(myMessageListener)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span></code></pre></div><p><code>reader</code></p><p>通过<code>reader</code>接口，pulsar客户端可以在主题中“手动定位”自己，并从指定的消息中读取所有消息。Java的Pulsar API允许您通过指定主题和<code>MessageId</code>来创建Reader对象。</p><p>示例如下:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// Some message ID byte array  </span></span>
<span class="line"><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[] msgIdBytes </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> MessageId id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> MessageId.</span><span style="color:#B392F0;">fromByteArray</span><span style="color:#E1E4E8;">(msgIdBytes);  </span></span>
<span class="line"><span style="color:#E1E4E8;">Reader reader </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newReader</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(topic)  </span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">startMessageId</span><span style="color:#E1E4E8;">(id)  </span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">();  </span></span>
<span class="line"><span style="color:#F97583;">while</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">) {  </span></span>
<span class="line"><span style="color:#E1E4E8;">    Message message </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> reader.</span><span style="color:#B392F0;">readNext</span><span style="color:#E1E4E8;">();  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Process message  </span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// Some message ID byte array  </span></span>
<span class="line"><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[] msgIdBytes </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> MessageId id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> MessageId.</span><span style="color:#6F42C1;">fromByteArray</span><span style="color:#24292E;">(msgIdBytes);  </span></span>
<span class="line"><span style="color:#24292E;">Reader reader </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newReader</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(topic)  </span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">startMessageId</span><span style="color:#24292E;">(id)  </span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">();  </span></span>
<span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">) {  </span></span>
<span class="line"><span style="color:#24292E;">    Message message </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> reader.</span><span style="color:#6F42C1;">readNext</span><span style="color:#24292E;">();  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Process message  </span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>在上面的例子中，为特定的Topic(按message ID)实例化了一个Reader对象,<code>reader</code>遍历主题中的每条消息(如何获得该值取决于应用程序)。 也可以使用<code>MessageId.earliest</code>指向关于MessageId主题的最早可用消息。<code>MessageId.latest</code>指向最近可用的消息。一般通过Reader进行消息的重放.</p><h3 id="生产-practice" tabindex="-1">生产 practice <a class="header-anchor" href="#生产-practice" aria-label="Permalink to &quot;生产 practice&quot;">​</a></h3><p><img src="/assets/image-20230629154338999.0dc5649d.png" alt="image-20230629154338999"></p><h2 id="_2、pular扩展" tabindex="-1">2、Pular扩展 <a class="header-anchor" href="#_2、pular扩展" aria-label="Permalink to &quot;2、Pular扩展&quot;">​</a></h2><h3 id="组件" tabindex="-1">组件 <a class="header-anchor" href="#组件" aria-label="Permalink to &quot;组件&quot;">​</a></h3><p><img src="/assets/image-20230629144107222.d2dd0161.png" alt="image-20230629144107222"></p><p>在一个Pulsar集群中：</p><p>单个Pulsar集群由以下三部分组成：</p><ul><li><code>Broker</code>：无状态服务层，负责接收和传递消息，集群负载均衡等工作，Broker 不会持久化保存元数据，因此可以快速的上、下线。</li><li><code>BookKeeper</code>：有状态持久层，由一组名为 Bookie 的存储节点组成，持久化地存储消息。</li><li><code>zookeeper</code>集群，用来处理Pulsar集群之间的协调任务，并存储broker和bookie的元数据。</li></ul><p>与传统的消息系统相比，Apache Pulsar 在架构设计上采用了计算与存储分离的模式，Pub/Sub 相关的计算逻辑在 Broker 上完成，数据存储在 Apache BookKeeper 的 Bookie 节点上。</p><h4 id="brokers" tabindex="-1">Brokers <a class="header-anchor" href="#brokers" aria-label="Permalink to &quot;Brokers&quot;">​</a></h4><p>Pulsar的broker是一个<strong>无状态组件</strong>, 主要由两个组件组成:</p><ul><li>一个HTTP服务器 <code>service discovery</code>，提供REST API用于管理任务和生产者、消费者的主题查找。生产者连接到代理以发布消息，消费者连接到代理以消费消息。</li><li>一个调度程序 <code>dispatcher</code>，它是一个基于自定义二进制协议的异步TCP服务器，用于所有数据传输。</li></ul><p>消息通常从<code>Managed Ledger</code>缓存中读取，除非读取的数据超过缓存大小，则从BookKeeper那里读取<code>Entries</code>(Entry是BookKeeper中的一条记录)</p><p>为了支持全局Topic异地复制，Broker会控制Replicators追踪本地发布的Entries，并把这些Entries用Java客户端重新发布到其他区域.</p><h4 id="zookeeper" tabindex="-1">Zookeeper <a class="header-anchor" href="#zookeeper" aria-label="Permalink to &quot;Zookeeper&quot;">​</a></h4><p>Pulsar使用<code>Apache ZooKeeper</code>来进行元数据存储、集群配置和协调。元数据包括主题元数据、模式（schema）、代理负载数据等。Pulsar元数据存储可以部署在单独的ZooKeeper集群上，也可以部署在现有的ZooKeeper集群上。</p><p>Pulsar还支持其他元数据后端服务，包括etcd和RocksDB（仅适用于独立部署的Pulsar）。</p><p>在一个Pulsar实例中：</p><ul><li>配置存储: 存储租户，命名域和其他需要全局一致的配置项</li><li>每个集群有自己独立的ZooKeeper保存集群内部配置和协调信息，例如归属信息、broker负载报告、BookKeeper ledger信息</li></ul><h4 id="bookeeper" tabindex="-1">Bookeeper <a class="header-anchor" href="#bookeeper" aria-label="Permalink to &quot;Bookeeper&quot;">​</a></h4><p>Pulsar使用一个名为Apache BookKeeper的系统来进行持久消息存储。BookKeeper是一个<strong>分布式的预写日志</strong>（Write-Ahead Log，WAL）系统，为Pulsar提供了一些重要的优势：</p><ul><li>独立的分布式日志文件，称为账本（<code>ledgers</code>）。可以随着时间的推移为主题创建多个账本。</li><li>非常高效的<strong>有序存储</strong>，在各种系统故障的情况下，可以处理<code>entry</code>（条目）数据复制。</li><li>读取一致性。</li><li>均匀分配I/O。</li><li><strong>水平可扩展性</strong>。通过向集群添加更多的书记（bookie），可以立即增加容量。</li><li>Bookies被设计成可以承载数千的并发读写的ledgers，且读写IO分离。 使用多个磁盘设备(一个用于日志，另一个用于一般存储))，这样Bookies<strong>可以将读操作的影响和对于写操作的延迟分隔开</strong>。</li><li>除了消息数据，游标（Cursors）也被持久地存储在BookKeeper中。游标是消费者的订阅位置。BookKeeper使得Pulsar能够以可扩展的方式存储消费者的位置。</li></ul><h5 id="ledgers" tabindex="-1">ledgers <a class="header-anchor" href="#ledgers" aria-label="Permalink to &quot;ledgers&quot;">​</a></h5><p>账本（Ledger）是一种只追加的数据结构，单进程写入，分配给多个BookKeeper存储节点（也称为bookie）。<code>Ledger entries</code>被复制到多个bookie上。Ledger本身具有非常简单的语义：</p><ul><li>Pulsar代理可以创建Ledger，向账本追加entry，并关闭账本。</li><li>在Ledger关闭后（无论是显式关闭还是因写入进程崩溃），只能以只读模式打开Ledger。</li><li>当ledger中的Entry不再有用的时候，可以将整个账本从系统中删除（跨所有bookie）。</li></ul><h5 id="managed-ledgers" tabindex="-1">Managed ledgers <a class="header-anchor" href="#managed-ledgers" aria-label="Permalink to &quot;Managed ledgers&quot;">​</a></h5><p>由于BookKeeper ledgers 提供了统一的日志抽象，因此在ledgers之上开发了一个名为<code>managed ledger</code>的库，它代表单个主题的存储层。一个managed ledger代表了一个消息流的抽象，其中包含一个单一的写入者在流的末尾追加消息，以及多个消费者游标，每个游标都有其关联的位置。</p><p>在内部，单个managed ledger使用多个ledgers来存储数据。有两个原因使用多个账本：</p><ul><li>在发生故障后，一个ledger将无法继续写入，需要创建一个新的ledger。</li><li>当所有的游标都消费完ledger中的消息时，可以删除ledger。这允许定期对ledger进行切换。</li></ul><h5 id="journal-storage" tabindex="-1">Journal storage <a class="header-anchor" href="#journal-storage" aria-label="Permalink to &quot;Journal storage&quot;">​</a></h5><p>在BookKeeper中，<code>journal</code>文件包含了BookKeeper的事务日志。在对ledger进行更新之前，bookie需要确保描述该更新的事务被写入持久（非易失性）存储中。一旦bookie启动或者旧的日志文件达到了日志文件大小阈值（通过<code>journalMaxSizeMB</code>参数进行配置），就会创建一个新的<code>journal</code>文件。</p><h4 id="pulsar-proxy" tabindex="-1">Pulsar Proxy <a class="header-anchor" href="#pulsar-proxy" aria-label="Permalink to &quot;Pulsar Proxy&quot;">​</a></h4><p>Pulsar客户端和Pulsar集群交互的一种方式就是直连Pulsar brokers。有时这种直连既不可行也不可取，因为客户端并不知道broker的地址</p><p>Pulsar proxy为所有的broker提供了一个网关, 如果选择运行了Pulsar Proxy，所有的客户都会通过这个代理而不是直接与brokers通信</p><h3 id="架构" tabindex="-1">架构 <a class="header-anchor" href="#架构" aria-label="Permalink to &quot;架构&quot;">​</a></h3><h4 id="分片存储" tabindex="-1">分片存储 <a class="header-anchor" href="#分片存储" aria-label="Permalink to &quot;分片存储&quot;">​</a></h4><p>除了存储、计算解耦分离的设计之外，Apache Pulsar 在存储设计上也不同于传统 MQ 的分区数据本地存储的模式，采用的是分片存储的模式，存储粒度比分区更细化、存储负载更均衡。Apache Pulsar 中的每个 Topic 分区本质上都是存储在 Apache BookKeeper 中的分布式日志。Topic 可以有多个分区，分区数据持久化时，分区是逻辑上的概念，实际存储的单位是分片（Segment）的，如图，一个分区 Topic1-Part2 的数据由多个 Segment 组成， 每个 Segment 作为 Apache BookKeeper 中的一个 Ledger，均匀分布并存储在 Apache BookKeeper 群集中的多个 Bookie 节点中， 每个 Segment 具有 3 个副本。</p><p><img src="/assets/image-20230629145051542.571a4f7c.png" alt="image-20230629145051542"></p><p>它与传统的紧耦合分区架构而言，将带来一个很大的优势就是，超高的<strong>可扩展性</strong>以及<strong>故障容错性</strong>。</p><h4 id="高可用及横向拓展" tabindex="-1">高可用及横向拓展 <a class="header-anchor" href="#高可用及横向拓展" aria-label="Permalink to &quot;高可用及横向拓展&quot;">​</a></h4><p>消息服务层和持久存储层是分开的，因此 Apache Pulsar 可以独立地扩展存储层和服务层。</p><h5 id="可扩展性" tabindex="-1">可扩展性 <a class="header-anchor" href="#可扩展性" aria-label="Permalink to &quot;可扩展性&quot;">​</a></h5><h6 id="broker-扩展" tabindex="-1">Broker 扩展 <a class="header-anchor" href="#broker-扩展" aria-label="Permalink to &quot;Broker 扩展&quot;">​</a></h6><p>在 Pulsar 中 Broker 是<strong>无状态</strong>的，可以通过增加节点的方式实现快速扩容。当需要支持更多的消费者或生产者时，可以简单地添加更多的 Broker 节点来满足业务需求。Pulsar 支持自动的分区负载均衡，在 Broker 节点的资源使用率达到阈值时，会将负载迁移到负载较低的 Broker 节点，这个过程中分区也将在多个 Broker 节点中做平衡迁移，一些分区的<strong>所有权</strong>会转移到新的 Broker 节点。</p><h6 id="bookie-扩展" tabindex="-1">Bookie 扩展 <a class="header-anchor" href="#bookie-扩展" aria-label="Permalink to &quot;Bookie 扩展&quot;">​</a></h6><p>存储层的扩容，通过增加 Bookie 节点来实现。通过资源感知和数据放置策略，流量将自动切换到新的 Bookie 节点中，整个过程不会涉及到不必要的数据搬迁，即不需要将旧数据从现有存储节点重新复制到新存储节点。</p><p><img src="/assets/image-20230629145312761.d8877228.png" alt="image-20230629145312761"></p><p>如图所示，起始状态有四个存储节点，Bookie1, Bookie2, Bookie3, Bookie4，以 Topic1-Part2 为例，当这个分区的最新的存储分片是 SegmentX 时，对存储层扩容，添加了新的 Bookie 节点，BookieX,BookieY，那么在存储分片滚动之后，新生成的存储分片， SegmentX+1,SegmentX+2，会优先选择新的 Bookie 节点（BookieX,BookieY）来保存数据。</p><h5 id="容错性" tabindex="-1">容错性 <a class="header-anchor" href="#容错性" aria-label="Permalink to &quot;容错性&quot;">​</a></h5><p>得益于计算与存储分离以及分片存储的设计，Pulsar 可以实现独立、灵活的容错。</p><h6 id="broker-容错" tabindex="-1">Broker 容错 <a class="header-anchor" href="#broker-容错" aria-label="Permalink to &quot;Broker 容错&quot;">​</a></h6><p>当 Broker 节点失败时， 以图为例，当存储分片滚动到 SegmentX 时，Broker2 节点失败，此时生产者和消费者向其他的 Broker 发起请求，这个过程会触发分区的所有权转移，即将 Broker2 拥有的分区 Topic1-Part2 的所有权转移到其他的 Broker (Broker3)。在 Apache Pulsar 中数据存储和数据服务分离，所以新 Broker 接管分区的所有权时，它不需要复制 Partiton 的数据。新的分区 Owner（Broker3）会产生一个新的分片 SegmentX+1, 如果有新数据到来，会存储在新的分片 Segment x+1 上，不会影响分区的可用性。</p><p><img src="/assets/image-20230629145443509.1aeb75cc.png" alt="image-20230629145443509"></p><h6 id="bookie-容错" tabindex="-1">Bookie 容错 <a class="header-anchor" href="#bookie-容错" aria-label="Permalink to &quot;Bookie 容错&quot;">​</a></h6><p>当 Bookie 节点失败时，如图所示， 假设 Bookie 2 上的 Segment 4 损坏。Apache BookKeeper Auditor 会检测到这个错误并进行复制修复。Apache BookKeeper 中的副本修复是 Segment 级别的多对多快速修复，BookKeeper 可以从 Bookie 3 和 Bookie 4 读取 Segment 4 中的消息，并在 Bookie 1 处修复 Segment 4。如果是 Bookie 节点故障，这个 Bookie 节点上所有的 Segment 会按照上述方式复制到其他的 Bookie 节点。所有的副本修复都在后台进行，对 Broker 和应用透明，Broker 会产生新的 Segment 来处理写入请求，不会影响分区的可用性。</p><p><img src="/assets/image-20230629145514287.ef395c20.png" alt="image-20230629145514287"></p><p>分片存储解决了分区容量受单节点存储空间限制的问题，当容量不够时，可以通过扩容 Bookie 节点的方式支撑更多的分区数据，也解决了分区数据倾斜问题，数据可以均匀的分配在 Bookie 节点上。Broker 和 Bookie 灵活的容错以及无缝的扩容能力让 Apache Pulsar 具备非常高的可用性。</p><h4 id="读写分离" tabindex="-1">读写分离 <a class="header-anchor" href="#读写分离" aria-label="Permalink to &quot;读写分离&quot;">​</a></h4><p>Pulsar 另外一个有吸引力的特性是提供了读写分离的能力，读写分离保证了在有大量滞后消费（磁盘 IO 会增加）时，不会影响服务的正常运行，尤其是不会影响到数据的写入。读写分离的能力由 Apache BookKeeper 提供，简单说一下 Bookie 存储涉及到的概念：</p><ul><li>Journals：Journal 文件包含了 BookKeeper 事务日志，在 Ledger 更新之前，Journal 保证描述更新的事务写入到 Non-volatile 的存储介质上。</li><li>Entry logs：Entry 日志文件管理写入的 Entry，来自不同 ledger 的 entry 会被聚合然后顺序写入。</li><li>Index files：每个 Ledger 都有一个对应的索引文件，记录数据在 Entry 日志文件中的 Offset 信息。</li></ul><p>Entry 的读写入过程如图七所示，数据的写入流程：</p><ul><li>数据首先会写入 Journal，写入 Journal 的数据会实时落到磁盘。</li><li>然后，数据写入到 Memtable ，Memtable 是读写缓存。</li><li>写入 Memtable 之后，对写入请求进行响应。</li><li>Memtable 写满之后，会 Flush 到 Entry Logger 和 Index cache，Entry Logger 中保存了数据，Index cache 保存了数据的索引信息，然后由后台线程将 Entry Logger 和 Index cache 数据落到磁盘。</li></ul><p>数据的读取流程：</p><ul><li>如果是 Tailing read 请求，直接从 Memtable 中读取 Entry。</li><li>如果是 Catch-up read（滞后消费）请求，先读取 Index 信息，然后索引从 Entry Logger 文件读取 Entry。</li></ul><p><img src="/assets/image-20230629145555987.0aa0fbbf.png" alt="image-20230629145555987"></p><p>一般在进行 Bookie 的配置时，会将 Journal 和 Ledger 存储磁盘进行隔离，减少 Ledger 对于 Journal 写入的影响，并且推荐 Journal 使用性能较好的 SSD 磁盘，读写分离主要体现在：</p><ul><li>写入 Entry 时，Journal 中的数据需要实时写到磁盘，Ledger 的数据不需要实时落盘，通过后台线程批量落盘，因此写入的性能主要受到 Journal 磁盘的影响。</li><li>读取 Entry 时，首先从 Memtable 读取，命中则返回；如果不命中，再从 Ledger 磁盘中读取，所以对于 Catch-up read 的场景，读取数据会影响 Ledger 磁盘的 IO，对 Journal 磁盘没有影响，也就不会影响到数据的写入。</li></ul><p>所以，数据写入是主要是受 Journal 磁盘的负载影响，不会受 Ledger 磁盘的影响。另外，Segment 存储的多个副本都可以提供读取服务，相比于主从副本的设计，Apache Pulsar 可以提供更好的数据读取能力。通过以上分析，Apache Pulsar 使用 Apache BookKeeper 作为数据存储，可以带来下列的收益：</p><ul><li>支持将多个 Ledger 的数据写入到同一个 Entry logger 文件，可以避免分区膨胀带来的性能下降问题。</li><li>支持读写分离，可以在滞后消费场景导致磁盘 IO 上升时，保证数据写入的不受影响。</li><li>支持全副本读取，可以充分利用存储副本的数据读取能力。</li></ul><h3 id="核心概念" tabindex="-1">核心概念 <a class="header-anchor" href="#核心概念" aria-label="Permalink to &quot;核心概念&quot;">​</a></h3><p>pulsar建立在发布-订阅模式(通常缩写为发布-订阅)之上。在这种模式中，<code>producers</code>向<code>topics</code>发布消息,<code>consumers</code>订阅这些主题，处理传入的消息，并在处理完成时向broke发送<code>acknowledgments</code>。</p><p><img src="/assets/image-20230629145821154.74643408.png" alt="image-20230629145821154"></p><p>创建订阅后，即使客户断开连接，Pulsar也会保留所有消息。只有当<code>consumer</code>确认所有这些消息都已成功处理时，才会丢弃保留的消息。</p><p>如果消息的消费失败，并且希望再次消费此消息，则可以启用消息重发机制，请求broker重新发送此消息。</p><h4 id="消息-message" tabindex="-1">消息 message <a class="header-anchor" href="#消息-message" aria-label="Permalink to &quot;消息 message&quot;">​</a></h4><h5 id="生产者" tabindex="-1">生产者 <a class="header-anchor" href="#生产者" aria-label="Permalink to &quot;生产者&quot;">​</a></h5><h6 id="send-modes" tabindex="-1">Send modes <a class="header-anchor" href="#send-modes" aria-label="Permalink to &quot;Send modes&quot;">​</a></h6><table><thead><tr><th>模式</th><th>描述</th></tr></thead><tbody><tr><td>Sync send</td><td>生产者在发送每条消息后等待来自broker的确认。如果没有收到确认，则生产者将发送操作视为失败。</td></tr><tr><td>Async send</td><td>生产者将消息放入阻塞队列并立即返回。客户端在后台将消息发送到broker。如果队列已满(您可以配置最大大小)，则在调用API时，生产者将被阻塞或立即失败，这取决于传递给生产者的参数。</td></tr></tbody></table><h6 id="access-mode" tabindex="-1">Access mode <a class="header-anchor" href="#access-mode" aria-label="Permalink to &quot;Access mode&quot;">​</a></h6><table><thead><tr><th>访问模式</th><th>描述</th></tr></thead><tbody><tr><td>Shared</td><td>多个生产者可以在一个主题上发布。这是默认设置。</td></tr><tr><td>Exclusive</td><td>一个主题只能由一个生产者发表。如果已经有一个生产者连接，其他生产者试图发布这个主题立即得到错误。</td></tr><tr><td>WaitForExclusive</td><td>如果已经连接了一个生产者，那么生产者的创建将挂起(而不是超时)，直到生产者获得独占访问权限。</td></tr></tbody></table><p>一旦应用程序成功地创建了具有<code>Exclusive</code>或<code>WaitForExclusive</code>访问模式的生产者，该应用程序的实例就保证是该主题的唯一写入者。任何试图生成关于此主题的消息的其他生产者要么立即得到错误，要么必须等到获得独占访问权。</p><h6 id="deliverafter-deliverat" tabindex="-1">deliverAfter &amp; deliverAt <a class="header-anchor" href="#deliverafter-deliverat" aria-label="Permalink to &quot;deliverAfter &amp; deliverAt&quot;">​</a></h6><p>在 Pulsar 中使用延迟消息，可以精确指定延迟投递的时间，有 <code>deliverAfter</code> 和 <code>deliverAt</code> 两种方式。其中 <code>deliverAt</code> 可以指定具体的时间戳；<code>deliverAfter</code> 可以指定在当前多长时间后执行。两种方式的本质是一样的，Client 会计算出时间戳送到 Broker。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// deliverAfter发送</span></span>
<span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">newMessage</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">deliverAfter</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">3L</span><span style="color:#E1E4E8;">, TimeUnit.Minute).</span><span style="color:#B392F0;">value</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Hello Pulsar!&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// deliverAfter发送</span></span>
<span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">newMessage</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">deliverAfter</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3L</span><span style="color:#24292E;">, TimeUnit.Minute).</span><span style="color:#6F42C1;">value</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Hello Pulsar!&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">();</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//deliverAt发送</span></span>
<span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">newMessage</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">deliverAt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1670574629343L</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">value</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Hello Pulsar!&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">send</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//deliverAt发送</span></span>
<span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">newMessage</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">deliverAt</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1670574629343L</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">value</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Hello Pulsar!&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">send</span><span style="color:#24292E;">();</span></span></code></pre></div><h6 id="消息压缩" tabindex="-1">消息压缩 <a class="header-anchor" href="#消息压缩" aria-label="Permalink to &quot;消息压缩&quot;">​</a></h6><p>消息压缩是优化信息传输的手段之一，我们通常看见一些大型文件都会是以一个压缩包的形式提供下载，在我们消息队列中我们也可以用这种思想，我们将一个batch的消息，比如有1000条可能有1M的传输大小，但是经过压缩之后可能就只会有几十kb，增加了我们和broker的传输效率，但是与之同时我们的cpu也带来了损耗。Pulsar客户端支持多种压缩类型，如 lz4、zlib、zstd、snappy 等。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">client.</span><span style="color:#B392F0;">newProducer</span><span style="color:#E1E4E8;">() </span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(“test</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">topic”) </span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">compressionType</span><span style="color:#E1E4E8;">(CompressionType.LZ4) </span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">newProducer</span><span style="color:#24292E;">() </span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(“test</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">topic”) </span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">compressionType</span><span style="color:#24292E;">(CompressionType.LZ4) </span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">();</span></span></code></pre></div><h5 id="消费者" tabindex="-1">消费者 <a class="header-anchor" href="#消费者" aria-label="Permalink to &quot;消费者&quot;">​</a></h5><h6 id="消息确认-acknowledgement" tabindex="-1">消息确认 Acknowledgement <a class="header-anchor" href="#消息确认-acknowledgement" aria-label="Permalink to &quot;消息确认 Acknowledgement&quot;">​</a></h6><table><thead><tr><th>模式</th><th>模式</th></tr></thead><tbody><tr><td>acknowledge individually</td><td>消息立即确认，消费者消费后每一条消息都会给broker发送一个确认请求</td></tr><tr><td>acknowledged cumulatively</td><td>消息累计确认，消费者仅提交最后一条消息，流中的所有消息直到(并包括)所提供的消息都不会重新投递给该消费者。</td></tr></tbody></table><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 立即提交api</span></span>
<span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">acknowledge</span><span style="color:#E1E4E8;">(msg);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 立即提交api</span></span>
<span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">acknowledge</span><span style="color:#24292E;">(msg);</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 累计提交api</span></span>
<span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">acknowledgeCumulative</span><span style="color:#E1E4E8;">(msg);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 累计提交api</span></span>
<span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">acknowledgeCumulative</span><span style="color:#24292E;">(msg);</span></span></code></pre></div><p>如果是<code>Shared</code>订阅类型，消息确认只能使用<code>acknowledge individually</code>。因为<code>Shared</code>模式所有消费者共享一条数据。</p><h6 id="消息重试" tabindex="-1">消息重试 <a class="header-anchor" href="#消息重试" aria-label="Permalink to &quot;消息重试&quot;">​</a></h6><p><strong>Negative acknowledgement</strong></p><p>消息否定机制可以在consumer未成功使用消息时，向broker发送<code>nack</code>，从而将消息重新投递给consumer。</p><p>和<code>Acknowledgement</code>一样，消息是立即确认还是累计确认，取决于订阅类型。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(topic)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;sub-negative-ack&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscriptionInitialPosition</span><span style="color:#E1E4E8;">(SubscriptionInitialPosition.Earliest)</span></span>
<span class="line"><span style="color:#E1E4E8;">    			</span><span style="color:#6A737D;">// the default value is 1 min</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">negativeAckRedeliveryDelay</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, TimeUnit.SECONDS) </span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">Message&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; message </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> consumer.</span><span style="color:#B392F0;">receive</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 发送消息否认</span></span>
<span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">negativeAcknowledge</span><span style="color:#E1E4E8;">(message);</span></span>
<span class="line"><span style="color:#E1E4E8;">message </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> consumer.</span><span style="color:#B392F0;">receive</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 发送消息确认</span></span>
<span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">acknowledge</span><span style="color:#E1E4E8;">(message);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(topic)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;sub-negative-ack&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscriptionInitialPosition</span><span style="color:#24292E;">(SubscriptionInitialPosition.Earliest)</span></span>
<span class="line"><span style="color:#24292E;">    			</span><span style="color:#6A737D;">// the default value is 1 min</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">negativeAckRedeliveryDelay</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">, TimeUnit.SECONDS) </span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">Message&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; message </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> consumer.</span><span style="color:#6F42C1;">receive</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 发送消息否认</span></span>
<span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">negativeAcknowledge</span><span style="color:#24292E;">(message);</span></span>
<span class="line"><span style="color:#24292E;">message </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> consumer.</span><span style="color:#6F42C1;">receive</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 发送消息确认</span></span>
<span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">acknowledge</span><span style="color:#24292E;">(message);</span></span></code></pre></div><p>redelivery backoff 可以设置重试的时间间隔策略，指定最大和最小时间，在这段时间内通过计算因子计算每次间隔时间：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(topic)</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;sub-negative-ack&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">subscriptionInitialPosition</span><span style="color:#E1E4E8;">(SubscriptionInitialPosition.Earliest)</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">negativeAckRedeliveryBackoff</span><span style="color:#E1E4E8;">(MultiplierRedeliveryBackoff.</span><span style="color:#B392F0;">builder</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//最小1s</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">minDelayMs</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//最大60s</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">maxDelayMs</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">60</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//计算因子 1s 2s 4s 6s 8s 16s …… 60s</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">multiplier</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(topic)</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;sub-negative-ack&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">subscriptionInitialPosition</span><span style="color:#24292E;">(SubscriptionInitialPosition.Earliest)</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">negativeAckRedeliveryBackoff</span><span style="color:#24292E;">(MultiplierRedeliveryBackoff.</span><span style="color:#6F42C1;">builder</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//最小1s</span></span>
<span class="line"><span style="color:#24292E;">            .</span><span style="color:#6F42C1;">minDelayMs</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//最大60s</span></span>
<span class="line"><span style="color:#24292E;">            .</span><span style="color:#6F42C1;">maxDelayMs</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">60</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//计算因子 1s 2s 4s 6s 8s 16s …… 60s</span></span>
<span class="line"><span style="color:#24292E;">            .</span><span style="color:#6F42C1;">multiplier</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            .</span><span style="color:#6F42C1;">build</span><span style="color:#24292E;">())</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span></code></pre></div><table><thead><tr><th>Redelivery count</th><th>Redelivery delay</th></tr></thead><tbody><tr><td>1</td><td>1 seconds</td></tr><tr><td>2</td><td>2 seconds</td></tr><tr><td>3</td><td>4 seconds</td></tr><tr><td>4</td><td>8 seconds</td></tr><tr><td>5</td><td>16 seconds</td></tr><tr><td>6</td><td>32 seconds</td></tr><tr><td>7</td><td>60 seconds</td></tr><tr><td>8</td><td>60 seconds</td></tr></tbody></table><p>只有在<code>Shared</code>和<code>Key_Shared</code>订阅类型中，消费者可以逐个否定消息, <code>Exclusive</code> 和 <code>Failover</code> 消费者只确认他们收到的最后一条消息。</p><blockquote><p>如果是对消息有序性有要求，在否定消息后，顺序无法得到保证</p></blockquote><p><strong>Acknowledgement timeout</strong></p><p>如果指定了ack超时时间，且未提交确认消息，客户端会向<code>broker</code>发送重新发送未确认消息的请求，与<code>Negative acknowledgement</code> 相比，不建议使用。因为很难去设置超时时间。</p><p>当消息处理时间超出超时时间时，会发起不必要的消息重试。</p><p>如果想使用nack，需要保证在<code>acknowledgment timeout</code>前将消息进行提交,不对<code>ack timeout</code>进行设置即可</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(topic)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">ackTimeout</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, TimeUnit.SECONDS) </span><span style="color:#6A737D;">// 默认值为0</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">ackTimeoutTickTime</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, TimeUnit.SECONDS) </span><span style="color:#6A737D;">//每s检查一次</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;sub&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscriptionInitialPosition</span><span style="color:#E1E4E8;">(SubscriptionInitialPosition.Earliest)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">Message&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; message </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> consumer.</span><span style="color:#B392F0;">receive</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 等待至少2s</span></span>
<span class="line"><span style="color:#E1E4E8;">message </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> consumer.</span><span style="color:#B392F0;">receive</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">acknowledge</span><span style="color:#E1E4E8;">(message);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(topic)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">ackTimeout</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">, TimeUnit.SECONDS) </span><span style="color:#6A737D;">// 默认值为0</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">ackTimeoutTickTime</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, TimeUnit.SECONDS) </span><span style="color:#6A737D;">//每s检查一次</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;sub&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscriptionInitialPosition</span><span style="color:#24292E;">(SubscriptionInitialPosition.Earliest)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">Message&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; message </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> consumer.</span><span style="color:#6F42C1;">receive</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 等待至少2s</span></span>
<span class="line"><span style="color:#24292E;">message </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> consumer.</span><span style="color:#6F42C1;">receive</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">acknowledge</span><span style="color:#24292E;">(message);</span></span></code></pre></div><p><strong>Retry letter topic</strong></p><p><img src="/assets/image-20230629150956515.a29c3cbc.png" alt="image-20230629150956515"></p><p><code>Retry letter topic</code>允许您存储未能使用的消息，并在以后重试使用它们。使用此方法，您可以自定义重新传递消息的间隔。原始主题上的消费者也会自动订阅重试信件主题。一旦达到最大重试次数，未使用的消息将被移动到死信主题以进行手动处理。</p><p>目前在<code>Shared</code>和<code>Key_Shared</code>订阅类型下才能使用</p><p>使用 <code>Retry letter topic</code> 与 <code>delayed message delivery</code> 两者都旨在稍后使用消息，区别在于<code>Retry letter topic</code> 用于故障处理，确保关键数据不会丢失，而<code>delayed message delivery</code> 是以指定的延迟时间传递消息。</p><p>与<code>nack</code>相比，<code>Retry letter topic</code>更适合于需要大量重试且重试间隔可配置的消息。因为<code>Retry letter topic</code>中的消息被持久化到BookKeeper，而由于<code>nack</code>需要重试的消息被缓存到客户端。</p><p>缺省情况下，禁用自动重试功能。您可以将<code>enableRetry</code>设置为true，在consumer上启用自动重试。使用以下API来消费来自<code>Retry letter topic</code>的消息。当达到<code>maxRedeliverCount</code>的值时，未使用的消息将被移动到<code>Dead letter topic</code></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">(Schema.BYTES)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-topic&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-subscription&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscriptionType</span><span style="color:#E1E4E8;">(SubscriptionType.Shared)</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">//开启重试</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">enableRetry</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">deadLetterPolicy</span><span style="color:#E1E4E8;">(DeadLetterPolicy.</span><span style="color:#B392F0;">builder</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">//最大重试次数，超过发送到死信队列</span></span>
<span class="line"><span style="color:#E1E4E8;">                        .</span><span style="color:#B392F0;">maxRedeliverCount</span><span style="color:#E1E4E8;">(maxRedeliveryCount)</span></span>
<span class="line"><span style="color:#E1E4E8;">                        .</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">(Schema.BYTES)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-topic&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-subscription&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscriptionType</span><span style="color:#24292E;">(SubscriptionType.Shared)</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">//开启重试</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">enableRetry</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">deadLetterPolicy</span><span style="color:#24292E;">(DeadLetterPolicy.</span><span style="color:#6F42C1;">builder</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">//最大重试次数，超过发送到死信队列</span></span>
<span class="line"><span style="color:#24292E;">                        .</span><span style="color:#6F42C1;">maxRedeliverCount</span><span style="color:#24292E;">(maxRedeliveryCount)</span></span>
<span class="line"><span style="color:#24292E;">                        .</span><span style="color:#6F42C1;">build</span><span style="color:#24292E;">())</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span></code></pre></div><p><code>retryLetterTopic</code> 用来设置重试队列的topic名称，如果不设置默认为：</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">topicname</span><span style="color:#E1E4E8;">&gt;RETRY&lt;</span><span style="color:#85E89D;">subscriptionname</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">topicname</span><span style="color:#24292E;">&gt;RETRY&lt;</span><span style="color:#22863A;">subscriptionname</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>使用以下API将消息存储在重试队列中。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">reconsumeLater</span><span style="color:#E1E4E8;">(msg, </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">, TimeUnit.SECONDS);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">reconsumeLater</span><span style="color:#24292E;">(msg, </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">, TimeUnit.SECONDS);</span></span></code></pre></div><h5 id="死信队列-dead-letter-topic" tabindex="-1">死信队列 Dead letter topic <a class="header-anchor" href="#死信队列-dead-letter-topic" aria-label="Permalink to &quot;死信队列 Dead letter topic&quot;">​</a></h5><p><code>Dead letter topic</code>服务于消息的重新发送，它由<code>acknowledgement timeout </code>、<code>negative acknowledgement</code>、<code>retry letter topic</code>触发,消费失败的消息</p><p>目前在<code>Shared</code>和<code>Key_Shared</code>订阅类型下才能使用。如果设置了<code>maxRedeliverCount</code> 会默认开启死信队列的投递。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">(Schema.BYTES)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-topic&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-subscription&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscriptionType</span><span style="color:#E1E4E8;">(SubscriptionType.Shared)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">deadLetterPolicy</span><span style="color:#E1E4E8;">(DeadLetterPolicy.</span><span style="color:#B392F0;">builder</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                      .</span><span style="color:#B392F0;">maxRedeliverCount</span><span style="color:#E1E4E8;">(maxRedeliveryCount)</span></span>
<span class="line"><span style="color:#E1E4E8;">                      .</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">(Schema.BYTES)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-topic&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-subscription&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscriptionType</span><span style="color:#24292E;">(SubscriptionType.Shared)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">deadLetterPolicy</span><span style="color:#24292E;">(DeadLetterPolicy.</span><span style="color:#6F42C1;">builder</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                      .</span><span style="color:#6F42C1;">maxRedeliverCount</span><span style="color:#24292E;">(maxRedeliveryCount)</span></span>
<span class="line"><span style="color:#24292E;">                      .</span><span style="color:#6F42C1;">build</span><span style="color:#24292E;">())</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span></code></pre></div><p>如果不设置名称，系统默认为</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">topicname</span><span style="color:#E1E4E8;">&gt;DLQ&lt;</span><span style="color:#85E89D;">subscriptionname</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">topicname</span><span style="color:#24292E;">&gt;DLQ&lt;</span><span style="color:#22863A;">subscriptionname</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>默认情况下，在DLQ主题创建期间没有订阅。如果不及时订阅DLQ主题，可能会丢失消息。要为DLQ自动创建初始订阅，可以指定<code>initialSubscriptionName</code>参数。如果设置了这个参数，需要保证<code>broker</code>侧的配置<code>allowAutoSubscriptionCreation</code>是开启的，才能有效创建DLQ生成器。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">(Schema.BYTES)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-topic&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-subscription&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscriptionType</span><span style="color:#E1E4E8;">(SubscriptionType.Shared)</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">deadLetterPolicy</span><span style="color:#E1E4E8;">(DeadLetterPolicy.</span><span style="color:#B392F0;">builder</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                      .</span><span style="color:#B392F0;">maxRedeliverCount</span><span style="color:#E1E4E8;">(maxRedeliveryCount)</span></span>
<span class="line"><span style="color:#E1E4E8;">                      .</span><span style="color:#B392F0;">deadLetterTopic</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-dead-letter-topic-name&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                      .</span><span style="color:#B392F0;">initialSubscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;init-sub&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                      .</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">                .</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">(Schema.BYTES)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-topic&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-subscription&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscriptionType</span><span style="color:#24292E;">(SubscriptionType.Shared)</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">deadLetterPolicy</span><span style="color:#24292E;">(DeadLetterPolicy.</span><span style="color:#6F42C1;">builder</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                      .</span><span style="color:#6F42C1;">maxRedeliverCount</span><span style="color:#24292E;">(maxRedeliveryCount)</span></span>
<span class="line"><span style="color:#24292E;">                      .</span><span style="color:#6F42C1;">deadLetterTopic</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-dead-letter-topic-name&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                      .</span><span style="color:#6F42C1;">initialSubscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;init-sub&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                      .</span><span style="color:#6F42C1;">build</span><span style="color:#24292E;">())</span></span>
<span class="line"><span style="color:#24292E;">                .</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span></code></pre></div><h5 id="消息延迟投递" tabindex="-1">消息延迟投递 <a class="header-anchor" href="#消息延迟投递" aria-label="Permalink to &quot;消息延迟投递&quot;">​</a></h5><p>延迟消息传递使您可以稍后使用消息。在这种机制中，消息存储在<code>BookKeeper</code>中。在消息发布到broker之后，<code>DelayedDeliveryTracker</code>在内存中维护时间索引(time -&gt; messageId)。一旦指定的延迟结束，该消息将被传递给使用者。</p><p>延迟消息传递仅适用于<code>Shared</code>类型。在<code>Exclusive</code>和<code>Failover</code>类型中，延迟消息将立即分派。</p><p><img src="/assets/image-20230629151618435.cf6d2aef.png" alt="image-20230629151618435"></p><p>broker保存消息而不进行任何检查。当<code>consumer</code>消费时，如果消息被设置为延迟，则该消息将被添加到<code>DelayedDeliveryTracker</code>。subscription从<code>DelayedDeliveryTracker</code>检查并获取超时的消息。</p><h5 id="事务消息" tabindex="-1">事务消息 <a class="header-anchor" href="#事务消息" aria-label="Permalink to &quot;事务消息&quot;">​</a></h5><p><code>Pulsar 事务消息的适用场景为一次事务中需要发送多个消息的情况，保证多个消息之间的事务约束，即多条消息要么都发送成功，要么都发送失败，而不是保证本地事务的执行和发送消息的事务约束</code></p><p>这里以一个资金流转场景举例，分账系统收到订单系统发送的一条信息A，然后进行自己的逻辑处理后，需要往余额系统投递两条信息B、C</p><p>这里的ack A、send B、send C，三个动作即构成一个事务</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//在初始化pulsarClient的时候需要开启enableTransaction</span></span>
<span class="line"><span style="color:#E1E4E8;">PulsarClient pulsarClient </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PulsarClient.</span><span style="color:#B392F0;">builder</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">serviceUrl</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;pulsar://localhost:6650&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//开启事务支持</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">enableTransaction</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//收到消息A</span></span>
<span class="line"><span style="color:#E1E4E8;">message </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> consumer.</span><span style="color:#B392F0;">receive</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">, TimeUnit.SECONDS);</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">//自己的各种业务逻辑.....</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">//开启一个事务</span></span>
<span class="line"><span style="color:#E1E4E8;">Transaction transaction </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newTransaction</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                    .</span><span style="color:#B392F0;">withTransactionTimeout</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">, TimeUnit.MINUTES)</span></span>
<span class="line"><span style="color:#E1E4E8;">                    .</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">//发送消息B</span></span>
<span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">newMessage</span><span style="color:#E1E4E8;">(transaction).</span><span style="color:#B392F0;">value</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;B&quot;</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getBytes</span><span style="color:#E1E4E8;">()).</span><span style="color:#B392F0;">sendAsync</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">//发送消息C</span></span>
<span class="line"><span style="color:#E1E4E8;">producer.</span><span style="color:#B392F0;">newMessage</span><span style="color:#E1E4E8;">(transaction).</span><span style="color:#B392F0;">value</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;C&quot;</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getBytes</span><span style="color:#E1E4E8;">()).</span><span style="color:#B392F0;">sendAsync</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">//ack消息A</span></span>
<span class="line"><span style="color:#E1E4E8;">consumer.</span><span style="color:#B392F0;">acknowledgeAsync</span><span style="color:#E1E4E8;">(message.</span><span style="color:#B392F0;">getMessageId</span><span style="color:#E1E4E8;">(), transaction);</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">//提交事务</span></span>
<span class="line"><span style="color:#E1E4E8;">transaction.</span><span style="color:#B392F0;">commit</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">//或者回滚事务</span></span>
<span class="line"><span style="color:#E1E4E8;">transaction.</span><span style="color:#B392F0;">abort</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//在初始化pulsarClient的时候需要开启enableTransaction</span></span>
<span class="line"><span style="color:#24292E;">PulsarClient pulsarClient </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PulsarClient.</span><span style="color:#6F42C1;">builder</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">serviceUrl</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;pulsar://localhost:6650&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//开启事务支持</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">enableTransaction</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">build</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//收到消息A</span></span>
<span class="line"><span style="color:#24292E;">message </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> consumer.</span><span style="color:#6F42C1;">receive</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">, TimeUnit.SECONDS);</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">//自己的各种业务逻辑.....</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">//开启一个事务</span></span>
<span class="line"><span style="color:#24292E;">Transaction transaction </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newTransaction</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                    .</span><span style="color:#6F42C1;">withTransactionTimeout</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">, TimeUnit.MINUTES)</span></span>
<span class="line"><span style="color:#24292E;">                    .</span><span style="color:#6F42C1;">build</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">//发送消息B</span></span>
<span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">newMessage</span><span style="color:#24292E;">(transaction).</span><span style="color:#6F42C1;">value</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;B&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">()).</span><span style="color:#6F42C1;">sendAsync</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">//发送消息C</span></span>
<span class="line"><span style="color:#24292E;">producer.</span><span style="color:#6F42C1;">newMessage</span><span style="color:#24292E;">(transaction).</span><span style="color:#6F42C1;">value</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;C&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">()).</span><span style="color:#6F42C1;">sendAsync</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">//ack消息A</span></span>
<span class="line"><span style="color:#24292E;">consumer.</span><span style="color:#6F42C1;">acknowledgeAsync</span><span style="color:#24292E;">(message.</span><span style="color:#6F42C1;">getMessageId</span><span style="color:#24292E;">(), transaction);</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">//提交事务</span></span>
<span class="line"><span style="color:#24292E;">transaction.</span><span style="color:#6F42C1;">commit</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">//或者回滚事务</span></span>
<span class="line"><span style="color:#24292E;">transaction.</span><span style="color:#6F42C1;">abort</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">();</span></span></code></pre></div><h4 id="主题-topic" tabindex="-1">主题 topic <a class="header-anchor" href="#主题-topic" aria-label="Permalink to &quot;主题 topic&quot;">​</a></h4><h5 id="命名规则" tabindex="-1">命名规则 <a class="header-anchor" href="#命名规则" aria-label="Permalink to &quot;命名规则&quot;">​</a></h5><p>与其他pub-sub系统一样，pulsar中的主题被命名为通道，用于将消息从生产者传输到消费者。topic的定义应遵循以下结构：</p><blockquote><p>{persistent|non-persistent}😕/tenant/namespace/topic</p></blockquote><table><thead><tr><th>Topic name component</th><th>Description</th></tr></thead><tbody><tr><td><code>persistent</code> / <code>non-persistent</code></td><td>Pulsar支持两种类型的的<strong>topic</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpulsar.apache.org%2Fdocs%2F2.10.x%2Fconcepts-architecture-overview%2F%23persistent-storage" target="_blank" rel="noreferrer">persistent</a> and <a href="https://link.juejin.cn?target=https%3A%2F%2Fpulsar.apache.org%2Fdocs%2F2.10.x%2Fconcepts-messaging%2F%23non-persistent-topics" target="_blank" rel="noreferrer">non-persistent</a>.默认是持久化的，表示所有消息都持久化在磁盘上，而未非持久化的主题不会存储在磁盘上</td></tr><tr><td><code>tenant</code></td><td>实例内的主题租户。租户对于Pulsar中的多租户至关重要，并且分布在集群中。</td></tr><tr><td><code>namespace</code></td><td>管理主题的单元，类似于分组机制，大多数主题都配置在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpulsar.apache.org%2Fdocs%2F2.10.x%2Fconcepts-messaging%2F%23namespaces" target="_blank" rel="noreferrer">namespace</a> 上. 每一个租户可以有多个 <strong>namespaces</strong>.</td></tr><tr><td><code>topic</code></td><td>名字组成的最后的一部分，它在pulsar中没有特殊的含义</td></tr></tbody></table><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">PulsarClient client </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PulsarClient.</span><span style="color:#B392F0;">builder</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">serviceUrl</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;pulsar://localhost:6650&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 指定非持久化topic</span></span>
<span class="line"><span style="color:#E1E4E8;">String npTopic </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;non-persistent://public/default/my-topic&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">String subscriptionName </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;my-subscription-name&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> client.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(npTopic)</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(subscriptionName)</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">PulsarClient client </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PulsarClient.</span><span style="color:#6F42C1;">builder</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">serviceUrl</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;pulsar://localhost:6650&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">build</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 指定非持久化topic</span></span>
<span class="line"><span style="color:#24292E;">String npTopic </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;non-persistent://public/default/my-topic&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">String subscriptionName </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;my-subscription-name&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> client.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(npTopic)</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(subscriptionName)</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span></code></pre></div><h5 id="multi-topic" tabindex="-1">Multi-topic <a class="header-anchor" href="#multi-topic" aria-label="Permalink to &quot;Multi-topic&quot;">​</a></h5><p>当消费者订阅一个pulsar主题时，默认情况下它会订阅一个特定的主题，例如<code>persistent://public/default/my-topic</code>。然而，从1.23.0版本开始，pulsar可以同时订阅多个主题。可以用两种方式定义主题列表:</p><ul><li>基于正则表达式(regex)，例如persistent://public/default/finance-.*</li><li>通过显式定义主题列表</li></ul><blockquote><p>当通过regex订阅多个主题时，所有主题必须在相同的名称空间中。</p></blockquote><p>当生产者向单个主题发送消息时，所有消息都保证以相同的顺序从该主题读取。然而，这些保证并不适用于<code>Multi-topic</code>。因此，当生产者向多个主题发送消息时，从这些主题读取消息的顺序不能保证相同。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 订阅所有 namespace 下所有topic</span></span>
<span class="line"><span style="color:#E1E4E8;">Pattern allTopicsInNamespace </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Pattern.</span><span style="color:#B392F0;">compile</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;persistent://public/default/.*&quot;</span><span style="color:#E1E4E8;">);  </span></span>
<span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; allTopicsConsumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">topicsPattern</span><span style="color:#E1E4E8;">(allTopicsInNamespace)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;subscription-1&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#6A737D;">// 订阅某个 namespace 下所有topic</span></span>
<span class="line"><span style="color:#E1E4E8;">Pattern someTopicsInNamespace </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Pattern.</span><span style="color:#B392F0;">compile</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;persistent://public/default/foo.*&quot;</span><span style="color:#E1E4E8;">);  </span></span>
<span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; someTopicsConsumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">topicsPattern</span><span style="color:#E1E4E8;">(someTopicsInNamespace)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;subscription-1&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 订阅所有 namespace 下所有topic</span></span>
<span class="line"><span style="color:#24292E;">Pattern allTopicsInNamespace </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Pattern.</span><span style="color:#6F42C1;">compile</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;persistent://public/default/.*&quot;</span><span style="color:#24292E;">);  </span></span>
<span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; allTopicsConsumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">topicsPattern</span><span style="color:#24292E;">(allTopicsInNamespace)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;subscription-1&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();  </span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;">// 订阅某个 namespace 下所有topic</span></span>
<span class="line"><span style="color:#24292E;">Pattern someTopicsInNamespace </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Pattern.</span><span style="color:#6F42C1;">compile</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;persistent://public/default/foo.*&quot;</span><span style="color:#24292E;">);  </span></span>
<span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; someTopicsConsumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">topicsPattern</span><span style="color:#24292E;">(someTopicsInNamespace)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;subscription-1&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span></code></pre></div><h5 id="partitioned-topics" tabindex="-1">Partitioned topics <a class="header-anchor" href="#partitioned-topics" aria-label="Permalink to &quot;Partitioned topics&quot;">​</a></h5><p><img src="/assets/image-20230629152228911.a3f564bc.png" alt="image-20230629152228911"></p><p>如图所示，topic1中有5个分区（p0-p4），他们分布在3个broker上，因为<code>partition</code>比broker多，所以两个broker一次处理2个partition，另一个代理只处理一个partition。</p><p>这个topic的消息将广播给2个消费者，路由模式决定每条消息应该发布到哪个分区，而订阅类型决定哪些消息发送给哪个消费者，在大多数情况下，可以分别决定路由和订阅模式。通常，吞吐量问题应该使用分区/路由决策，而订阅类型的决策取决于应用程序具体的使用场景。</p><h6 id="routing-modes-路由模式" tabindex="-1">Routing modes 路由模式 <a class="header-anchor" href="#routing-modes-路由模式" aria-label="Permalink to &quot;Routing modes 路由模式&quot;">​</a></h6><table><thead><tr><th>Mode</th><th>Description</th></tr></thead><tbody><tr><td><code>RoundRobinPartition</code></td><td>如果没有提供key，生产者将以<code>轮询</code>方式跨所有分区发布消息，以实现最大吞吐量。请注意，轮循不是针对单个消息进行的，而是将其设置为相同的批处理延迟边界，以确保批处理有效。如果在消息上指定了一个键，则分区生产者将对该键进行散列，并将消息分配给特定的分区。这是默认模式。</td></tr><tr><td><code>SinglePartition</code></td><td>如果没有提供key，生产者将<code>随机选择</code>一个分区，并将所有消息发布到该分区中。如果在消息上指定了一个键，则分区生产者将对该键进行散列，并将消息分配给特定的分区。</td></tr><tr><td><code>CustomPartition</code></td><td>使用将被调用的自定义消息路由器实现来确定特定消息的分区。用户可以使用实例创建自定义路由模式使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpulsar.apache.org%2Fdocs%2F3.0.x%2Fclient-libraries-java%2F" target="_blank" rel="noreferrer">Java client</a> 并实现 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpulsar.apache.org%2Fapi%2Fclient%2F3.0.x%2Forg%2Fapache%2Fpulsar%2Fclient%2Fapi%2FMessageRouter" target="_blank" rel="noreferrer">MessageRouter</a> 接口。</td></tr></tbody></table><p>如果消息附加了一个键，当使用SinglePartition或RoundRobinPartition模式时，消息将根据ProducerBuilder中<code>HashingScheme</code>指定的散列方案路由到相应的分区。</p><table><thead><tr><th>Ordering guarantee</th><th>Description</th><th>Routing Mode and Key</th></tr></thead><tbody><tr><td>Per-key-partition</td><td>具有相同键的所有消息将按顺序排列并放置在同一分区中.</td><td>使用<code>SinglePartition</code>或<code>RoundRobinPartition</code>模式，Key由每条消息提供。</td></tr><tr><td>Per-producer</td><td>来自同一生产者的所有消息都是有序的。</td><td>使用<code>SinglePartition</code>模式，不为每条消息提供Key。</td></tr></tbody></table><blockquote><p>HashingScheme是一个枚举，它表示在为特定消息选择分区时可用的标准散列函数集。 有两种类型的标准哈希函数可用:JavaStringHash和Murmur3_32Hash。生产者的默认哈希函数是JavaStringHash。请注意，当生产者可以来自不同的多语言客户端时，JavaStringHash是没有用的，在这种情况下，建议使用Murmur3_32Hash。</p></blockquote><h4 id="订阅者-subscriptions" tabindex="-1">订阅者 Subscriptions <a class="header-anchor" href="#订阅者-subscriptions" aria-label="Permalink to &quot;订阅者 Subscriptions&quot;">​</a></h4><h5 id="订阅类型" tabindex="-1">订阅类型 <a class="header-anchor" href="#订阅类型" aria-label="Permalink to &quot;订阅类型&quot;">​</a></h5><p>pulsar中有四种订阅类型:<code>exclusive</code>、<code>shared</code>、<code>failover</code>和<code>key_shared</code>。这些类型如下图所示。</p><p>根据消息传递的顺序性和实时性可以将消息模型分为两类：</p><ul><li><strong>queuing</strong> 模型主要是采用无序或者共享的方式来消费消息。</li><li><strong>streaming</strong> 模型要求消息的消费严格排序或独占消息消费</li></ul><h5 id="订阅模式" tabindex="-1">订阅模式 <a class="header-anchor" href="#订阅模式" aria-label="Permalink to &quot;订阅模式&quot;">​</a></h5><table><thead><tr><th>Subscription mode</th><th>Description</th><th>Note</th></tr></thead><tbody><tr><td><code>Durable</code></td><td>cursor是持久的，它保留消息并持久保存当前位置。如果代理从故障中重新启动，它可以从持久存储(BookKeeper)中恢复cursor，这样就可以从上次消费的位置继续消费消息。</td><td><code>Durable</code> 是<strong>默认的</strong>订阅模式。</td></tr><tr><td><code>NonDurable</code></td><td>cursor是非持久的。一旦代理停止，cursor将丢失，并且永远无法恢复，因此消息不能从最后消费的位置继续消费。</td><td>Reader的订阅模式本质上是<code>NonDurable</code>的，它不阻止主题中的数据被删除。Reader的订阅模式<strong>无法更改</strong>。</td></tr></tbody></table><blockquote><p>可以使用java client api 进行设置</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-topic&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-sub&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscriptionMode</span><span style="color:#E1E4E8;">(SubscriptionMode.Durable)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Consumer&lt;</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[]&gt; consumer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pulsarClient.</span><span style="color:#B392F0;">newConsumer</span><span style="color:#E1E4E8;">()  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">topic</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-topic&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscriptionName</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;my-sub&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscriptionMode</span><span style="color:#E1E4E8;">(SubscriptionMode.NonDurable)  </span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">subscribe</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"></span>
<span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-topic&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-sub&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscriptionMode</span><span style="color:#24292E;">(SubscriptionMode.Durable)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Consumer&lt;</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[]&gt; consumer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pulsarClient.</span><span style="color:#6F42C1;">newConsumer</span><span style="color:#24292E;">()  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">topic</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-topic&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscriptionName</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;my-sub&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscriptionMode</span><span style="color:#24292E;">(SubscriptionMode.NonDurable)  </span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#6F42C1;">subscribe</span><span style="color:#24292E;">();</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><div class="edit-info" data-v-ef5dee53><!----><div class="last-updated" data-v-ef5dee53><p class="VPLastUpdated" data-v-ef5dee53 data-v-7e05ebdb>Last updated: <time datetime="2023-10-20T07:04:45.000Z" data-v-7e05ebdb></time></p></div></div><nav class="prev-next" data-v-ef5dee53><div class="pager" data-v-ef5dee53><a class="pager-link prev" href="/second/mq/kafka.html" data-v-ef5dee53><span class="desc" data-v-ef5dee53>Previous page</span><span class="title" data-v-ef5dee53>kafka</span></a></div><div class="pager" data-v-ef5dee53><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"alg_algorithm_回溯.md\":\"63fd76b5\",\"alg_structure_图.md\":\"3f4997da\",\"bigdata_path.md\":\"1e7c9416\",\"alg_structure_堆.md\":\"cc3b05f0\",\"alg_structure_index.md\":\"cce38a97\",\"alg_algorithm_二分查找.md\":\"f2af1c41\",\"books_book0002_02演进-数据库_11-nosql：在高并发场景下，数据库和nosql如何做到互补？.md\":\"62bf4f30\",\"books_book0002_02演进-数据库_07-池化技术：如何减少频繁创建数据库连接的性能损耗？.md\":\"9bd7a64d\",\"books_book0002_08结束_结束语-学不可以已.md\":\"e2d8c12a\",\"books_book0002_07实战_40-信息流设计（二）：通用信息流系统的拉模式要如何做？.md\":\"a41541be\",\"books_book0002_02演进-数据库_10-发号器：如何保证分库分表后id的全局唯一性？.md\":\"89e17cad\",\"books_book0002_04演进-消息队列_20-当问到项目经历时，面试官究竟想要了解什么？.md\":\"e548f8e8\",\"books_book0002_04演进-消息队列_19-消息队列如何降低消息队列系统中消息的延迟？.md\":\"664abede\",\"books_book0002_03演进-缓存_13-缓存的使用姿势（一）：如何选择缓存的读写策略？.md\":\"4b10b9a2\",\"alg_algorithm_index.md\":\"eb34c27d\",\"books_book0002_06演进-维护_35-流量控制：高并发系统中我们如何操纵流量？.md\":\"b7bc10d8\",\"books_book0002_06演进-维护_33-配置管理：成千上万的配置项要如何管理？.md\":\"362a8aa7\",\"books_book0002_03演进-缓存_加餐-数据的签约应该如何做？.md\":\"bc42e56f\",\"books_book0002_05演进-分布式服务_25-分布式trace：横跨几十个分布式组件的慢请求要如何排查？.md\":\"05519a66\",\"books_book0002_07实战_38-计数系统设计（二）：50万qps下如何设计未读数系统？.md\":\"c4e51a03\",\"books_book0002_01基础_03-系统设计目标（一）：如何提升系统性能？.md\":\"828a371b\",\"cache_memcached.md\":\"9bfdb7fb\",\"books_book0002_05演进-分布式服务_23-rpc框架：10万qps下如何实现毫秒级的服务调用？.md\":\"7014f621\",\"books_book0002_05演进-分布式服务_26-负载均衡：怎样提升系统的横向扩展能力？.md\":\"11cb1eb0\",\"books_book0002_06演进-维护_32-压力测试：怎样设计全链路压力测试平台？.md\":\"e49818f2\",\"books_book0002_01基础_04-系统设计目标（二）：系统怎样做到高可用？.md\":\"14bcff24\",\"books_book0002_06演进-维护_30-给系统加上眼睛：服务端监控要怎么做？.md\":\"fb165392\",\"books_book0002_05演进-分布式服务_27-api网关：系统的门面要如何做呢？.md\":\"f2b1d784\",\"alg_topic_剑指offer_index.md\":\"a4fc4644\",\"bigdata_layering.md\":\"f37d055f\",\"books_book0002_07实战_39-信息流设计（一）：通用信息流系统的推模式要如何做？.md\":\"7613f5ef\",\"books_book0002_02演进-数据库_09-数据库优化方案（二）：写入数据量增加时，如何实现分库分表？.md\":\"18bd6529\",\"books_book0002_06演进-维护_34-降级熔断：如何屏蔽非核心系统故障的影响？.md\":\"cb20466b\",\"books_book0002_01基础_02-架构分层：我们为什么一定要这么做？.md\":\"68fea887\",\"books_book0002_00开篇_index.md\":\"bd860ba8\",\"books_book0002_05演进-分布式服务_21-系统架构：每秒1万次请求的系统要做服务化拆分吗？.md\":\"2a72629a\",\"alg_algorithm_双指针.md\":\"54d2e296\",\"books_book0002_04演进-消息队列_18-消息投递：如何保证消息仅仅被消费一次？.md\":\"2d4f0eb6\",\"books_book0002_03演进-缓存_15-缓存的使用姿势（三）：缓存穿透了怎么办？.md\":\"b4235165\",\"alg_structure_哈希表.md\":\"8848afe3\",\"alg_algorithm_排序.md\":\"bf9f753d\",\"books_book0002_03演进-缓存_16-cdn：静态资源如何加速？.md\":\"1dfd8901\",\"alg_topic_leetcode_index.md\":\"b8e7ac82\",\"alg_algorithm_动态规划.md\":\"3bad5ac3\",\"books_book0002_05演进-分布式服务_29-service mesh：如何屏蔽服务化系统的服务治理细节？.md\":\"95031c26\",\"books_book0002_01基础_05-系统设计目标（三）：如何让系统易于扩展？.md\":\"11e2466b\",\"books_book0002_03演进-缓存_12-缓存：数据库成为瓶颈后，动态数据的查询要如何加速？.md\":\"cc6fbde1\",\"books_book0002_05演进-分布式服务_28-多机房部署：跨地域的分布式系统如何做？.md\":\"6eaeeda8\",\"books_book0002_05演进-分布式服务_24-注册中心：分布式系统如何寻址？.md\":\"6247e583\",\"database_mongodb.md\":\"30b4cfb5\",\"books_book0002_01基础_01-高并发系统：它的通用设计方法是什么？.md\":\"7b0fe2a2\",\"books_book0002_03演进-缓存_14-缓存的使用姿势（二）：缓存如何做到高可用？.md\":\"9690b5eb\",\"books_book0003_index.md\":\"cd9614ff\",\"books_book0001_index.md\":\"aaaefa7e\",\"alg_structure_数组与链表.md\":\"8f6a99ff\",\"books_book0002_06演进-维护_31-应用性能管理：用户的使用体验应该如何监控？.md\":\"ed99301a\",\"books_book0002_04演进-消息队列_17-消息队列：秒杀如何处理每秒上万的下单请求？.md\":\"653b9831\",\"books_book0002_02演进-数据库_08-数据库优化方案（一）：查询请求增加时，如何做主从分离？.md\":\"54d40457\",\"container_k8s.md\":\"44295a7d\",\"books_book0002_05演进-分布式服务_22-微服务架构：微服务化后系统架构要如何改造？.md\":\"cbdf5050\",\"alg_structure_树.md\":\"f525f701\",\"design_skill.md\":\"d471477f\",\"design_log.md\":\"b185df3e\",\"database_index.md\":\"60934f9d\",\"database_oracle.md\":\"16ab0658\",\"container_linux.md\":\"2d4975cd\",\"cache_redisson.md\":\"88021973\",\"database_tidb.md\":\"adf76c65\",\"design_graypublish.md\":\"84cd856e\",\"books_book0002_07实战_37-计数系统设计（一）：面对海量数据的计数器要如何做？.md\":\"40916437\",\"design_electronicbusiness.md\":\"f4dd49fa\",\"design_distributedid.md\":\"b932e6c8\",\"framework_alibaba.md\":\"1a30e638\",\"design_thirdinterface.md\":\"b3f7dd76\",\"database_postgresql.md\":\"80dc00d2\",\"design_mallbff.md\":\"5e8b0ff7\",\"design_sso.md\":\"74776df0\",\"design_orderbusiness.md\":\"8f1abf52\",\"design_distributedtransaction.md\":\"ef95d62b\",\"design_index.md\":\"660f7902\",\"container_docker.md\":\"6de492fe\",\"alg_structure_队列与栈.md\":\"987e5d4e\",\"cache_redis.md\":\"ffbea791\",\"framework_springcloud.md\":\"a9352d21\",\"design_multicache.md\":\"7def197a\",\"middleware_auth.md\":\"b0dada6e\",\"middleware_mq.md\":\"4f60d427\",\"middleware_db.md\":\"5fa42524\",\"java_reactive.md\":\"86cb8206\",\"second_authority_satoken.md\":\"94236a8a\",\"second_cloud_hystrix.md\":\"66e272bf\",\"second_cloud_springcloudstream.md\":\"27b35ae8\",\"index.md\":\"72cc2e6d\",\"second_alibaba_nacos.md\":\"93a376e9\",\"optimize_index.md\":\"40bf5323\",\"java_jvm2.md\":\"832d0f64\",\"second_authority_oauth2.md\":\"1219d433\",\"second_alibaba_dubbo.md\":\"7064567c\",\"second_flow_flowable.md\":\"ef07872c\",\"design_synces.md\":\"2a3fbc5f\",\"problem_index.md\":\"03e6043b\",\"second_db_canal.md\":\"3ab73cc5\",\"middleware_task.md\":\"aef5837e\",\"middleware_server.md\":\"da957b0c\",\"second_alibaba_sentinel.md\":\"7fb764cf\",\"zeleted_util_feilong.md\":\"4ac0997c\",\"zeleted_standard_redis开发规范.md\":\"4bff1031\",\"second_server_nginx.md\":\"4b5499b7\",\"second_mq_pulsar.md\":\"0577889b\",\"second_search_elasticsearch.md\":\"c8959347\",\"second_alibaba_seata.md\":\"db4877bc\",\"second_flow_liteflow.md\":\"a4572424\",\"second_task_powerjob.md\":\"d9934c07\",\"middleware_flow.md\":\"fff46fa2\",\"problem_20230721q1.md\":\"1b6e651f\",\"second_mq_kafka.md\":\"b8d9cc86\",\"problem_20231020q1.md\":\"7c56edd8\",\"second_db_mybatis.md\":\"a921dc4e\",\"second_alibaba_zookeeper.md\":\"b38fd1d6\",\"problem_20230621q1.md\":\"c66905a5\",\"optimize_20230802q1.md\":\"dcf00778\",\"zeleted_util_log.md\":\"10772815\",\"second_task_xxljob.md\":\"fc4a7f5d\",\"problem_20230519q1.md\":\"c25cec78\",\"middleware_search.md\":\"c4cb0dcd\",\"updated_index.md\":\"a40cc695\",\"zeleted_test_testablemock.md\":\"35199cd9\",\"second_db_druid.md\":\"2035bcb5\",\"second_db_mybatisplus.md\":\"0159f364\",\"zeleted_standard_mysql规范.md\":\"40692829\",\"second_mq_rabbitmq.md\":\"2cb8e6f5\",\"second_cloud_springcloudgateway.md\":\"7753fe1a\",\"java_feature.md\":\"74b48f43\",\"zeleted_test_mockito.md\":\"b0291a0d\",\"second_flow_compileflow.md\":\"ea54f4c8\",\"zeleted_test_charles.md\":\"567b4067\",\"shorthand_index.md\":\"aaca2434\",\"framework_springboot.md\":\"1fe63edd\",\"second_server_openresty.md\":\"aa13c718\",\"second_cloud_openfeign.md\":\"eb5001b9\",\"java_jvm.md\":\"9e61a16e\",\"zeleted_test_jmh.md\":\"fe129a8a\",\"zeleted_standard_mysql习题.md\":\"0d93e461\",\"database_mysql.md\":\"f5fdf254\",\"zeleted_util_vavr.md\":\"f5d0420f\",\"zeleted_test_apachejmeter.md\":\"af5b8efa\",\"ide_index.md\":\"18ae803c\",\"second_mq_rocketmq.md\":\"60842893\",\"second_db_shardingjdbc.md\":\"6745aaf0\",\"java_index.md\":\"13e1531a\",\"second_server_netty.md\":\"e12e1461\",\"utils_index.md\":\"2f4de460\",\"framework_spring.md\":\"7b514879\",\"java_juc.md\":\"d1cd8981\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"某不知名小开发\",\"description\":\"在线文档\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"TheWe1\",\"logo\":\"/logo.png\",\"nav\":[{\"text\":\"更新日志\",\"link\":\"/updated/index\"},{\"text\":\"大数据\",\"items\":[{\"text\":\"大数据学习路线\",\"link\":\"/bigdata/path\"},{\"text\":\"数仓分层设计架构\",\"link\":\"/bigdata/layering\"}]},{\"text\":\"算法\",\"items\":[{\"text\":\"数据结构\",\"link\":\"/alg/structure/index\"},{\"text\":\"算法提升\",\"link\":\"/alg/algorithm/index\"},{\"text\":\"剑指Offer\",\"link\":\"https://doocs.github.io/leetcode/#/lcof2/README\"},{\"text\":\"LeetCode\",\"link\":\"https://doocs.github.io/leetcode/#/\"}]},{\"text\":\"经验\",\"items\":[{\"text\":\"生产问题排查\",\"link\":\"/problem/index\"},{\"text\":\"生产性能优化\",\"link\":\"/optimize/index\"},{\"text\":\"开发过程速记\",\"link\":\"/shorthand/index\"},{\"text\":\"常用工具类库\",\"link\":\"/utils/index\"},{\"text\":\"常用开发工具\",\"link\":\"/ide/index\"}]},{\"text\":\"文献\",\"items\":[{\"text\":\"如何设计一个秒杀系统\",\"link\":\"/books/book0001/index\"},{\"text\":\"高并发系统设计40问\",\"link\":\"/books/book0002/00开篇/index\"},{\"text\":\"DDD领域驱动设计\",\"link\":\"/books/book0003/index\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/liuxiaowei2018\"}],\"search\":{\"provider\":\"local\"},\"lastUpdated\":\"Last Updated\",\"smoothScroll\":true,\"sidebar\":{\"/java\":[{\"text\":\"JavaSe\",\"collapsible\":true,\"items\":[{\"text\":\"Java基础\",\"link\":\"/java/index\"},{\"text\":\"Java新特性\",\"link\":\"/java/feature\"},{\"text\":\"Java多线程\",\"link\":\"/java/juc\"},{\"text\":\"Java响应式编程\",\"link\":\"/java/reactive\"},{\"text\":\"Jvm基础\",\"link\":\"/java/jvm\"},{\"text\":\"Jvm调优\",\"link\":\"/java/jvm2\"}]}],\"/alg/structure\":[{\"text\":\"数据结构\",\"collapsible\":true,\"items\":[{\"text\":\"1.数据结构入门\",\"link\":\"/alg/structure/index\"},{\"text\":\"2.数组与链表\",\"link\":\"/alg/structure/数组与链表\"},{\"text\":\"3.队列与栈\",\"link\":\"/alg/structure/队列与栈\"},{\"text\":\"4.哈希表\",\"link\":\"/alg/structure/哈希表\"},{\"text\":\"5.树\",\"link\":\"/alg/structure/树\"}]}],\"/alg/algorithm\":[{\"text\":\"算法\",\"collapsible\":true,\"items\":[{\"text\":\"1.算法入门\",\"link\":\"/alg/algorithm/index\"},{\"text\":\"2.排序\",\"link\":\"/alg/algorithm/排序\"},{\"text\":\"3.二分查找\",\"link\":\"/alg/algorithm/二分查找\"},{\"text\":\"4.双指针\",\"link\":\"/alg/algorithm/双指针\"},{\"text\":\"5.回溯\",\"link\":\"/alg/algorithm/回溯\"},{\"text\":\"6.动态规划\",\"link\":\"/alg/algorithm/动态规划\"}]}],\"/framework\":[{\"text\":\"框架\",\"collapsible\":true,\"items\":[{\"text\":\"spring\",\"link\":\"/framework/spring\"},{\"text\":\"springBoot\",\"link\":\"/framework/springBoot\"},{\"text\":\"springCloud\",\"link\":\"/framework/springCloud\"},{\"text\":\"springCloudAlibaba\",\"link\":\"/framework/alibaba\"}]}],\"/database\":[{\"text\":\"数据库\",\"collapsible\":true,\"items\":[{\"text\":\"1.数据库设计\",\"link\":\"/database/index\"},{\"text\":\"2.MySQL\",\"link\":\"/database/mysql\"},{\"text\":\"3.Oracle\",\"link\":\"/database/oracle\"},{\"text\":\"4.PostgreSQL\",\"link\":\"/database/postgreSQL\"},{\"text\":\"5.MongoDB\",\"link\":\"/database/mongoDB\"},{\"text\":\"6.TiDB\",\"link\":\"/database/tiDB\"}]}],\"/cache\":[{\"text\":\"缓存\",\"collapsible\":true,\"items\":[{\"text\":\"1.redis\",\"link\":\"/cache/redis\"},{\"text\":\"2.redisson\",\"link\":\"/cache/redisson\"},{\"text\":\"3.memcached\",\"link\":\"/cache/memcached\"}]}],\"/middleware\":[{\"text\":\"中间件\",\"collapsible\":true,\"items\":[{\"text\":\"消息队列中间件\",\"link\":\"/middleware/mq\"},{\"text\":\"数据库中间件\",\"link\":\"/middleware/db\"},{\"text\":\"搜索中间件\",\"link\":\"/middleware/search\"},{\"text\":\"任务调度中间件\",\"link\":\"/middleware/task\"},{\"text\":\"工作流中间件\",\"link\":\"/middleware/flow\"},{\"text\":\"权限框架中间件\",\"link\":\"/middleware/auth\"},{\"text\":\"服务器中间件\",\"link\":\"/middleware/server\"}]}],\"/container\":[{\"text\":\"容器化技术\",\"collapsible\":true,\"items\":[{\"text\":\"linux\",\"link\":\"/container/linux\"},{\"text\":\"docker\",\"link\":\"/container/docker\"},{\"text\":\"k8s\",\"link\":\"/container/k8s\"}]}],\"/second/mq\":[{\"text\":\"消息中间件\",\"collapsible\":true,\"items\":[{\"text\":\"rabbitMQ\",\"link\":\"/second/mq/rabbitMQ\"},{\"text\":\"rocketMQ\",\"link\":\"/second/mq/rocketMQ\"},{\"text\":\"kafka\",\"link\":\"/second/mq/kafka\"},{\"text\":\"pluar\",\"link\":\"/second/mq/pulsar\"}]}],\"/second/db\":[{\"text\":\"数据库中间件\",\"collapsible\":true,\"items\":[{\"text\":\"mybatis\",\"link\":\"/second/db/mybatis\"},{\"text\":\"mybatisPlus\",\"link\":\"/second/db/mybatisPlus\"},{\"text\":\"druid\",\"link\":\"/second/db/druid\"},{\"text\":\"shardingJdbc\",\"link\":\"/second/db/shardingJdbc\"},{\"text\":\"canal\",\"link\":\"/second/db/canal\"}]}],\"/second/search\":[{\"text\":\"搜索中间件\",\"collapsible\":true,\"items\":[{\"text\":\"elasticsearch\",\"link\":\"/second/search/elasticsearch\"}]}],\"/second/task\":[{\"text\":\"任务调度中间件\",\"collapsible\":true,\"items\":[{\"text\":\"xxlJob\",\"link\":\"/second/task/xxlJob\"},{\"text\":\"powerJob\",\"link\":\"/second/task/powerJob\"}]}],\"/second/flow\":[{\"text\":\"工作流中间件\",\"collapsible\":true,\"items\":[{\"text\":\"flowable\",\"link\":\"/second/flow/flowable\"},{\"text\":\"compileflow\",\"link\":\"/second/flow/compileflow\"},{\"text\":\"liteflow\",\"link\":\"/second/flow/liteflow\"}]}],\"/second/server\":[{\"text\":\"服务器中间件\",\"collapsible\":true,\"items\":[{\"text\":\"nginx\",\"link\":\"/second/server/nginx\"},{\"text\":\"netty\",\"link\":\"/second/server/netty\"},{\"text\":\"openResty\",\"link\":\"/second/server/openresty\"}]}],\"/second/alibaba\":[{\"text\":\"阿里中间件\",\"collapsible\":true,\"items\":[{\"text\":\"dubbo\",\"link\":\"/second/alibaba/dubbo\"},{\"text\":\"nacos\",\"link\":\"/second/alibaba/nacos\"},{\"text\":\"seata\",\"link\":\"/second/alibaba/seata\"},{\"text\":\"sentinel\",\"link\":\"/second/alibaba/sentinel\"},{\"text\":\"zookeeper\",\"link\":\"/second/alibaba/zookeeper\"}]}],\"/second/cloud\":[{\"text\":\"SpringCloud\",\"collapsible\":true,\"items\":[{\"text\":\"springCloudOpenFeign\",\"link\":\"/second/cloud/openFeign\"},{\"text\":\"springCloudHystrix\",\"link\":\"/second/cloud/hystrix\"},{\"text\":\"springCloudGateway\",\"link\":\"/second/cloud/springCloudGateway\"},{\"text\":\"springCloudStream\",\"link\":\"/second/cloud/springCloudStream\"}]}],\"/second/authority\":[{\"text\":\"权限框架中间件\",\"collapsible\":true,\"items\":[{\"text\":\"oauth2\",\"link\":\"/second/authority/oauth2\"},{\"text\":\"saToken\",\"link\":\"/second/authority/saToken\"}]}],\"/design/\":[{\"text\":\"架构设计\",\"collapsible\":true,\"items\":[{\"text\":\"如何做好架构设计\",\"link\":\"/design/index\"},{\"text\":\"单点登录架构\",\"link\":\"/design/sso\"},{\"text\":\"多级缓存架构\",\"link\":\"/design/multiCache\"},{\"text\":\"灰度发布架构\",\"link\":\"/design/grayPublish\"},{\"text\":\"秒杀系统架构\",\"link\":\"/design/skill\"},{\"text\":\"日志系统架构\",\"link\":\"/design/log\"},{\"text\":\"电商业务架构\",\"link\":\"/design/electronicBusiness\"},{\"text\":\"订单系统架构\",\"link\":\"/design/orderBusiness\"},{\"text\":\"商城系统BFF演进架构\",\"link\":\"/design/mallBff\"},{\"text\":\"分布式ID架构\",\"link\":\"/design/distributedId\"},{\"text\":\"分布式事务架构\",\"link\":\"/design/distributedTransaction\"},{\"text\":\"ES数据同步架构\",\"link\":\"/design/syncEs\"},{\"text\":\"三方接口调用架构\",\"link\":\"/design/thirdInterface\"}]}],\"/problem\":[{\"text\":\"生产问题记录\",\"collapsible\":true,\"items\":[{\"text\":\"1.如何排查线上问题\",\"link\":\"/problem/index\"},{\"text\":\"2.线上服务器端口故障问题记录\",\"link\":\"/problem/20230519q1\"},{\"text\":\"3.线上pod 反复重启问题记录\",\"link\":\"/problem/20230621q1\"},{\"text\":\"4.线上pod OMM问题记录\",\"link\":\"/problem/20230721q1\"},{\"text\":\"5.线上pod 死锁问题记录\",\"link\":\"/problem/20231020q1\"}]}],\"/optimize\":[{\"text\":\"生产性能优化\",\"collapsible\":true,\"items\":[{\"text\":\"1.如何做好性能优化\",\"link\":\"/optimize/index\"},{\"text\":\"2.接口性能优化记录1\",\"link\":\"/optimize/20230802q1\"}]}],\"/books/book0001\":[{\"text\":\"如何设计一个秒杀系统\",\"collapsible\":true,\"items\":[{\"text\":\"如何设计一个秒杀系统-许令波\",\"link\":\"/books/book0001/index\"}]}],\"/books/book0002\":[{\"text\":\"开篇\",\"collapsible\":true,\"items\":[{\"text\":\"00-开篇词-为什么你要学习高并发系统设计？\",\"link\":\"/books/book0002/00开篇/index\"}]},{\"text\":\"基础\",\"collapsible\":true,\"items\":[{\"text\":\"01-高并发系统：它的通用设计方法是什么？\",\"link\":\"/books/book0002/01基础/01-高并发系统：它的通用设计方法是什么？\"},{\"text\":\"02-架构分层：我们为什么一定要这么做？\",\"link\":\"/books/book0002/01基础/02-架构分层：我们为什么一定要这么做？\"},{\"text\":\"03-系统设计目标（一）：如何提升系统性能？\",\"link\":\"/books/book0002/01基础/03-系统设计目标（一）：如何提升系统性能？\"},{\"text\":\"04-系统设计目标（二）：系统怎样做到高可用？\",\"link\":\"/books/book0002/01基础/04-系统设计目标（二）：系统怎样做到高可用？\"},{\"text\":\"05-系统设计目标（三）：如何让系统易于扩展？\",\"link\":\"/books/book0002/01基础/05-系统设计目标（三）：如何让系统易于扩展？\"}]},{\"text\":\"演进 - 数据库篇\",\"collapsible\":true,\"items\":[{\"text\":\"07-池化技术：如何减少频繁创建数据库连接的性能损耗？\",\"link\":\"/books/book0002/02演进-数据库/07-池化技术：如何减少频繁创建数据库连接的性能损耗？\"},{\"text\":\"08-数据库优化方案（一）：查询请求增加时，如何做主从分离？\",\"link\":\"/books/book0002/02演进-数据库/08-数据库优化方案（一）：查询请求增加时，如何做主从分离？\"},{\"text\":\"09-数据库优化方案（二）：写入数据量增加时，如何实现分库分表？\",\"link\":\"/books/book0002/02演进-数据库/09-数据库优化方案（二）：写入数据量增加时，如何实现分库分表？\"},{\"text\":\"10-发号器：如何保证分库分表后ID的全局唯一性？\",\"link\":\"/books/book0002/02演进-数据库/10-发号器：如何保证分库分表后ID的全局唯一性？\"},{\"text\":\"11-NoSQL：在高并发场景下，数据库和NoSQL如何做到互补？\",\"link\":\"/books/book0002/02演进-数据库/11-NoSQL：在高并发场景下，数据库和NoSQL如何做到互补？\"}]},{\"text\":\"演进 - 缓存篇\",\"collapsible\":true,\"items\":[{\"text\":\"12-缓存：数据库成为瓶颈后，动态数据的查询要如何加速？\",\"link\":\"/books/book0002/03演进-缓存/12-缓存：数据库成为瓶颈后，动态数据的查询要如何加速？\"},{\"text\":\"13-缓存的使用姿势（一）：如何选择缓存的读写策略？\",\"link\":\"/books/book0002/03演进-缓存/13-缓存的使用姿势（一）：如何选择缓存的读写策略？\"},{\"text\":\"14-缓存的使用姿势（二）：缓存如何做到高可用？\",\"link\":\"/books/book0002/03演进-缓存/14-缓存的使用姿势（二）：缓存如何做到高可用？\"},{\"text\":\"15-缓存的使用姿势（三）：缓存穿透了怎么办？\",\"link\":\"/books/book0002/03演进-缓存/15-缓存的使用姿势（三）：缓存穿透了怎么办？\"},{\"text\":\"加餐-数据的签约应该如何做？\",\"link\":\"/books/book0002/03演进-缓存/加餐-数据的签约应该如何做？\"}]},{\"text\":\"演进 - 消息队列篇\",\"collapsible\":true,\"items\":[{\"text\":\"17-消息队列：秒杀如何处理每秒上万的下单请求？\",\"link\":\"/books/book0002/04演进-消息队列/17-消息队列：秒杀如何处理每秒上万的下单请求？\"},{\"text\":\"18-消息投递：如何保证消息仅仅被消费一次？\",\"link\":\"/books/book0002/04演进-消息队列/18-消息投递：如何保证消息仅仅被消费一次？\"},{\"text\":\"19-消息队列如何降低消息队列系统中消息的延迟？\",\"link\":\"/books/book0002/04演进-消息队列/19-消息队列如何降低消息队列系统中消息的延迟？\"},{\"text\":\"20-当问到项目经历时，面试官究竟想要了解什么？\",\"link\":\"/books/book0002/04演进-消息队列/20-当问到项目经历时，面试官究竟想要了解什么？\"}]},{\"text\":\"演进 - 分布式服务\",\"collapsible\":true,\"items\":[{\"text\":\"21-系统架构：每秒1万次请求的系统要做服务化拆分吗？\",\"link\":\"/books/book0002/05演进-分布式服务/21-系统架构：每秒1万次请求的系统要做服务化拆分吗？\"},{\"text\":\"22-微服务架构：微服务化后系统架构要如何改造？\",\"link\":\"/books/book0002/05演进-分布式服务/22-微服务架构：微服务化后系统架构要如何改造？\"},{\"text\":\"23-系统架构：每秒1万次请求的系统要做服务化拆分吗？\",\"link\":\"/books/book0002/05演进-分布式服务/23-RPC框架：10万QPS下如何实现毫秒级的服务调用？\"},{\"text\":\"24-注册中心：分布式系统如何寻址？\",\"link\":\"/books/book0002/05演进-分布式服务/24-注册中心：分布式系统如何寻址？\"},{\"text\":\"25-分布式Trace：横跨几十个分布式组件的慢请求要如何排查？\",\"link\":\"/books/book0002/05演进-分布式服务/25-分布式Trace：横跨几十个分布式组件的慢请求要如何排查？\"},{\"text\":\"26-负载均衡：怎样提升系统的横向扩展能力？\",\"link\":\"/books/book0002/05演进-分布式服务/26-负载均衡：怎样提升系统的横向扩展能力？\"},{\"text\":\"27-API网关：系统的门面要如何做呢？\",\"link\":\"/books/book0002/05演进-分布式服务/27-API网关：系统的门面要如何做呢？\"},{\"text\":\"28-多机房部署：跨地域的分布式系统如何做？\",\"link\":\"/books/book0002/05演进-分布式服务/28-多机房部署：跨地域的分布式系统如何做？\"},{\"text\":\"29-Service Mesh：如何屏蔽服务化系统的服务治理细节？\",\"link\":\"/books/book0002/05演进-分布式服务/29-Service Mesh：如何屏蔽服务化系统的服务治理细节？\"}]},{\"text\":\"演进 - 维护\",\"collapsible\":true,\"items\":[{\"text\":\"30-为什么你要学习高并发系统设计？\",\"link\":\"/books/book0002/06演进-维护/30-给系统加上眼睛：服务端监控要怎么做？\"},{\"text\":\"31-应用性能管理：用户的使用体验应该如何监控？\",\"link\":\"/books/book0002/06演进-维护/31-应用性能管理：用户的使用体验应该如何监控？\"},{\"text\":\"32-压力测试：怎样设计全链路压力测试平台？\",\"link\":\"/books/book0002/06演进-维护/32-压力测试：怎样设计全链路压力测试平台？\"},{\"text\":\"33-配置管理：成千上万的配置项要如何管理？\",\"link\":\"/books/book0002/06演进-维护/33-配置管理：成千上万的配置项要如何管理？\"},{\"text\":\"34-降级熔断：如何屏蔽非核心系统故障的影响？\",\"link\":\"/books/book0002/06演进-维护/34-降级熔断：如何屏蔽非核心系统故障的影响？\"},{\"text\":\"35-流量控制：高并发系统中我们如何操纵流量？\",\"link\":\"/books/book0002/06演进-维护/35-流量控制：高并发系统中我们如何操纵流量？\"}]},{\"text\":\"实战\",\"collapsible\":true,\"items\":[{\"text\":\"37-计数系统设计（一）：面对海量数据的计数器要如何做？\",\"link\":\"/books/book0002/07实战/37-计数系统设计（一）：面对海量数据的计数器要如何做？\"},{\"text\":\"38-计数系统设计（二）：50万QPS下如何设计未读数系统？\",\"link\":\"/books/book0002/07实战/38-计数系统设计（二）：50万QPS下如何设计未读数系统？\"},{\"text\":\"39-信息流设计（一）：通用信息流系统的推模式要如何做？\",\"link\":\"/books/book0002/07实战/39-信息流设计（一）：通用信息流系统的推模式要如何做？\"},{\"text\":\"40-信息流设计（二）：通用信息流系统的拉模式要如何做？\",\"link\":\"/books/book0002/07实战/40-信息流设计（二）：通用信息流系统的拉模式要如何做？\"}]},{\"text\":\"结束\",\"collapsible\":true,\"items\":[{\"text\":\"结束语-学不可以已\",\"link\":\"/books/book0002/08结束/结束语-学不可以已\"}]}],\"/books/book0003\":[{\"text\":\"DDD领域驱动设计\",\"collapsible\":true,\"items\":[{\"text\":\"DDD入门&实践\",\"link\":\"/books/book0003/index\"}]}]}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>