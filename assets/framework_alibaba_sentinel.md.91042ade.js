import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.8048b864.js";const g=JSON.parse('{"title":"Sentinel","description":"","frontmatter":{},"headers":[],"relativePath":"framework/alibaba/sentinel.md","filePath":"framework/alibaba/sentinel.md","lastUpdated":1719037022000}'),p={name:"framework/alibaba/sentinel.md"},o=l(`<h1 id="sentinel" tabindex="-1">Sentinel <a class="header-anchor" href="#sentinel" aria-label="Permalink to &quot;Sentinel&quot;">​</a></h1><nav class="table-of-contents"><ul><li><a href="#使用注意事项和总结">使用注意事项和总结</a><ul><li><a href="#整合spring-cloud-alibaba-sentinel">整合Spring Cloud Alibaba Sentinel</a></li><li><a href="#使用-nacos-作为数据源">使用 Nacos 作为数据源</a></li><li><a href="#sentinel生产方案">Sentinel生产方案</a></li></ul></li></ul></nav><p><img src="https://cdn.jsdelivr.net/gh/liuxiaowei2018/image/repo/202405301705062.png" alt="主要特性"></p><p>Sentinel 分为<strong>两个部分</strong>：</p><ul><li>核心库（Java 客户端）：不依赖任何框架/库，能够运行于所有 Java 运行时环境，同时对 Dubbo / Spring Cloud 等框架也有较好的支持。</li><li>控制台（Dashboard）：基于 Spring Boot 开发，打包后可以直接运行，不需要额外的 Tomcat 等应用容器。</li></ul><blockquote><p>官方文档：<a href="https://github.com/alibaba/Sentinel/wiki" target="_blank" rel="noreferrer">https://github.com/alibaba/Sentinel/wiki</a></p><p>学习文档：<a href="https://www.iocoder.cn/Spring-Cloud-Alibaba/Sentinel/?self" target="_blank" rel="noreferrer">https://www.iocoder.cn/Spring-Cloud-Alibaba/Sentinel/?self</a></p></blockquote><h2 id="使用注意事项和总结" tabindex="-1">使用注意事项和总结 <a class="header-anchor" href="#使用注意事项和总结" aria-label="Permalink to &quot;使用注意事项和总结&quot;">​</a></h2><h3 id="整合spring-cloud-alibaba-sentinel" tabindex="-1">整合Spring Cloud Alibaba Sentinel <a class="header-anchor" href="#整合spring-cloud-alibaba-sentinel" aria-label="Permalink to &quot;整合Spring Cloud Alibaba Sentinel&quot;">​</a></h3><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;com.alibaba.cloud&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;spring-cloud-starter-alibaba-sentinel&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;com.alibaba.cloud&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;spring-cloud-starter-alibaba-sentinel&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;org.springframework.cloud&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;spring-cloud-starter-openfeign&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;org.springframework.cloud&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;spring-cloud-starter-openfeign&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">spring</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">application</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">cloud</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;"># Sentinel 配置项，对应 SentinelProperties 配置属性类</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#85E89D;">sentinel</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">	  </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 是否开启。默认为 true 开启</span></span>
<span class="line"><span style="color:#E1E4E8;">	  </span><span style="color:#85E89D;">eager</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 是否饥饿加载。默认为 false 关闭 [默认情况下，Sentinel 是延迟初始化]</span></span>
<span class="line"><span style="color:#E1E4E8;">	  </span><span style="color:#85E89D;">transport</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#85E89D;">dashboard</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">81.68.218.181:8858</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Sentinel 控制台地址</span></span>
<span class="line"><span style="color:#E1E4E8;">	  </span><span style="color:#85E89D;">filter</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#85E89D;">url-patterns</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/**</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 拦截请求的地址。默认为 /*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">feign</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">sentinel</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 开启 Sentinel 对 Feign 的支持，默认为 false 关闭。</span></span>
<span class="line"><span style="color:#85E89D;">resttemplate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">sentinel</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 开启 Sentinel 对 resttemplate 的支持，默认为 true 开启。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">application</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">cloud</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;"># Sentinel 配置项，对应 SentinelProperties 配置属性类</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#22863A;">sentinel</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">	  </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 是否开启。默认为 true 开启</span></span>
<span class="line"><span style="color:#24292E;">	  </span><span style="color:#22863A;">eager</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 是否饥饿加载。默认为 false 关闭 [默认情况下，Sentinel 是延迟初始化]</span></span>
<span class="line"><span style="color:#24292E;">	  </span><span style="color:#22863A;">transport</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#22863A;">dashboard</span><span style="color:#24292E;">: </span><span style="color:#032F62;">81.68.218.181:8858</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Sentinel 控制台地址</span></span>
<span class="line"><span style="color:#24292E;">	  </span><span style="color:#22863A;">filter</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#22863A;">url-patterns</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/**</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 拦截请求的地址。默认为 /*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">feign</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">sentinel</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 开启 Sentinel 对 Feign 的支持，默认为 false 关闭。</span></span>
<span class="line"><span style="color:#22863A;">resttemplate</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">sentinel</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 开启 Sentinel 对 resttemplate 的支持，默认为 true 开启。</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Configuration</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RestTemplateConfiguration</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Bean</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">SentinelRestTemplate</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> RestTemplate </span><span style="color:#B392F0;">restTemplate</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RestTemplate</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Configuration</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RestTemplateConfiguration</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Bean</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">SentinelRestTemplate</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> RestTemplate </span><span style="color:#6F42C1;">restTemplate</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RestTemplate</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>通过 <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-sentinel/src/main/java/com/alibaba/cloud/sentinel/annotation/SentinelRestTemplate.java" target="_blank" rel="noreferrer"><code>@SentinelRestTemplate</code></a> 注解，声明 Sentinel 对 RestTemplate 的支持。</p><p>另外，<code>@SentinelRestTemplate</code> 注解提供了 <code>blockHandler</code>、<code>blockHandlerClass</code>、<code>fallback</code>、</p><p><code>fallbackClass</code> 属性，作用和 <code>@SentinelResource</code> 注解是<strong>一致</strong>的。</p><h3 id="使用-nacos-作为数据源" tabindex="-1">使用 Nacos 作为数据源 <a class="header-anchor" href="#使用-nacos-作为数据源" aria-label="Permalink to &quot;使用 Nacos 作为数据源&quot;">​</a></h3><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">&lt;!-- Sentinel 对 Nacos 作为数据源的支持 --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;com.alibaba.csp&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;sentinel-datasource-nacos&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!-- Sentinel 对 Nacos 作为数据源的支持 --&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;com.alibaba.csp&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;sentinel-datasource-nacos&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">spring</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">application</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">cloud</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Sentinel 配置项，对应 SentinelProperties 配置属性类</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sentinel</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 是否开启。默认为 true 开启</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">eager</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 是否懒加载。默认为 false 关闭</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">transport</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">dashboard</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">81.68.218.181:8858</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Sentinel 控制台地址</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">filter</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">url-patterns</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/**</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 拦截请求的地址。默认为 /*</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># Sentinel 规则的数据源，是一个 Map 类型。key 为数据源名，可自定义;value 为数据源的具体配置</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">datasource</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ds1</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#6A737D;"># 对应 DataSourcePropertiesConfiguration 类</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">nacos</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">server-addr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">loalhost:8848</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Nacos 服务器地址</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">group-id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">DEFAULT_GROUP</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Nacos 分组</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">data-id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${spring.application.name}-flow-rule</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Nacos 配置集编号</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">data-type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">json</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 数据格式</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">rule-type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">FLOW</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 规则类型</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">application</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">cloud</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Sentinel 配置项，对应 SentinelProperties 配置属性类</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sentinel</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 是否开启。默认为 true 开启</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">eager</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 是否懒加载。默认为 false 关闭</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">transport</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">dashboard</span><span style="color:#24292E;">: </span><span style="color:#032F62;">81.68.218.181:8858</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Sentinel 控制台地址</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">filter</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">url-patterns</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/**</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 拦截请求的地址。默认为 /*</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># Sentinel 规则的数据源，是一个 Map 类型。key 为数据源名，可自定义;value 为数据源的具体配置</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">datasource</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ds1</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6A737D;"># 对应 DataSourcePropertiesConfiguration 类</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">nacos</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">server-addr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">loalhost:8848</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Nacos 服务器地址</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">group-id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">DEFAULT_GROUP</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Nacos 分组</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">data-id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${spring.application.name}-flow-rule</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Nacos 配置集编号</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">data-type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">json</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 数据格式</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">rule-type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">FLOW</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 规则类型</span></span></code></pre></div><blockquote><p>① <em>key</em>：为数据源名，可自定义，无特殊含义。</p><p>② <em>value</em>：为数据源的具体配置，对应 <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-sentinel-datasource/src/main/java/com/alibaba/cloud/sentinel/datasource/config/DataSourcePropertiesConfiguration.java" target="_blank" rel="noreferrer">DataSourcePropertiesConfiguration</a> 类，可以选择 <code>file</code>、<code>nacos</code>、<code>zk</code>、<code>apollo</code>、<code>redis</code> 任一作为数据的数据源。这里我们选择 <code>nacos</code> 来接入 Nacos 作为数据源。</p><ul><li><code>rule-type</code>：数据源对应的 Sentinel 规则类型，在 <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-sentinel-datasource/src/main/java/com/alibaba/cloud/sentinel/datasource/RuleType.java" target="_blank" rel="noreferrer">RuleType</a> 类枚举。这里我们设置了 <code>FLOW</code> 对应流量控制的规则。</li><li><code>data-type</code>：数据源的数据格式，默认为 <code>json</code>。这里我们设置了 <code>json</code>，所以稍后创建的 Nacos 配置集的数据格式要为 <code>JSON</code>。</li><li><code>server-addr</code>：Nacos 服务器地址。</li><li><code>namespace</code>：Nacos 分组。</li><li><code>data-id</code>：Nacos 配置集编号。推荐<strong>配置集编号</strong>的命名规则为 <code>\${applicationName}-\${ruleType}</code>，因此这里我们设置为 <code>demo-provider-flow-rule</code>，即 <code>demo-provider</code> 应用的流控规则。</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liuxiaowei2018/image/repo/202405301705118.png" alt="创建 Nacos 配置集"></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;resource&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;/demo/echo&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;limitApp&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;grade&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;count&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;strategy&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;controlBehavior&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;clusterMode&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;resource&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;/demo/echo&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;limitApp&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;grade&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;count&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;strategy&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;controlBehavior&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;clusterMode&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">]</span></span></code></pre></div><blockquote><p>参考 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" target="_blank" rel="noreferrer">《Sentinel 控制规则 —— 流量控制》</a></p><ul><li><code>resource</code>：资源名，即限流规则的作用对象</li><li><code>count</code>: 限流阈值</li><li><code>grade</code>: 限流阈值类型（QPS 或并发线程数）</li><li><code>limitApp</code>: 流控针对的调用来源，若为 <code>default</code> 则不区分调用来源</li><li><code>strategy</code>: 调用关系限流策略</li><li><code>controlBehavior</code>: 流量控制效果（直接拒绝、Warm Up、匀速排队）</li></ul></blockquote><h3 id="sentinel生产方案" tabindex="-1">Sentinel生产方案 <a class="header-anchor" href="#sentinel生产方案" aria-label="Permalink to &quot;Sentinel生产方案&quot;">​</a></h3><blockquote><p><a href="https://gitee.com/k8cloud/sentinel-dashboard" target="_blank" rel="noreferrer">https://gitee.com/k8cloud/sentinel-dashboard</a></p></blockquote>`,24),e=[o];function t(c,r,E,y,i,d){return a(),n("div",null,e)}const b=s(p,[["render",t]]);export{g as __pageData,b as default};
