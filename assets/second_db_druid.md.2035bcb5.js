import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.8048b864.js";const D=JSON.parse('{"title":"Druid","description":"","frontmatter":{},"headers":[],"relativePath":"second/db/druid.md","filePath":"second/db/druid.md","lastUpdated":1697785485000}'),p={name:"second/db/druid.md"},o=l(`<h1 id="druid" tabindex="-1">Druid <a class="header-anchor" href="#druid" aria-label="Permalink to &quot;Druid&quot;">​</a></h1><nav class="table-of-contents"><ul><li><a href="#_1、druid应用">1、Druid应用</a><ul><li><a href="#springboot整合druid">SpringBoot整合Druid</a></li></ul></li><li><a href="#_2、druid扩展">2、Druid扩展</a><ul><li><a href="#源码分析">源码分析</a></li></ul></li></ul></nav><blockquote><p>Druid是阿里巴巴开发的号称为监控而生的数据库连接池</p></blockquote><h2 id="_1、druid应用" tabindex="-1">1、Druid应用 <a class="header-anchor" href="#_1、druid应用" aria-label="Permalink to &quot;1、Druid应用&quot;">​</a></h2><h3 id="springboot整合druid" tabindex="-1">SpringBoot整合Druid <a class="header-anchor" href="#springboot整合druid" aria-label="Permalink to &quot;SpringBoot整合Druid&quot;">​</a></h3><h4 id="基本配置" tabindex="-1">基本配置 <a class="header-anchor" href="#基本配置" aria-label="Permalink to &quot;基本配置&quot;">​</a></h4><blockquote><p><code>pom.xml</code></p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">&lt;!-- druid数据源 --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;com.alibaba&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;druid-spring-boot-starter&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">&gt;1.1.23&lt;/</span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!-- mysql8 驱动--&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;mysql&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;mysql-connector-java&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">scope</span><span style="color:#E1E4E8;">&gt;runtime&lt;/</span><span style="color:#85E89D;">scope</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!-- druid数据源 --&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;com.alibaba&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;druid-spring-boot-starter&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> &lt;</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;1.1.23&lt;/</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!-- mysql8 驱动--&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;mysql&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;mysql-connector-java&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> &lt;</span><span style="color:#22863A;">scope</span><span style="color:#24292E;">&gt;runtime&lt;/</span><span style="color:#22863A;">scope</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div></blockquote><blockquote><ul><li><strong>配置Druid数据源（连接池）</strong> ：如同以前 c3p0、dbcp 数据源可以设置数据源连接初始化大小、最大连接数、等待时间、最小连接数 等一样，Druid 数据源同理可以进行设置；</li><li><strong>配置 Druid web 监控 filter（<code>WebStatFilter</code>）</strong> ：这个过滤器的作用就是统计 web 应用请求中所有的数据库信息，比如 发出的 sql 语句，sql 执行的时间、请求次数、请求的 url 地址、以及seesion 监控、数据库表的访问次数 等等。</li><li><strong>配置 Druid 后台管理 Servlet（<code>StatViewServlet</code>）</strong> ：Druid 数据源具有监控的功能，并提供了一个 web 界面方便用户查看，类似安装 路由器 时，人家也提供了一个默认的 web 页面；需要设置 Druid 的后台管理页面的属性，比如 登录账号、密码 等；</li></ul></blockquote><blockquote><p><code>application.yml</code></p><p><code>com.alibaba.druid.spring.boot.autoconfigure.properties.DruidStatProperties</code> <code>org.springframework.boot.autoconfigure.jdbc.DataSourceProperties</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">########## 配置数据源 （Druid）##########</span></span>
<span class="line"><span style="color:#85E89D;">spring</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">datasource</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">########## JDBC 基本配置 ##########</span></span>
<span class="line"><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">xxx</span></span>
<span class="line"><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">xxx</span></span>
<span class="line"><span style="color:#85E89D;">driver-class-name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">com.mysql.cj.jdbc.Driver</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;"># mysql8 的连接驱动</span></span>
<span class="line"><span style="color:#85E89D;">url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">jdbc:mysql://127.0.0.1:3306/test?serverTimezone=Asia/Shanghai</span></span>
<span class="line"><span style="color:#85E89D;">platform</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span><span style="color:#E1E4E8;">                               </span><span style="color:#6A737D;"># 数据库类型</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">com.alibaba.druid.pool.DruidDataSource</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 指定数据源类型</span></span>
<span class="line"><span style="color:#6A737D;">########## 连接池 配置 ##########</span></span>
<span class="line"><span style="color:#85E89D;">druid</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;"># 配置初始化大小、最小、最大</span></span>
<span class="line"><span style="color:#85E89D;">initial-size</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#85E89D;">minIdle</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#85E89D;">max-active</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">20</span></span>
<span class="line"><span style="color:#6A737D;"># 配置获取连接等待超时的时间(单位：毫秒)</span></span>
<span class="line"><span style="color:#85E89D;">max-wait</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">60000</span></span>
<span class="line"><span style="color:#6A737D;"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span></span>
<span class="line"><span style="color:#85E89D;">time-between-eviction-runs-millis</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2000</span></span>
<span class="line"><span style="color:#6A737D;"># 配置一个连接在池中最小生存的时间，单位是毫秒</span></span>
<span class="line"><span style="color:#85E89D;">min-evictable-idle-time-millis</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">600000</span></span>
<span class="line"><span style="color:#85E89D;">max-evictable-idle-time-millis</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">900000</span></span>
<span class="line"><span style="color:#6A737D;"># 用来测试连接是否可用的SQL语句,默认值每种数据库都不相同,这是mysql</span></span>
<span class="line"><span style="color:#85E89D;">validationQuery</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">select 1</span></span>
<span class="line"><span style="color:#6A737D;"># 应用向连接池申请连接，并且testOnBorrow为false时，连接池将会判断连接是否处于空闲状态，如果是，则验证这条连接是否可用</span></span>
<span class="line"><span style="color:#85E89D;">testWhileIdle</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#6A737D;"># 如果为true，默认是false，应用向连接池申请连接时，连接池会判断这条连接是否是可用的</span></span>
<span class="line"><span style="color:#85E89D;">testOnBorrow</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#6A737D;"># 如果为true（默认false），当应用使用完连接，连接池回收连接的时候会判断该连接是否还可用</span></span>
<span class="line"><span style="color:#85E89D;">testOnReturn</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#6A737D;"># 是否缓存preparedStatement，也就是PSCache。PSCache对支持游标的数据库性能提升巨大，比如说oracle</span></span>
<span class="line"><span style="color:#85E89D;">poolPreparedStatements</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#6A737D;"># 要启用PSCache，必须配置大于0，当大于0时， poolPreparedStatements自动触发修改为true，</span></span>
<span class="line"><span style="color:#6A737D;"># 在Druid中，不会存在Oracle下PSCache占用内存过多的问题，</span></span>
<span class="line"><span style="color:#6A737D;"># 可以把这个数值配置大一些，比如说100</span></span>
<span class="line"><span style="color:#85E89D;">maxOpenPreparedStatements</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">20</span></span>
<span class="line"><span style="color:#6A737D;"># 连接池中的minIdle数量以内的连接，空闲时间超过minEvictableIdleTimeMillis，则会执行keepAlive操作</span></span>
<span class="line"><span style="color:#85E89D;">keepAlive</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#6A737D;"># Spring 监控，利用aop 对指定接口的执行时间，jdbc数进行记录</span></span>
<span class="line"><span style="color:#85E89D;">aop-patterns</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;com.springboot.template.dao.*&quot;</span></span>
<span class="line"><span style="color:#6A737D;">########### 启用内置过滤器（第一个 stat必须，否则监控不到SQL）##########</span></span>
<span class="line"><span style="color:#85E89D;">filters</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">stat,wall,log4j2</span></span>
<span class="line"><span style="color:#6A737D;"># 自己配置监控统计拦截的filter</span></span>
<span class="line"><span style="color:#85E89D;">filter</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 开启druiddatasource的状态监控</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">stat</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">db-type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 开启慢sql监控，超过2s 就认为是慢sql，记录到日志中</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">log-slow-sql</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">slow-sql-millis</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2000</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 日志监控，使用slf4j 进行日志输出</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">slf4j</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">statement-log-error-enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">statement-create-after-log-enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">statement-close-after-log-enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">result-set-open-after-log-enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">result-set-close-after-log-enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#6A737D;">########## 配置WebStatFilter，用于采集web关联监控的数据 ##########</span></span>
<span class="line"><span style="color:#85E89D;">web-stat-filter</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">                   </span><span style="color:#6A737D;"># 启动 StatFilter</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">url-pattern</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/*</span><span style="color:#E1E4E8;">                 </span><span style="color:#6A737D;"># 过滤所有url</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">exclusions</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 排除一些不必要的url</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">session-stat-enable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">       </span><span style="color:#6A737D;"># 开启session统计功能</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">session-stat-max-count</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># session的最大个数,默认100</span></span>
<span class="line"><span style="color:#6A737D;">########## 配置StatViewServlet（监控页面），用于展示Druid的统计信息 ##########</span></span>
<span class="line"><span style="color:#85E89D;">stat-view-servlet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">                   </span><span style="color:#6A737D;"># 启用StatViewServlet</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">url-pattern</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/druid/*</span><span style="color:#E1E4E8;">           </span><span style="color:#6A737D;"># 访问内置监控页面的路径，内置监控页面的首页是/druid/index.html</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">reset-enable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">              </span><span style="color:#6A737D;"># 不允许清空统计数据,重新计算</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">login-username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;"># 配置监控页面访问密码</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">login-password</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">123</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">allow</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">127.0.0.1</span><span style="color:#E1E4E8;">           </span><span style="color:#6A737D;"># 允许访问的地址，如果allow没有配置或者为空，则允许所有访问</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">deny</span><span style="color:#E1E4E8;">:                                        </span><span style="color:#6A737D;"># 拒绝访问的地址，deny优先于allow，如果在deny列表中，就算在allow列表中，也会被拒绝</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">########## 配置数据源 （Druid）##########</span></span>
<span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#22863A;">datasource</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#6A737D;">########## JDBC 基本配置 ##########</span></span>
<span class="line"><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">xxx</span></span>
<span class="line"><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">xxx</span></span>
<span class="line"><span style="color:#22863A;">driver-class-name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">com.mysql.cj.jdbc.Driver</span><span style="color:#24292E;">   </span><span style="color:#6A737D;"># mysql8 的连接驱动</span></span>
<span class="line"><span style="color:#22863A;">url</span><span style="color:#24292E;">: </span><span style="color:#032F62;">jdbc:mysql://127.0.0.1:3306/test?serverTimezone=Asia/Shanghai</span></span>
<span class="line"><span style="color:#22863A;">platform</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span><span style="color:#24292E;">                               </span><span style="color:#6A737D;"># 数据库类型</span></span>
<span class="line"><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">com.alibaba.druid.pool.DruidDataSource</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 指定数据源类型</span></span>
<span class="line"><span style="color:#6A737D;">########## 连接池 配置 ##########</span></span>
<span class="line"><span style="color:#22863A;">druid</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#6A737D;"># 配置初始化大小、最小、最大</span></span>
<span class="line"><span style="color:#22863A;">initial-size</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span></span>
<span class="line"><span style="color:#22863A;">minIdle</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#22863A;">max-active</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">20</span></span>
<span class="line"><span style="color:#6A737D;"># 配置获取连接等待超时的时间(单位：毫秒)</span></span>
<span class="line"><span style="color:#22863A;">max-wait</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">60000</span></span>
<span class="line"><span style="color:#6A737D;"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span></span>
<span class="line"><span style="color:#22863A;">time-between-eviction-runs-millis</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2000</span></span>
<span class="line"><span style="color:#6A737D;"># 配置一个连接在池中最小生存的时间，单位是毫秒</span></span>
<span class="line"><span style="color:#22863A;">min-evictable-idle-time-millis</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">600000</span></span>
<span class="line"><span style="color:#22863A;">max-evictable-idle-time-millis</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">900000</span></span>
<span class="line"><span style="color:#6A737D;"># 用来测试连接是否可用的SQL语句,默认值每种数据库都不相同,这是mysql</span></span>
<span class="line"><span style="color:#22863A;">validationQuery</span><span style="color:#24292E;">: </span><span style="color:#032F62;">select 1</span></span>
<span class="line"><span style="color:#6A737D;"># 应用向连接池申请连接，并且testOnBorrow为false时，连接池将会判断连接是否处于空闲状态，如果是，则验证这条连接是否可用</span></span>
<span class="line"><span style="color:#22863A;">testWhileIdle</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#6A737D;"># 如果为true，默认是false，应用向连接池申请连接时，连接池会判断这条连接是否是可用的</span></span>
<span class="line"><span style="color:#22863A;">testOnBorrow</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#6A737D;"># 如果为true（默认false），当应用使用完连接，连接池回收连接的时候会判断该连接是否还可用</span></span>
<span class="line"><span style="color:#22863A;">testOnReturn</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#6A737D;"># 是否缓存preparedStatement，也就是PSCache。PSCache对支持游标的数据库性能提升巨大，比如说oracle</span></span>
<span class="line"><span style="color:#22863A;">poolPreparedStatements</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#6A737D;"># 要启用PSCache，必须配置大于0，当大于0时， poolPreparedStatements自动触发修改为true，</span></span>
<span class="line"><span style="color:#6A737D;"># 在Druid中，不会存在Oracle下PSCache占用内存过多的问题，</span></span>
<span class="line"><span style="color:#6A737D;"># 可以把这个数值配置大一些，比如说100</span></span>
<span class="line"><span style="color:#22863A;">maxOpenPreparedStatements</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">20</span></span>
<span class="line"><span style="color:#6A737D;"># 连接池中的minIdle数量以内的连接，空闲时间超过minEvictableIdleTimeMillis，则会执行keepAlive操作</span></span>
<span class="line"><span style="color:#22863A;">keepAlive</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#6A737D;"># Spring 监控，利用aop 对指定接口的执行时间，jdbc数进行记录</span></span>
<span class="line"><span style="color:#22863A;">aop-patterns</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;com.springboot.template.dao.*&quot;</span></span>
<span class="line"><span style="color:#6A737D;">########### 启用内置过滤器（第一个 stat必须，否则监控不到SQL）##########</span></span>
<span class="line"><span style="color:#22863A;">filters</span><span style="color:#24292E;">: </span><span style="color:#032F62;">stat,wall,log4j2</span></span>
<span class="line"><span style="color:#6A737D;"># 自己配置监控统计拦截的filter</span></span>
<span class="line"><span style="color:#22863A;">filter</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 开启druiddatasource的状态监控</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">stat</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">db-type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 开启慢sql监控，超过2s 就认为是慢sql，记录到日志中</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">log-slow-sql</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">slow-sql-millis</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2000</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 日志监控，使用slf4j 进行日志输出</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">slf4j</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">statement-log-error-enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">statement-create-after-log-enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">statement-close-after-log-enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">result-set-open-after-log-enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">result-set-close-after-log-enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#6A737D;">########## 配置WebStatFilter，用于采集web关联监控的数据 ##########</span></span>
<span class="line"><span style="color:#22863A;">web-stat-filter</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">                   </span><span style="color:#6A737D;"># 启动 StatFilter</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">url-pattern</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/*</span><span style="color:#24292E;">                 </span><span style="color:#6A737D;"># 过滤所有url</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">exclusions</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 排除一些不必要的url</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">session-stat-enable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">       </span><span style="color:#6A737D;"># 开启session统计功能</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">session-stat-max-count</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">    </span><span style="color:#6A737D;"># session的最大个数,默认100</span></span>
<span class="line"><span style="color:#6A737D;">########## 配置StatViewServlet（监控页面），用于展示Druid的统计信息 ##########</span></span>
<span class="line"><span style="color:#22863A;">stat-view-servlet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">                   </span><span style="color:#6A737D;"># 启用StatViewServlet</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">url-pattern</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/druid/*</span><span style="color:#24292E;">           </span><span style="color:#6A737D;"># 访问内置监控页面的路径，内置监控页面的首页是/druid/index.html</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">reset-enable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">              </span><span style="color:#6A737D;"># 不允许清空统计数据,重新计算</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">login-username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">root</span><span style="color:#24292E;">            </span><span style="color:#6A737D;"># 配置监控页面访问密码</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">login-password</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">123</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">allow</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">127.0.0.1</span><span style="color:#24292E;">           </span><span style="color:#6A737D;"># 允许访问的地址，如果allow没有配置或者为空，则允许所有访问</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">deny</span><span style="color:#24292E;">:                                        </span><span style="color:#6A737D;"># 拒绝访问的地址，deny优先于allow，如果在deny列表中，就算在allow列表中，也会被拒绝</span></span></code></pre></div></blockquote><h4 id="配置-filter" tabindex="-1">配置 Filter <a class="header-anchor" href="#配置-filter" aria-label="Permalink to &quot;配置 Filter&quot;">​</a></h4><blockquote><p><code>spring.datasource.druid.filters=stat,wall,log4j ...</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># 配置StatFilter </span></span>
<span class="line"><span style="color:#e1e4e8;">spring.datasource.druid.filter.stat.enabled=true</span></span>
<span class="line"><span style="color:#e1e4e8;">spring.datasource.druid.filter.stat.db-type=h2</span></span>
<span class="line"><span style="color:#e1e4e8;">spring.datasource.druid.filter.stat.log-slow-sql=true</span></span>
<span class="line"><span style="color:#e1e4e8;">spring.datasource.druid.filter.stat.slow-sql-millis=2000</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"># 配置WallFilter </span></span>
<span class="line"><span style="color:#e1e4e8;">spring.datasource.druid.filter.wall.enabled=true</span></span>
<span class="line"><span style="color:#e1e4e8;">spring.datasource.druid.filter.wall.db-type=h2</span></span>
<span class="line"><span style="color:#e1e4e8;">spring.datasource.druid.filter.wall.config.delete-allow=false</span></span>
<span class="line"><span style="color:#e1e4e8;">spring.datasource.druid.filter.wall.config.drop-table-allow=false</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># 配置StatFilter </span></span>
<span class="line"><span style="color:#24292e;">spring.datasource.druid.filter.stat.enabled=true</span></span>
<span class="line"><span style="color:#24292e;">spring.datasource.druid.filter.stat.db-type=h2</span></span>
<span class="line"><span style="color:#24292e;">spring.datasource.druid.filter.stat.log-slow-sql=true</span></span>
<span class="line"><span style="color:#24292e;">spring.datasource.druid.filter.stat.slow-sql-millis=2000</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"># 配置WallFilter </span></span>
<span class="line"><span style="color:#24292e;">spring.datasource.druid.filter.wall.enabled=true</span></span>
<span class="line"><span style="color:#24292e;">spring.datasource.druid.filter.wall.db-type=h2</span></span>
<span class="line"><span style="color:#24292e;">spring.datasource.druid.filter.wall.config.delete-allow=false</span></span>
<span class="line"><span style="color:#24292e;">spring.datasource.druid.filter.wall.config.drop-table-allow=false</span></span></code></pre></div><p>目前为以下 Filter 提供了配置支持，根据（spring.datasource.druid.filter.*）进行配置。</p><ul><li>StatFilter</li><li>WallFilter</li><li>ConfigFilter</li><li>EncodingConvertFilter</li><li>Slf4jLogFilter</li><li>Log4jFilter</li><li>Log4j2Filter</li><li>CommonsLogFilter</li></ul><p>不想使用内置的 Filters，要想使自定义 Filter 配置生效需要将对应 Filter 的 enabled 设置为 true ，Druid Spring Boot Starter 默认禁用 StatFilter，可以将其 enabled 设置为 true 来启用它。</p></blockquote><h4 id="监控页面" tabindex="-1">监控页面 <a class="header-anchor" href="#监控页面" aria-label="Permalink to &quot;监控页面&quot;">​</a></h4><blockquote><p>/druid/login.html</p></blockquote><h4 id="sql监控" tabindex="-1">sql监控 <a class="header-anchor" href="#sql监控" aria-label="Permalink to &quot;sql监控&quot;">​</a></h4><blockquote><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">spring</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">datasource</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">druid</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#6A737D;">########## 配置WebStatFilter，用于采集web关联监控的数据 ##########</span></span>
<span class="line"><span style="color:#85E89D;">web-stat-filter</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">                   </span><span style="color:#6A737D;"># 启动 StatFilter</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">url-pattern</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/*</span><span style="color:#E1E4E8;">                 </span><span style="color:#6A737D;"># 过滤所有url</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">exclusions</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 排除一些不必要的url</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">session-stat-enable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">       </span><span style="color:#6A737D;"># 开启session统计功能</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">session-stat-max-count</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># session的最大个数,默认100</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#22863A;">datasource</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#22863A;">druid</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#6A737D;">########## 配置WebStatFilter，用于采集web关联监控的数据 ##########</span></span>
<span class="line"><span style="color:#22863A;">web-stat-filter</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">                   </span><span style="color:#6A737D;"># 启动 StatFilter</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">url-pattern</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/*</span><span style="color:#24292E;">                 </span><span style="color:#6A737D;"># 过滤所有url</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">exclusions</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 排除一些不必要的url</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">session-stat-enable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">       </span><span style="color:#6A737D;"># 开启session统计功能</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">session-stat-max-count</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">    </span><span style="color:#6A737D;"># session的最大个数,默认100</span></span></code></pre></div></blockquote><h4 id="spring监控" tabindex="-1">spring监控 <a class="header-anchor" href="#spring监控" aria-label="Permalink to &quot;spring监控&quot;">​</a></h4><blockquote><p>访问之后spring监控默认是没有数据的；这需要导入SprngBoot的AOP的Starter</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;org.springframework.boot&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;spring-boot-starter-aop&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;org.springframework.boot&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;spring-boot-starter-aop&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>application.yml 配置:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#Spring监控AOP切入点，如com.springboot.template.dao.*,配置多个英文逗号分隔</span></span>
<span class="line"><span style="color:#9ECBFF;">spring.datasource.druid.aop-patterns=&quot;com.springboot.template.dao.*&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#Spring监控AOP切入点，如com.springboot.template.dao.*,配置多个英文逗号分隔</span></span>
<span class="line"><span style="color:#032F62;">spring.datasource.druid.aop-patterns=&quot;com.springboot.template.dao.*&quot;</span></span></code></pre></div></blockquote><h4 id="获取-druid-的监控数据" tabindex="-1">获取 Druid 的监控数据 <a class="header-anchor" href="#获取-druid-的监控数据" aria-label="Permalink to &quot;获取 Druid 的监控数据&quot;">​</a></h4><blockquote><p>Druid 的监控数据可以在 <strong>开启 StatFilter 后</strong> ，通过 <code>DruidStatManagerFacade</code> 进行获取;</p><p><code>DruidStatManagerFacade#getDataSourceStatDataList</code> 该方法可以获取所有数据源的监控数据，</p><p>除此之外 <code>DruidStatManagerFacade</code> 还提供了一些其他方法，可以按需选择使用。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">RestController</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">RequestMapping</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/druid&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DruidStatController</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  @</span><span style="color:#F97583;">GetMapping</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/stat&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> Object </span><span style="color:#B392F0;">druidStat</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#6A737D;">// 获取数据源的监控数据</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> DruidStatManagerFacade.</span><span style="color:#B392F0;">getInstance</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">getDataSourceStatDataList</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RestController</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RequestMapping</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/druid&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DruidStatController</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  @</span><span style="color:#D73A49;">GetMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/stat&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">druidStat</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6A737D;">// 获取数据源的监控数据</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> DruidStatManagerFacade.</span><span style="color:#6F42C1;">getInstance</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getDataSourceStatDataList</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></blockquote><h2 id="_2、druid扩展" tabindex="-1">2、Druid扩展 <a class="header-anchor" href="#_2、druid扩展" aria-label="Permalink to &quot;2、Druid扩展&quot;">​</a></h2><h3 id="源码分析" tabindex="-1">源码分析 <a class="header-anchor" href="#源码分析" aria-label="Permalink to &quot;源码分析&quot;">​</a></h3><blockquote><ul><li>stat：Druid内置提供一个<code>StatFilter</code>,用于统计监控信息。</li><li>wall：Druid防御SQL注入攻击的<code>WallFilter</code>就是通过Druid的SQL Parser分析。Druid提供的SQL Parser可以在JDBC层拦截SQL做相应处理，比如说分库分表、审计等。</li><li>log4j2：这个就是 日志记录的功能，可以把sql语句打印到log4j2 供排查问题。</li></ul></blockquote>`,22),e=[o];function t(r,c,i,y,E,d){return a(),n("div",null,e)}const g=s(p,[["render",t]]);export{D as __pageData,g as default};
