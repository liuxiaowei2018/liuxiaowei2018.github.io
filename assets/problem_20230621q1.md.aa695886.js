import{_ as a,c as e,o as t,N as p}from"./chunks/framework.0799945b.js";const s="/assets/image-20230621135148765.2219ab4a.png",o="/assets/image-20230621142524374.70775419.png",i="/assets/image-20230621142055398.eb6bb8d5.png",r="/assets/image-20230621143048422.8deba086.png",c="/assets/image-20230621143256352.bba2e587.png",m="/assets/image-20230621143538652.c721ede2.png",n="/assets/image-20230621143948800.704e1947.png",l="/assets/image-20230621144531728.53774efe.png",V=JSON.parse('{"title":"生产问题排查&复盘","description":"","frontmatter":{},"headers":[],"relativePath":"problem/20230621q1.md"}'),d={name:"problem/20230621q1.md"},_=p('<h1 id="生产问题排查-复盘" tabindex="-1">生产问题排查&amp;复盘 <a class="header-anchor" href="#生产问题排查-复盘" aria-label="Permalink to &quot;生产问题排查&amp;复盘&quot;">​</a></h1><h2 id="记一次k8s-pod反复重启问题" tabindex="-1">记一次k8s pod反复重启问题 <a class="header-anchor" href="#记一次k8s-pod反复重启问题" aria-label="Permalink to &quot;记一次k8s pod反复重启问题&quot;">​</a></h2><ul><li>[20230621] 伟酱</li></ul><h3 id="问题描述" tabindex="-1">问题描述 <a class="header-anchor" href="#问题描述" aria-label="Permalink to &quot;问题描述&quot;">​</a></h3><p><img src="'+s+'" alt="image-20230621135148765"></p><blockquote><p>1.k8s pod mdm-institution-svc-latest-7ff8854b7b-5j4s2 从凌晨开始 反复 重启</p></blockquote><h3 id="问题定位" tabindex="-1">问题定位 <a class="header-anchor" href="#问题定位" aria-label="Permalink to &quot;问题定位&quot;">​</a></h3><p>1.通过告警查看 grafa 监控 查看服务 JVM</p><p><img src="'+o+'" alt="image-20230621142524374"></p><p><code>服务占用pod内存几乎打满</code></p><p>2.定位慢接口或接口请求</p><p>通过skyingwalking 发现 /departmentTrading/list 这个接口的请求相对较多</p><p><img src="'+i+'" alt="image-20230621142055398"></p><p>但接口响应是正常的</p><p>3.进入pod查看 jvm配置和 pod内存</p><p><img src="'+r+'" alt="image-20230621143048422"></p><p><img src="'+c+'" alt="image-20230621143256352"></p><p>分析一波GC 感觉也没什么问题</p><p>这样一看 似乎不是 jvm本身的问题，问题指向到运维K8s POD那边</p><p><img src="'+m+'" alt="image-20230621143538652"></p><p>CICD上看了一下这个服务的JVM配置</p><p><code>最小和最大堆内存 设置为 8G</code></p><p><img src="'+n+'" alt="image-20230621143948800"></p><p><code>JVM堆内存分配多了！</code></p><p><code>当jvm服务JVM内存+堆外内存 超过 POD内存 limit ，POD直接 kill 了</code></p><h3 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h3><p>最后重新合理分配一下 JVM 堆内存</p><blockquote><p>-Xms6144m -Xmx6144m</p></blockquote><p>重新滚动一下服务</p><p><img src="'+l+'" alt="image-20230621144531728"></p><p>监控正常 服务也没有再发生告警！</p><p><code>解决问题！</code></p><blockquote><p>堆外内存 是如何被使用的？[待续...]</p></blockquote>',33),g=[_];function h(b,u,k,q,f,P){return t(),e("div",null,g)}const T=a(d,[["render",h]]);export{V as __pageData,T as default};
