import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.8048b864.js";const o="/assets/image-20230828175011358.9873b54b.png",p="/assets/image-20230828175029668.f38a63f7.png",t="/assets/image-20230828165342844.de515852.png",e="/assets/image-20230828180256771.aeef5e32.png",c="/assets/image-20230828181006552.3930c5c8.png",r="/assets/image-20230828183542466.b57738be.png",y="/assets/image-20230828183641453.c939b740.png",i="/assets/image-20230828184056447.07e7afde.png",E="/assets/image-20230828185154938.4f2dc2a1.png",m=JSON.parse('{"title":"生产性能优化","description":"","frontmatter":{},"headers":[],"relativePath":"optimize/20230802q1.md","filePath":"optimize/20230802q1.md","lastUpdated":1697625092000}'),F={name:"optimize/20230802q1.md"},f=l(`<h1 id="生产性能优化" tabindex="-1">生产性能优化 <a class="header-anchor" href="#生产性能优化" aria-label="Permalink to &quot;生产性能优化&quot;">​</a></h1><nav class="table-of-contents"><ul><li><a href="#接口性能优化记录1">接口性能优化记录1</a><ul><li><a href="#问题-需求">问题/需求</a></li><li><a href="#性能分析">性能分析</a></li><li><a href="#解决方案">解决方案</a></li></ul></li></ul></nav><h2 id="接口性能优化记录1" tabindex="-1">接口性能优化记录1 <a class="header-anchor" href="#接口性能优化记录1" aria-label="Permalink to &quot;接口性能优化记录1&quot;">​</a></h2><h3 id="问题-需求" tabindex="-1">问题/需求 <a class="header-anchor" href="#问题-需求" aria-label="Permalink to &quot;问题/需求&quot;">​</a></h3><ol><li>【机构挂靠】sfe-affiliate-api/affiliate/open-list接口响应时间慢 <ul><li>药店挂靠，接口有点慢，451条数据，3分钟左右。</li></ul></li></ol><h3 id="性能分析" tabindex="-1">性能分析 <a class="header-anchor" href="#性能分析" aria-label="Permalink to &quot;性能分析&quot;">​</a></h3><h4 id="机构挂靠服务" tabindex="-1">机构挂靠服务 <a class="header-anchor" href="#机构挂靠服务" aria-label="Permalink to &quot;机构挂靠服务&quot;">​</a></h4><p><strong>sfe-affiliate-api</strong></p><h4 id="服务调用关系" tabindex="-1">服务调用关系 <a class="header-anchor" href="#服务调用关系" aria-label="Permalink to &quot;服务调用关系&quot;">​</a></h4><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">ApiOperation</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;开放挂靠列表&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">PostMapping</span><span style="color:#E1E4E8;">(AffiliateRouter.LIST_OPEN_AFFILIATE)</span></span>
<span class="line"><span style="color:#E1E4E8;">ActionResult</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">IPage</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">AffiliateRelationInfo</span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getAffiliateRelationOpen</span><span style="color:#E1E4E8;">(@</span><span style="color:#F97583;">SpringQueryMap</span><span style="color:#E1E4E8;"> Page page, @</span><span style="color:#F97583;">RequestBody</span><span style="color:#E1E4E8;"> @</span><span style="color:#F97583;">Validated</span><span style="color:#E1E4E8;"> AffiliateRelationOpenQO query);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ApiOperation</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;开放挂靠列表&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">PostMapping</span><span style="color:#24292E;">(AffiliateRouter.LIST_OPEN_AFFILIATE)</span></span>
<span class="line"><span style="color:#24292E;">ActionResult</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">IPage</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">AffiliateRelationInfo</span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getAffiliateRelationOpen</span><span style="color:#24292E;">(@</span><span style="color:#D73A49;">SpringQueryMap</span><span style="color:#24292E;"> Page page, @</span><span style="color:#D73A49;">RequestBody</span><span style="color:#24292E;"> @</span><span style="color:#D73A49;">Validated</span><span style="color:#24292E;"> AffiliateRelationOpenQO query);</span></span></code></pre></div><p><img src="`+o+'" alt="image-20230828175011358"></p><p><img src="'+p+'" alt="image-20230828175029668"></p><h4 id="接口监控" tabindex="-1">接口监控 <a class="header-anchor" href="#接口监控" aria-label="Permalink to &quot;接口监控&quot;">​</a></h4><p><code>近一个月接口监控</code></p><p><img src="'+t+'" alt="image-20230828165342844"></p><p><code>抓取对应日志 获取入参</code></p><p><img src="'+e+`" alt="image-20230828180256771"></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#FDAEB7;font-style:italic;">url</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">http:</span><span style="color:#6A737D;">//10.66.8.197/affiliate/open-list?pages=1&amp;size=1000,</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#FDAEB7;font-style:italic;">method:</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">POST</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#FDAEB7;font-style:italic;">headers</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">host:sfe-affiliate-api.stable:</span><span style="color:#79B8FF;">8080</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">tm-header-tenantid:df</span><span style="color:#79B8FF;">2</span><span style="color:#FDAEB7;font-style:italic;">c</span><span style="color:#79B8FF;">39341</span><span style="color:#FDAEB7;font-style:italic;">afd</span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;font-style:italic;">ea</span><span style="color:#79B8FF;">7</span><span style="color:#FDAEB7;font-style:italic;">bc</span><span style="color:#79B8FF;">5</span><span style="color:#FDAEB7;font-style:italic;">c</span><span style="color:#79B8FF;">3</span><span style="color:#FDAEB7;font-style:italic;">d</span><span style="color:#79B8FF;">7e27</span><span style="color:#FDAEB7;font-style:italic;">c</span><span style="color:#79B8FF;">33</span><span style="color:#FDAEB7;font-style:italic;">b</span><span style="color:#79B8FF;">67</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">spring-cloud-request-nonce:</span><span style="color:#79B8FF;">779104</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">spring-cloud-request-sign:F</span><span style="color:#79B8FF;">6</span><span style="color:#FDAEB7;font-style:italic;">C</span><span style="color:#79B8FF;">1</span><span style="color:#FDAEB7;font-style:italic;">B</span><span style="color:#79B8FF;">9586683</span><span style="color:#FDAEB7;font-style:italic;">C</span><span style="color:#79B8FF;">1</span><span style="color:#FDAEB7;font-style:italic;">FFCABDF</span><span style="color:#79B8FF;">912</span><span style="color:#FDAEB7;font-style:italic;">A</span><span style="color:#79B8FF;">1</span><span style="color:#FDAEB7;font-style:italic;">C</span><span style="color:#79B8FF;">57</span><span style="color:#FDAEB7;font-style:italic;">F</span><span style="color:#79B8FF;">512004</span><span style="color:#FDAEB7;font-style:italic;">F</span><span style="color:#79B8FF;">920</span><span style="color:#FDAEB7;font-style:italic;">B</span><span style="color:#79B8FF;">18</span><span style="color:#FDAEB7;font-style:italic;">CAB</span><span style="color:#79B8FF;">1</span><span style="color:#FDAEB7;font-style:italic;">BC</span><span style="color:#79B8FF;">9872</span><span style="color:#FDAEB7;font-style:italic;">B</span><span style="color:#79B8FF;">1</span><span style="color:#FDAEB7;font-style:italic;">BCC</span><span style="color:#79B8FF;">1</span><span style="color:#FDAEB7;font-style:italic;">C</span><span style="color:#79B8FF;">966</span><span style="color:#FDAEB7;font-style:italic;">D</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">traceparent:</span><span style="color:#79B8FF;">00</span><span style="color:#FDAEB7;font-style:italic;">-af</span><span style="color:#79B8FF;">99</span><span style="color:#FDAEB7;font-style:italic;">aca</span><span style="color:#79B8FF;">185386</span><span style="color:#FDAEB7;font-style:italic;">f</span><span style="color:#79B8FF;">2263</span><span style="color:#FDAEB7;font-style:italic;">a</span><span style="color:#79B8FF;">7e52</span><span style="color:#FDAEB7;font-style:italic;">bcdf</span><span style="color:#79B8FF;">1536</span><span style="color:#FDAEB7;font-style:italic;">c</span><span style="color:#79B8FF;">-66</span><span style="color:#FDAEB7;font-style:italic;">dd</span><span style="color:#79B8FF;">6081528</span><span style="color:#FDAEB7;font-style:italic;">be</span><span style="color:#79B8FF;">55</span><span style="color:#FDAEB7;font-style:italic;">a</span><span style="color:#79B8FF;">-00</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">content-type:application/json;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">charset=utf</span><span style="color:#79B8FF;">-8</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">x-request-id:</span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;font-style:italic;">d</span><span style="color:#79B8FF;">013</span><span style="color:#FDAEB7;font-style:italic;">d</span><span style="color:#79B8FF;">8</span><span style="color:#FDAEB7;font-style:italic;">c</span><span style="color:#79B8FF;">-0</span><span style="color:#FDAEB7;font-style:italic;">de</span><span style="color:#79B8FF;">3-41</span><span style="color:#FDAEB7;font-style:italic;">cb</span><span style="color:#79B8FF;">-8</span><span style="color:#FDAEB7;font-style:italic;">f</span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;font-style:italic;">c</span><span style="color:#79B8FF;">-6638</span><span style="color:#FDAEB7;font-style:italic;">ddcdaa</span><span style="color:#79B8FF;">40</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">x-envoy-attempt-count:</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">x-envoy-original-path:/gw/open/sfe-affiliate-api/affiliate/open-list?pages=</span><span style="color:#79B8FF;">1</span><span style="color:#FDAEB7;font-style:italic;">&amp;size=</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">content-length:</span><span style="color:#79B8FF;">72</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">forwarded:proto=http;host=</span><span style="color:#79B8FF;">10.66</span><span style="color:#FDAEB7;font-style:italic;">.</span><span style="color:#79B8FF;">8.197</span><span style="color:#FDAEB7;font-style:italic;">;for=</span><span style="color:#9ECBFF;">&quot;192.168.84.177:37060&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">x-forwarded-client-cert:By=spiffe:</span><span style="color:#6A737D;">//cluster.local/ns/stable/sa/default;Hash=0b0446fbc3606fe738b8f314c12f79d36238e143cb8b2c1644b9c00f4e3d976f;Subject=&quot;&quot;;URI=spiffe://cluster.local/ns/stable/sa/default,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">x-forwarded-proto:http</span><span style="color:#E1E4E8;">,</span><span style="color:#FDAEB7;font-style:italic;">http</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">x-forwarded-prefix:/open/sfe-affiliate-api</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">x-forwarded-port:</span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">x-forwarded-host:</span><span style="color:#79B8FF;">10.66</span><span style="color:#FDAEB7;font-style:italic;">.</span><span style="color:#79B8FF;">8.197</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">user-agent:ReactorNetty/</span><span style="color:#79B8FF;">1.0</span><span style="color:#FDAEB7;font-style:italic;">.</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#FDAEB7;font-style:italic;">accept:*</span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">	],</span></span>
<span class="line"><span style="color:#6A737D;">	body: {&quot;pages&quot;:1,&quot;size&quot;:1000,&quot;periodIds&quot;:[&quot;8ac2ae5e82fe851e0187b2238fa0022e&quot;]},</span></span>
<span class="line"><span style="color:#6A737D;">	protocol: HTTP/1.1</span></span>
<span class="line"><span style="color:#6A737D;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#B31D28;font-style:italic;">url</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">http:</span><span style="color:#6A737D;">//10.66.8.197/affiliate/open-list?pages=1&amp;size=1000,</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#B31D28;font-style:italic;">method:</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">POST</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#B31D28;font-style:italic;">headers</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">host:sfe-affiliate-api.stable:</span><span style="color:#005CC5;">8080</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">tm-header-tenantid:df</span><span style="color:#005CC5;">2</span><span style="color:#B31D28;font-style:italic;">c</span><span style="color:#005CC5;">39341</span><span style="color:#B31D28;font-style:italic;">afd</span><span style="color:#005CC5;">4</span><span style="color:#B31D28;font-style:italic;">ea</span><span style="color:#005CC5;">7</span><span style="color:#B31D28;font-style:italic;">bc</span><span style="color:#005CC5;">5</span><span style="color:#B31D28;font-style:italic;">c</span><span style="color:#005CC5;">3</span><span style="color:#B31D28;font-style:italic;">d</span><span style="color:#005CC5;">7e27</span><span style="color:#B31D28;font-style:italic;">c</span><span style="color:#005CC5;">33</span><span style="color:#B31D28;font-style:italic;">b</span><span style="color:#005CC5;">67</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">spring-cloud-request-nonce:</span><span style="color:#005CC5;">779104</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">spring-cloud-request-sign:F</span><span style="color:#005CC5;">6</span><span style="color:#B31D28;font-style:italic;">C</span><span style="color:#005CC5;">1</span><span style="color:#B31D28;font-style:italic;">B</span><span style="color:#005CC5;">9586683</span><span style="color:#B31D28;font-style:italic;">C</span><span style="color:#005CC5;">1</span><span style="color:#B31D28;font-style:italic;">FFCABDF</span><span style="color:#005CC5;">912</span><span style="color:#B31D28;font-style:italic;">A</span><span style="color:#005CC5;">1</span><span style="color:#B31D28;font-style:italic;">C</span><span style="color:#005CC5;">57</span><span style="color:#B31D28;font-style:italic;">F</span><span style="color:#005CC5;">512004</span><span style="color:#B31D28;font-style:italic;">F</span><span style="color:#005CC5;">920</span><span style="color:#B31D28;font-style:italic;">B</span><span style="color:#005CC5;">18</span><span style="color:#B31D28;font-style:italic;">CAB</span><span style="color:#005CC5;">1</span><span style="color:#B31D28;font-style:italic;">BC</span><span style="color:#005CC5;">9872</span><span style="color:#B31D28;font-style:italic;">B</span><span style="color:#005CC5;">1</span><span style="color:#B31D28;font-style:italic;">BCC</span><span style="color:#005CC5;">1</span><span style="color:#B31D28;font-style:italic;">C</span><span style="color:#005CC5;">966</span><span style="color:#B31D28;font-style:italic;">D</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">traceparent:</span><span style="color:#005CC5;">00</span><span style="color:#B31D28;font-style:italic;">-af</span><span style="color:#005CC5;">99</span><span style="color:#B31D28;font-style:italic;">aca</span><span style="color:#005CC5;">185386</span><span style="color:#B31D28;font-style:italic;">f</span><span style="color:#005CC5;">2263</span><span style="color:#B31D28;font-style:italic;">a</span><span style="color:#005CC5;">7e52</span><span style="color:#B31D28;font-style:italic;">bcdf</span><span style="color:#005CC5;">1536</span><span style="color:#B31D28;font-style:italic;">c</span><span style="color:#005CC5;">-66</span><span style="color:#B31D28;font-style:italic;">dd</span><span style="color:#005CC5;">6081528</span><span style="color:#B31D28;font-style:italic;">be</span><span style="color:#005CC5;">55</span><span style="color:#B31D28;font-style:italic;">a</span><span style="color:#005CC5;">-00</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">content-type:application/json;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">charset=utf</span><span style="color:#005CC5;">-8</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">x-request-id:</span><span style="color:#005CC5;">4</span><span style="color:#B31D28;font-style:italic;">d</span><span style="color:#005CC5;">013</span><span style="color:#B31D28;font-style:italic;">d</span><span style="color:#005CC5;">8</span><span style="color:#B31D28;font-style:italic;">c</span><span style="color:#005CC5;">-0</span><span style="color:#B31D28;font-style:italic;">de</span><span style="color:#005CC5;">3-41</span><span style="color:#B31D28;font-style:italic;">cb</span><span style="color:#005CC5;">-8</span><span style="color:#B31D28;font-style:italic;">f</span><span style="color:#005CC5;">4</span><span style="color:#B31D28;font-style:italic;">c</span><span style="color:#005CC5;">-6638</span><span style="color:#B31D28;font-style:italic;">ddcdaa</span><span style="color:#005CC5;">40</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">x-envoy-attempt-count:</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">x-envoy-original-path:/gw/open/sfe-affiliate-api/affiliate/open-list?pages=</span><span style="color:#005CC5;">1</span><span style="color:#B31D28;font-style:italic;">&amp;size=</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">content-length:</span><span style="color:#005CC5;">72</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">forwarded:proto=http;host=</span><span style="color:#005CC5;">10.66</span><span style="color:#B31D28;font-style:italic;">.</span><span style="color:#005CC5;">8.197</span><span style="color:#B31D28;font-style:italic;">;for=</span><span style="color:#032F62;">&quot;192.168.84.177:37060&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">x-forwarded-client-cert:By=spiffe:</span><span style="color:#6A737D;">//cluster.local/ns/stable/sa/default;Hash=0b0446fbc3606fe738b8f314c12f79d36238e143cb8b2c1644b9c00f4e3d976f;Subject=&quot;&quot;;URI=spiffe://cluster.local/ns/stable/sa/default,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">x-forwarded-proto:http</span><span style="color:#24292E;">,</span><span style="color:#B31D28;font-style:italic;">http</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">x-forwarded-prefix:/open/sfe-affiliate-api</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">x-forwarded-port:</span><span style="color:#005CC5;">80</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">x-forwarded-host:</span><span style="color:#005CC5;">10.66</span><span style="color:#B31D28;font-style:italic;">.</span><span style="color:#005CC5;">8.197</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">user-agent:ReactorNetty/</span><span style="color:#005CC5;">1.0</span><span style="color:#B31D28;font-style:italic;">.</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#B31D28;font-style:italic;">accept:*</span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">	],</span></span>
<span class="line"><span style="color:#6A737D;">	body: {&quot;pages&quot;:1,&quot;size&quot;:1000,&quot;periodIds&quot;:[&quot;8ac2ae5e82fe851e0187b2238fa0022e&quot;]},</span></span>
<span class="line"><span style="color:#6A737D;">	protocol: HTTP/1.1</span></span>
<span class="line"><span style="color:#6A737D;">}</span></span></code></pre></div><h4 id="接口性能" tabindex="-1">接口性能 <a class="header-anchor" href="#接口性能" aria-label="Permalink to &quot;接口性能&quot;">​</a></h4><p><img src="`+c+`" alt="image-20230828181006552"></p><h4 id="采用-arthas排查接口耗时" tabindex="-1">采用 Arthas排查接口耗时 <a class="header-anchor" href="#采用-arthas排查接口耗时" aria-label="Permalink to &quot;采用 Arthas排查接口耗时&quot;">​</a></h4><table><thead><tr><th>步骤</th><th>执行</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>marketing-sfe-affiliate-api-latest-558fbf674-lkjw4</td><td>pod</td></tr><tr><td>2</td><td>kubectl exec -it marketing-sfe-affiliate-api-latest-558fbf674-lkjw4 -c marketing-sfe-affiliate-api -n stable -- /bin/sh</td><td></td></tr><tr><td>3</td><td>wget <a href="https://alibaba.github.io/arthas/arthas-boot.jar" target="_blank" rel="noreferrer">https://alibaba.github.io/arthas/arthas-boot.jar</a></td><td>arthas</td></tr><tr><td>4</td><td>java -jar arthas-boot.jar</td><td></td></tr></tbody></table><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">curl --location &#39;localhost:</span><span style="color:#79B8FF;">8080</span><span style="color:#E1E4E8;">/affiliate/open-list?pages=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">&amp;size=</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">&#39; \\</span></span>
<span class="line"><span style="color:#E1E4E8;">--header &#39;tm-header-tenantid: df</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">c</span><span style="color:#79B8FF;">39341</span><span style="color:#E1E4E8;">afd</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">ea</span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;">bc</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">c</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">d</span><span style="color:#79B8FF;">7e27</span><span style="color:#E1E4E8;">c</span><span style="color:#79B8FF;">33</span><span style="color:#E1E4E8;">b</span><span style="color:#79B8FF;">67</span><span style="color:#E1E4E8;">&#39; \\</span></span>
<span class="line"><span style="color:#E1E4E8;">--header &#39;spring-cloud-request-nonce: </span><span style="color:#79B8FF;">779104</span><span style="color:#E1E4E8;">&#39; \\</span></span>
<span class="line"><span style="color:#E1E4E8;">--header &#39;spring-cloud-request-sign: F</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">C</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">B</span><span style="color:#79B8FF;">9586683</span><span style="color:#E1E4E8;">C</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">FFCABDF</span><span style="color:#79B8FF;">912</span><span style="color:#E1E4E8;">A</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">C</span><span style="color:#79B8FF;">57</span><span style="color:#E1E4E8;">F</span><span style="color:#79B8FF;">512004</span><span style="color:#E1E4E8;">F</span><span style="color:#79B8FF;">920</span><span style="color:#E1E4E8;">B</span><span style="color:#79B8FF;">18</span><span style="color:#E1E4E8;">CAB</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">BC</span><span style="color:#79B8FF;">9872</span><span style="color:#E1E4E8;">B</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">BCC</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">C</span><span style="color:#79B8FF;">966</span><span style="color:#E1E4E8;">D&#39; \\</span></span>
<span class="line"><span style="color:#E1E4E8;">--header &#39;traceparent: </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;">-af</span><span style="color:#79B8FF;">99</span><span style="color:#E1E4E8;">aca</span><span style="color:#79B8FF;">185386</span><span style="color:#E1E4E8;">f</span><span style="color:#79B8FF;">2263</span><span style="color:#E1E4E8;">a</span><span style="color:#79B8FF;">7e52</span><span style="color:#E1E4E8;">bcdf</span><span style="color:#79B8FF;">1536</span><span style="color:#E1E4E8;">c</span><span style="color:#79B8FF;">-66</span><span style="color:#E1E4E8;">dd</span><span style="color:#79B8FF;">6081528</span><span style="color:#E1E4E8;">be</span><span style="color:#79B8FF;">55</span><span style="color:#E1E4E8;">a</span><span style="color:#79B8FF;">-00</span><span style="color:#E1E4E8;">&#39; \\</span></span>
<span class="line"><span style="color:#E1E4E8;">--header &#39;content-type: application/json; charset=utf</span><span style="color:#79B8FF;">-8</span><span style="color:#E1E4E8;">&#39; \\</span></span>
<span class="line"><span style="color:#E1E4E8;">--header &#39;x-request-id: </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">d</span><span style="color:#79B8FF;">013</span><span style="color:#E1E4E8;">d</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">c</span><span style="color:#79B8FF;">-0</span><span style="color:#E1E4E8;">de</span><span style="color:#79B8FF;">3-41</span><span style="color:#E1E4E8;">cb</span><span style="color:#79B8FF;">-8</span><span style="color:#E1E4E8;">f</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">c</span><span style="color:#79B8FF;">-6638</span><span style="color:#E1E4E8;">ddcdaa</span><span style="color:#79B8FF;">40</span><span style="color:#E1E4E8;">&#39; \\</span></span>
<span class="line"><span style="color:#E1E4E8;">--header &#39;x-envoy-attempt-count: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">&#39; \\</span></span>
<span class="line"><span style="color:#E1E4E8;">--header &#39;content-length: </span><span style="color:#79B8FF;">72</span><span style="color:#E1E4E8;">&#39; \\</span></span>
<span class="line"><span style="color:#E1E4E8;">--header &#39;Cookie: JSESSIONID=</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">D</span><span style="color:#79B8FF;">81</span><span style="color:#E1E4E8;">FAFACD</span><span style="color:#79B8FF;">926</span><span style="color:#E1E4E8;">C</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">A</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">D</span><span style="color:#79B8FF;">036</span><span style="color:#E1E4E8;">F</span><span style="color:#79B8FF;">2784388</span><span style="color:#E1E4E8;">BFC; XSRF-TOKEN=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">fd</span><span style="color:#79B8FF;">2143</span><span style="color:#E1E4E8;">d</span><span style="color:#79B8FF;">-5210-4</span><span style="color:#E1E4E8;">fcd-a</span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;">f</span><span style="color:#79B8FF;">-434</span><span style="color:#E1E4E8;">d</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">a</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">b</span><span style="color:#79B8FF;">690</span><span style="color:#E1E4E8;">d&#39; \\</span></span>
<span class="line"><span style="color:#E1E4E8;">--data &#39;{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;pages&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;size&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;periodIds&quot;</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;8ac2ae5e82fe851e0187b2238fa0022e&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    ]</span></span>
<span class="line"><span style="color:#E1E4E8;">}&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">curl --location &#39;localhost:</span><span style="color:#005CC5;">8080</span><span style="color:#24292E;">/affiliate/open-list?pages=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">&amp;size=</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">&#39; \\</span></span>
<span class="line"><span style="color:#24292E;">--header &#39;tm-header-tenantid: df</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">c</span><span style="color:#005CC5;">39341</span><span style="color:#24292E;">afd</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">ea</span><span style="color:#005CC5;">7</span><span style="color:#24292E;">bc</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">c</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">d</span><span style="color:#005CC5;">7e27</span><span style="color:#24292E;">c</span><span style="color:#005CC5;">33</span><span style="color:#24292E;">b</span><span style="color:#005CC5;">67</span><span style="color:#24292E;">&#39; \\</span></span>
<span class="line"><span style="color:#24292E;">--header &#39;spring-cloud-request-nonce: </span><span style="color:#005CC5;">779104</span><span style="color:#24292E;">&#39; \\</span></span>
<span class="line"><span style="color:#24292E;">--header &#39;spring-cloud-request-sign: F</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">C</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">B</span><span style="color:#005CC5;">9586683</span><span style="color:#24292E;">C</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">FFCABDF</span><span style="color:#005CC5;">912</span><span style="color:#24292E;">A</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">C</span><span style="color:#005CC5;">57</span><span style="color:#24292E;">F</span><span style="color:#005CC5;">512004</span><span style="color:#24292E;">F</span><span style="color:#005CC5;">920</span><span style="color:#24292E;">B</span><span style="color:#005CC5;">18</span><span style="color:#24292E;">CAB</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">BC</span><span style="color:#005CC5;">9872</span><span style="color:#24292E;">B</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">BCC</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">C</span><span style="color:#005CC5;">966</span><span style="color:#24292E;">D&#39; \\</span></span>
<span class="line"><span style="color:#24292E;">--header &#39;traceparent: </span><span style="color:#005CC5;">00</span><span style="color:#24292E;">-af</span><span style="color:#005CC5;">99</span><span style="color:#24292E;">aca</span><span style="color:#005CC5;">185386</span><span style="color:#24292E;">f</span><span style="color:#005CC5;">2263</span><span style="color:#24292E;">a</span><span style="color:#005CC5;">7e52</span><span style="color:#24292E;">bcdf</span><span style="color:#005CC5;">1536</span><span style="color:#24292E;">c</span><span style="color:#005CC5;">-66</span><span style="color:#24292E;">dd</span><span style="color:#005CC5;">6081528</span><span style="color:#24292E;">be</span><span style="color:#005CC5;">55</span><span style="color:#24292E;">a</span><span style="color:#005CC5;">-00</span><span style="color:#24292E;">&#39; \\</span></span>
<span class="line"><span style="color:#24292E;">--header &#39;content-type: application/json; charset=utf</span><span style="color:#005CC5;">-8</span><span style="color:#24292E;">&#39; \\</span></span>
<span class="line"><span style="color:#24292E;">--header &#39;x-request-id: </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">d</span><span style="color:#005CC5;">013</span><span style="color:#24292E;">d</span><span style="color:#005CC5;">8</span><span style="color:#24292E;">c</span><span style="color:#005CC5;">-0</span><span style="color:#24292E;">de</span><span style="color:#005CC5;">3-41</span><span style="color:#24292E;">cb</span><span style="color:#005CC5;">-8</span><span style="color:#24292E;">f</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">c</span><span style="color:#005CC5;">-6638</span><span style="color:#24292E;">ddcdaa</span><span style="color:#005CC5;">40</span><span style="color:#24292E;">&#39; \\</span></span>
<span class="line"><span style="color:#24292E;">--header &#39;x-envoy-attempt-count: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">&#39; \\</span></span>
<span class="line"><span style="color:#24292E;">--header &#39;content-length: </span><span style="color:#005CC5;">72</span><span style="color:#24292E;">&#39; \\</span></span>
<span class="line"><span style="color:#24292E;">--header &#39;Cookie: JSESSIONID=</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">D</span><span style="color:#005CC5;">81</span><span style="color:#24292E;">FAFACD</span><span style="color:#005CC5;">926</span><span style="color:#24292E;">C</span><span style="color:#005CC5;">8</span><span style="color:#24292E;">A</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">D</span><span style="color:#005CC5;">036</span><span style="color:#24292E;">F</span><span style="color:#005CC5;">2784388</span><span style="color:#24292E;">BFC; XSRF-TOKEN=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">fd</span><span style="color:#005CC5;">2143</span><span style="color:#24292E;">d</span><span style="color:#005CC5;">-5210-4</span><span style="color:#24292E;">fcd-a</span><span style="color:#005CC5;">15</span><span style="color:#24292E;">f</span><span style="color:#005CC5;">-434</span><span style="color:#24292E;">d</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">a</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">b</span><span style="color:#005CC5;">690</span><span style="color:#24292E;">d&#39; \\</span></span>
<span class="line"><span style="color:#24292E;">--data &#39;{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;pages&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;size&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;periodIds&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;8ac2ae5e82fe851e0187b2238fa0022e&quot;</span></span>
<span class="line"><span style="color:#24292E;">    ]</span></span>
<span class="line"><span style="color:#24292E;">}&#39;</span></span></code></pre></div><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">trace com.taimei.sfe.affiliate.api.facade.AffiliateRelationFacade getAffiliateRelationByPage  -n </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;"> --skipJDKMethod </span><span style="color:#79B8FF;">false</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">trace com.taimei.sfe.affiliate.api.facade.AffiliateRelationFacade getAffiliateRelationByPage  -n </span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> --skipJDKMethod </span><span style="color:#005CC5;">false</span></span></code></pre></div><p><img src="`+r+'" alt="image-20230828183542466"></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">trace com.taimei.sfe.core.affiliate.biz.AffiliateRelationService getAffiliateRelationByPage  -n </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;"> --skipJDKMethod </span><span style="color:#79B8FF;">false</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">trace com.taimei.sfe.core.affiliate.biz.AffiliateRelationService getAffiliateRelationByPage  -n </span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> --skipJDKMethod </span><span style="color:#005CC5;">false</span></span></code></pre></div><p><img src="'+y+'" alt="image-20230828183641453"></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">trace com.taimei.sfe.core.affiliate.biz.AffiliateRelationService fillDisplayData  -n </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;"> --skipJDKMethod </span><span style="color:#79B8FF;">false</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">trace com.taimei.sfe.core.affiliate.biz.AffiliateRelationService fillDisplayData  -n </span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> --skipJDKMethod </span><span style="color:#005CC5;">false</span></span></code></pre></div><p><img src="'+i+'" alt="image-20230828184056447"></p><p><img src="'+E+'" alt="image-20230828185154938"></p><h3 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h3><p><strong>批量查询字典数据后赋值，避免在大循环体内批量调用外部接口</strong></p>',32),C=[f];function B(d,D,h,u,g,A){return a(),n("div",null,C)}const q=s(F,[["render",B]]);export{m as __pageData,q as default};
