<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java JVM | liuxiaowei</title>
    <meta name="description" content="liuxiaowei">
    <link rel="preload stylesheet" href="/assets/style.cb03d06c.css" as="style">
    <link rel="modulepreload" href="/assets/app.467f35a9.js">
    <link rel="modulepreload" href="/assets/study_java_JVM.md.c51125c8.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5211c0b1><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5211c0b1 data-v-8c0a9870><div class="VPNavBar has-sidebar" data-v-8c0a9870 data-v-1bbed88e><div class="container" data-v-1bbed88e><div class="VPNavBarTitle has-sidebar" data-v-1bbed88e data-v-d5925166><a class="title" href="/" data-v-d5925166><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-6db2186b><!--]--><!--[-->liuxiaowei<!--]--><!--[--><!--]--></a></div><div class="content" data-v-1bbed88e><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-1bbed88e data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://gitee.com/liuxiaowei2018" target="_blank" rel="noreferrer" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->gitee<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-1bbed88e data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-1bbed88e data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/liuxiaowei2018" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="..." target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Dribbble</title><path d="M12...6.38z"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-1bbed88e data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e4361c82><div class="item social-links" data-v-e4361c82><div class="VPSocialLinks social-links-list" data-v-e4361c82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/liuxiaowei2018" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="..." target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Dribbble</title><path d="M12...6.38z"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-1bbed88e data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-5211c0b1 data-v-b6162a8b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b6162a8b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b6162a8b><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b6162a8b>Menu</span></button><a class="top-link" href="#" data-v-b6162a8b> Return to top </a></div><aside class="VPSidebar" data-v-5211c0b1 data-v-a186aa16><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-a186aa16><span class="visually-hidden" id="sidebar-aria-label" data-v-a186aa16> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>JavaSe</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/java/Java%E5%9F%BA%E7%A1%80.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Java基础</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/java/Java%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Java响应式编程</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/java/Java8%E6%96%B0%E7%89%B9%E6%80%A7.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Java8新特性</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/java/JUC.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Java多线程</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link active" href="/study/java/JVM.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>JVM调优</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>数据结构&算法</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/algorithm/%E6%95%B0%E7%BB%84%E4%B8%8E%E9%93%BE%E8%A1%A8.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>数组与链表</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/algorithm/%E9%98%9F%E5%88%97%E4%B8%8E%E6%A0%88.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>队列与栈</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/algorithm/%E4%BA%8C%E5%8F%89%E6%A0%91.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>二叉树</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/algorithm/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>动态规划</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>数据结构设计</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>CRUD</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/orm/Mybatis.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Mybatis</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/orm/MybatisPlus.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>MybatisPlus</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/orm/JPA.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>JPA</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/orm/Druid.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Druid</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>NoSQL&SQL</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/database/Mysql.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Mysql</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/MysqlExtend.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>MySQL扩展</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/Redis.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Redis</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/Memcached.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Memcached</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/Elasticsearch.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Elasticsearch</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/MongoDB.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>MongoDB</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/Oracle.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Oracle</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/Clickhouse.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Clickhouse</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/PostgreSQL.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>PostgreSQL</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/FastDFS.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>FastDFS</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/HBase.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>HBase</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/database/PostgreSQL.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>PostgreSQL</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>Spring系列</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/framework/Spring.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Spring</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/framework/SpringBoot.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>SpringBoot</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>SpringCloud</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/springcloud/index.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>导航</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>SpringCloudAlibaba</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/alibaba/index.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>导航</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>深入浅出中间件</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/middleware/Mq.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>消息队列</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/middleware/Flow.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>工作流</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/middleware/Server.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>服务器</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/middleware/ShardingJdbc.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>分库分表</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/middleware/SaToken.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>权限框架</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/middleware/Canal.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>ETL框架</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>测试工具</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/test/index.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>导航</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>工具类库</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/util/Hutool.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Hutool</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/util/Guava.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Guava</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/util/Mapstruct.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Mapstruct</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/util/Swagger.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Swagger</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/util/TLog.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>TLog</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/util/Forest.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Forest</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/util/Easyexcel.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Easyexcel</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/util/AsyncTool.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>AsyncTool</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/util/Vavr.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Vavr</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/study/util/Feilong.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>Feilong</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>大数据</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/study/bigdata/index.html" style="padding-left:0px;" tabindex="-1" data-v-ad00a267 data-v-3c355974><!--[--><span class="link-text" data-v-ad00a267>导航</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5211c0b1 data-v-296cfad2><div class="VPDoc has-sidebar has-aside" data-v-296cfad2 data-v-cfb513e0><div class="container" data-v-cfb513e0><div class="aside" data-v-cfb513e0><div class="aside-curtain" data-v-cfb513e0></div><div class="aside-container" data-v-cfb513e0><div class="aside-content" data-v-cfb513e0><div class="VPDocAside" data-v-cfb513e0 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-cfb513e0><div class="content-container" data-v-cfb513e0><!--[--><!--]--><main class="main" data-v-cfb513e0><div style="position:relative;" class="vp-doc _study_java_JVM" data-v-cfb513e0><div><h1 id="java-jvm" tabindex="-1">Java JVM <a class="header-anchor" href="#java-jvm" aria-hidden="true">#</a></h1><h2 id="基础知识" tabindex="-1">基础知识 <a class="header-anchor" href="#基础知识" aria-hidden="true">#</a></h2><blockquote><p>C/C++(关键)</p><p>微机原理与接口技术</p><p>计算机组成原理</p><p>操作系统</p><p>数据结构与算法</p><p>编译原理</p><p>《深入理解Java虚拟机 第三版》</p></blockquote><p><img src="/assets/image-20220326114005990.22778ed1.png" alt="image-20220326114005990"></p><p><img src="/assets/image-20220326114042857.cd840665.png" alt="image-20220326114042857"></p><blockquote><p>Java程序之所以能够实现跨平台，本质就是因为它是运行在虚拟机之上的，而不同平台只需要安装对应平台的Java虚拟机即可运行（在JRE中包含），所有的Java程序都采用统一的标准，在任何平台编译出来的字节码文件(.class)也是同样的，最后实际上是将编译后的字节码交给JVM处理执行。</p><p>除了Java以外，还有多种JVM语言，比如Kotlin、Groovy等，它们的语法虽然和Java不一样，但是最终编译得到的字节码文件，和Java是同样的规范，同样可以交给JVM处理。</p></blockquote><blockquote><p>Java利用了JVM，它提供了很好的平台无关性（当然，JVM本身是不跨平台的），我们的Java程序编译之后，并不是可以由平台直接运行的程序，而是由JVM运行，同时，JVM（如HotSpot虚拟机），实际上采用的是<code>基于栈的指令集架构</code>，它并没有依赖于寄存器，而是更多的利用操作栈来完成，这样不仅设计和实现起来更简单，并且也能够更加方便地实现跨平台，不太依赖于硬件的支持。</p></blockquote><h4 id="举例-对一个类反编译" tabindex="-1">举例：对一个类反编译 <a class="header-anchor" href="#举例-对一个类反编译" aria-hidden="true">#</a></h4><blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">test</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> c </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> c</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>javap -v Main.class</code></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">public int test();</span></span>
<span class="line"><span style="color:#A6ACCD;">   descriptor: ()I</span></span>
<span class="line"><span style="color:#A6ACCD;">   flags: ACC_PUBLIC</span></span>
<span class="line"><span style="color:#A6ACCD;">   Code:</span></span>
<span class="line"><span style="color:#A6ACCD;">     stack=2, locals=4, args_size=1</span></span>
<span class="line"><span style="color:#A6ACCD;">        0: bipush        10</span></span>
<span class="line"><span style="color:#A6ACCD;">        2: istore_1</span></span>
<span class="line"><span style="color:#A6ACCD;">        3: bipush        20</span></span>
<span class="line"><span style="color:#A6ACCD;">        5: istore_2</span></span>
<span class="line"><span style="color:#A6ACCD;">        6: iload_1</span></span>
<span class="line"><span style="color:#A6ACCD;">        7: iload_2</span></span>
<span class="line"><span style="color:#A6ACCD;">        8: iadd</span></span>
<span class="line"><span style="color:#A6ACCD;">        9: istore_3</span></span>
<span class="line"><span style="color:#A6ACCD;">       10: iload_3</span></span>
<span class="line"><span style="color:#A6ACCD;">       11: ireturn</span></span>
<span class="line"><span style="color:#A6ACCD;">     LineNumberTable:</span></span>
<span class="line"><span style="color:#A6ACCD;">       line 5: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">       line 6: 3</span></span>
<span class="line"><span style="color:#A6ACCD;">       line 7: 6</span></span>
<span class="line"><span style="color:#A6ACCD;">       line 8: 10</span></span>
<span class="line"><span style="color:#A6ACCD;">     LocalVariableTable:</span></span>
<span class="line"><span style="color:#A6ACCD;">       Start  Length  Slot  Name   Signature</span></span>
<span class="line"><span style="color:#A6ACCD;">           0      12     0  this   Lcom/test/Main;</span></span>
<span class="line"><span style="color:#A6ACCD;">           3       9     1     a   I</span></span>
<span class="line"><span style="color:#A6ACCD;">           6       6     2     b   I</span></span>
<span class="line"><span style="color:#A6ACCD;">          10       2     3     c   I</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>java文件编译之后，也会生成类似于C语言那样的汇编指令，但是这些命令都是交给JVM去执行的命令（实际上虚拟机提供了一个类似于物理机的运行环境，也有程序计数器之类的东西），最下方存放的是本地变量（局部变量）表，表示此方法中出现的本地变量，实际上this也在其中，所以我们才能在非静态方法中使用<code>this</code>关键字，在最上方标记了方法的返回值类型、访问权限等。</p><ul><li>bipush 将单字节的常量值推到栈顶</li><li>istore_1 将栈顶的int类型数值存入到第二个本地变量</li><li>istore_2 将栈顶的int类型数值存入到第三个本地变量</li><li>istore_3 将栈顶的int类型数值存入到第四个本地变量</li><li>iload_1 将第二个本地变量推向栈顶</li><li>iload_2 将第三个本地变量推向栈顶</li><li>iload_3 将第四个本地变量推向栈顶</li><li>iadd 将栈顶的两个int类型变量相加，并将结果压入栈顶</li><li>ireturn 方法的返回操作</li></ul><p>JVM运行字节码时，所有的操作基本都是围绕两种数据结构，一种是堆栈（本质是栈结构），还有一种是队列，如果JVM执行某条指令时，该指令需要对数据进行操作，那么被操作的数据在指令执行前，必须要压到堆栈上，JVM会自动将栈顶数据作为操作数。如果堆栈上的数据需要暂时保存起来时，那么它就会被存储到局部变量队列上。</p><p>我们从第一条指令来依次向下解读，显示方法相关属性：</p><p>descriptor: ()I //参数以及返回值类型，()I就表示没有形式参数，返回值为基本类型int flags: ACC_PUBLIC //public访问权限 Code: stack=2, locals=4, args_size=1 //stack表示要用到的最大栈深度，本地变量数，堆栈上最大对象数量（这里指的是this）</p><p>接着我们来看指令：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">0: bipush        10     //0是程序偏移地址，然后是指令，最后是操作数</span></span>
<span class="line"><span style="color:#A6ACCD;">2: istore_1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>这一步操作实际上就是使用<code>bipush</code>将10推向栈顶，接着使用<code>istore_1</code>将当前栈顶数据存放到第二个局部变量中，也就是a，所以这一步执行的是<code>int a = 10</code>操作。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">3: bipush        20</span></span>
<span class="line"><span style="color:#A6ACCD;">5: istore_2</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>同上，这里执行的是<code>int b = 20</code>操作。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">6: iload_1</span></span>
<span class="line"><span style="color:#A6ACCD;">7: iload_2</span></span>
<span class="line"><span style="color:#A6ACCD;">8: iadd</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>这里是将第二和第三个局部变量放到栈中，也就是取a和b的值到栈中，最后<code>iadd</code>操作将栈中的两个值相加，结果依然放在栈顶。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">9: istore_3</span></span>
<span class="line"><span style="color:#A6ACCD;">10: iload_3</span></span>
<span class="line"><span style="color:#A6ACCD;">11: ireturn</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>将栈顶数据存放到第四个局部变量中，也就是c，执行的是<code>int c = 30</code>，最后取出c的值放入栈顶，使用<code>ireturn</code>返回栈顶值，也就是方法的返回值。</p><p>至此，方法执行完毕。</p><p>实际上我们发现，JVM执行的命令基本都是入栈出栈等，而且大部分指令都是没有操作数的，传统的汇编指令有一操作数、二操作数甚至三操作数的指令，Java相比C编译出来的汇编指令，执行起来会更加复杂，实现某个功能的指令条数也会更多，所以Java的执行效率实际上是不如C/C++的，虽然能够很方便地实现跨平台，但是性能上大打折扣，所以在性能要求比较苛刻的Android上，采用的是定制版的JVM，并且是基于寄存器的指令集架构。此外，在某些情况下，我们还可以使用JNI机制来通过Java调用C/C++编写的程序以提升性能（也就是本地方法，使用到native关键字）</p></blockquote><h4 id="手动编译jdk8" tabindex="-1">手动编译JDK8 <a class="header-anchor" href="#手动编译jdk8" aria-hidden="true">#</a></h4><h4 id="jvm启动流程" tabindex="-1">JVM启动流程 <a class="header-anchor" href="#jvm启动流程" aria-hidden="true">#</a></h4><h5 id="执行过程总结" tabindex="-1">执行过程总结 <a class="header-anchor" href="#执行过程总结" aria-hidden="true">#</a></h5><blockquote><p><img src="/assets/image-20220326132516954.a3d3c088.png" alt="image-20220326132516954"></p></blockquote><p>虚拟机的启动入口位于<code>jdk/src/share/bin/java.c</code>的<code>JLI_Launch</code>函数，整个流程分为如下几个步骤：</p><ol><li>配置JVM装载环境</li><li>解析虚拟机参数</li><li>设置线程栈大小</li><li>执行JavaMain方法</li></ol><h5 id="启动调试" tabindex="-1">启动调试 <a class="header-anchor" href="#启动调试" aria-hidden="true">#</a></h5><p><code>JLI_Launch</code>函数</p><blockquote><p>入口点的参数有很多个，其中包括当前的完整版本名称、简短版本名称、运行参数、程序名称、启动器名称等</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">int</span></span>
<span class="line"><span style="color:#A6ACCD;">JLI_Launch(int argc, char ** argv,              /* main argc, argc */</span></span>
<span class="line"><span style="color:#A6ACCD;">        int jargc, const char** jargv,          /* java args */</span></span>
<span class="line"><span style="color:#A6ACCD;">        int appclassc, const char** appclassv,  /* app classpath */</span></span>
<span class="line"><span style="color:#A6ACCD;">        const char* fullversion,                /* full version defined */</span></span>
<span class="line"><span style="color:#A6ACCD;">        const char* dotversion,                 /* dot version defined */</span></span>
<span class="line"><span style="color:#A6ACCD;">        const char* pname,                      /* program name */</span></span>
<span class="line"><span style="color:#A6ACCD;">        const char* lname,                      /* launcher name */</span></span>
<span class="line"><span style="color:#A6ACCD;">        jboolean javaargs,                      /* JAVA_ARGS */</span></span>
<span class="line"><span style="color:#A6ACCD;">        jboolean cpwildcard,                    /* classpath wildcard */</span></span>
<span class="line"><span style="color:#A6ACCD;">        jboolean javaw,                         /* windows-only javaw */</span></span>
<span class="line"><span style="color:#A6ACCD;">        jint     ergo_class                     /* ergnomics policy */</span></span>
<span class="line"><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>首先进行一些初始化操作以及Debug信息打印配置等：</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">InitLauncher(javaw);</span></span>
<span class="line"><span style="color:#A6ACCD;">DumpState();</span></span>
<span class="line"><span style="color:#A6ACCD;">if (JLI_IsTraceLauncher()) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    int i;</span></span>
<span class="line"><span style="color:#A6ACCD;">    printf(&quot;Command line args:\n&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    for (i = 0; i &lt; argc ; i++) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        printf(&quot;argv[%d] = %s\n&quot;, i, argv[i]);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    AddOption(&quot;-Dsun.java.launcher.diag=true&quot;, NULL);</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>接着就是选择一个合适的JRE版本</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">/*</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Make sure the specified version of the JRE is running.</span></span>
<span class="line"><span style="color:#A6ACCD;"> *</span></span>
<span class="line"><span style="color:#A6ACCD;"> * There are three things to note about the SelectVersion() routine:</span></span>
<span class="line"><span style="color:#A6ACCD;"> *  1) If the version running isn&#39;t correct, this routine doesn&#39;t</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     return (either the correct version has been exec&#39;d or an error</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     was issued).</span></span>
<span class="line"><span style="color:#A6ACCD;"> *  2) Argc and Argv in this scope are *not* altered by this routine.</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     It is the responsibility of subsequent code to ignore the</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     arguments handled by this routine.</span></span>
<span class="line"><span style="color:#A6ACCD;"> *  3) As a side-effect, the variable &quot;main_class&quot; is guaranteed to</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     be set (if it should ever be set).  This isn&#39;t exactly the</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     poster child for structured programming, but it is a small</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     price to pay for not processing a jar file operand twice.</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     (Note: This side effect has been disabled.  See comment on</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     bugid 5030265 below.)</span></span>
<span class="line"><span style="color:#A6ACCD;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">SelectVersion(argc, argv, &amp;main_class);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>接着是创建JVM执行环境，例如需要确定数据模型，是32位还是64位，以及jvm本身的一些配置在jvm.cfg文件中读取和解析</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">CreateExecutionEnvironment(&amp;argc, &amp;argv,</span></span>
<span class="line"><span style="color:#A6ACCD;">                               jrepath, sizeof(jrepath),</span></span>
<span class="line"><span style="color:#A6ACCD;">                               jvmpath, sizeof(jvmpath),</span></span>
<span class="line"><span style="color:#A6ACCD;">                               jvmcfg,  sizeof(jvmcfg));</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>此函数只在头文件中定义，具体的实现是根据不同平台而定的。接着会动态加载jvm.so这个共享库，并把jvm.so中的相关函数导出并且初始化，而启动JVM的函数也在其中</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">if (!LoadJavaVM(jvmpath, &amp;ifn)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return(6);</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>最后就是对JVM进行初始化</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">return JVMInit(&amp;ifn, threadStackSize, argc, argv, mode, what, ret);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">//mac实现</span></span>
<span class="line"><span style="color:#A6ACCD;">int</span></span>
<span class="line"><span style="color:#A6ACCD;">JVMInit(InvocationFunctions* ifn, jlong threadStackSize,</span></span>
<span class="line"><span style="color:#A6ACCD;">                 int argc, char **argv,</span></span>
<span class="line"><span style="color:#A6ACCD;">                 int mode, char *what, int ret) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (sameThread) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        //无需关心....</span></span>
<span class="line"><span style="color:#A6ACCD;">    } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">      	//正常情况下走这个</span></span>
<span class="line"><span style="color:#A6ACCD;">        return ContinueInNewThread(ifn, threadStackSize, argc, argv, mode, what, ret);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>最后进入了一个<code>ContinueInNewThread</code>函数,这个函数会创建一个新的线程来执行</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">int</span></span>
<span class="line"><span style="color:#A6ACCD;">ContinueInNewThread(InvocationFunctions* ifn, jlong threadStackSize,</span></span>
<span class="line"><span style="color:#A6ACCD;">                    int argc, char **argv,</span></span>
<span class="line"><span style="color:#A6ACCD;">                    int mode, char *what, int ret)</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    ...</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">      rslt = ContinueInNewThread0(JavaMain, threadStackSize, (void*)&amp;args);</span></span>
<span class="line"><span style="color:#A6ACCD;">      /* If the caller has deemed there is an error we</span></span>
<span class="line"><span style="color:#A6ACCD;">       * simply return that, otherwise we return the value of</span></span>
<span class="line"><span style="color:#A6ACCD;">       * the callee</span></span>
<span class="line"><span style="color:#A6ACCD;">       */</span></span>
<span class="line"><span style="color:#A6ACCD;">      return (ret != 0) ? ret : rslt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>接着进入了一个名为<code>ContinueInNewThread0</code>的函数，可以看到它将<code>JavaMain</code>函数传入作为参数，而此函数定义的第一个参数类型是一个函数指针：</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">int</span></span>
<span class="line"><span style="color:#A6ACCD;">ContinueInNewThread0(int (JNICALL *continuation)(void *), jlong stack_size, void * args) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    int rslt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    pthread_t tid;</span></span>
<span class="line"><span style="color:#A6ACCD;">    pthread_attr_t attr;</span></span>
<span class="line"><span style="color:#A6ACCD;">    pthread_attr_init(&amp;attr);</span></span>
<span class="line"><span style="color:#A6ACCD;">    pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_JOINABLE);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    if (stack_size &gt; 0) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      pthread_attr_setstacksize(&amp;attr, stack_size);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    if (pthread_create(&amp;tid, &amp;attr, (void *(*)(void*))continuation, (void*)args) == 0) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      void * tmp;</span></span>
<span class="line"><span style="color:#A6ACCD;">      pthread_join(tid, &amp;tmp);</span></span>
<span class="line"><span style="color:#A6ACCD;">      rslt = (int)tmp;</span></span>
<span class="line"><span style="color:#A6ACCD;">    } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">     /*</span></span>
<span class="line"><span style="color:#A6ACCD;">      * Continue execution in current thread if for some reason (e.g. out of</span></span>
<span class="line"><span style="color:#A6ACCD;">      * memory/LWP)  a new thread can&#39;t be created. This will likely fail</span></span>
<span class="line"><span style="color:#A6ACCD;">      * later in continuation as JNI_CreateJavaVM needs to create quite a</span></span>
<span class="line"><span style="color:#A6ACCD;">      * few new threads, anyway, just give it a try..</span></span>
<span class="line"><span style="color:#A6ACCD;">      */</span></span>
<span class="line"><span style="color:#A6ACCD;">      rslt = continuation(args);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    pthread_attr_destroy(&amp;attr);</span></span>
<span class="line"><span style="color:#A6ACCD;">    return rslt;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>最后实际上是在新的线程中执行<code>JavaMain</code>函数，最后我们再来看看此函数里面做了什么事情：</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">/* Initialize the virtual machine */</span></span>
<span class="line"><span style="color:#A6ACCD;">start = CounterGet();</span></span>
<span class="line"><span style="color:#A6ACCD;">if (!InitializeJVM(&amp;vm, &amp;env, &amp;ifn)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    JLI_ReportErrorMessage(JVM_ERROR1);</span></span>
<span class="line"><span style="color:#A6ACCD;">    exit(1);</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>第一步初始化虚拟机，如果报错直接退出。接着就是加载主类（至于具体如何加载一个类，我们会放在后面进行讲解），因为主类是我们Java程序的入口点：</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">/*</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Get the application&#39;s main class.</span></span>
<span class="line"><span style="color:#A6ACCD;"> *</span></span>
<span class="line"><span style="color:#A6ACCD;"> * See bugid 5030265.  The Main-Class name has already been parsed</span></span>
<span class="line"><span style="color:#A6ACCD;"> * from the manifest, but not parsed properly for UTF-8 support.</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Hence the code here ignores the value previously extracted and</span></span>
<span class="line"><span style="color:#A6ACCD;"> * uses the pre-existing code to reextract the value.  This is</span></span>
<span class="line"><span style="color:#A6ACCD;"> * possibly an end of release cycle expedient.  However, it has</span></span>
<span class="line"><span style="color:#A6ACCD;"> * also been discovered that passing some character sets through</span></span>
<span class="line"><span style="color:#A6ACCD;"> * the environment has &quot;strange&quot; behavior on some variants of</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Windows.  Hence, maybe the manifest parsing code local to the</span></span>
<span class="line"><span style="color:#A6ACCD;"> * launcher should never be enhanced.</span></span>
<span class="line"><span style="color:#A6ACCD;"> *</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Hence, future work should either:</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     1)   Correct the local parsing code and verify that the</span></span>
<span class="line"><span style="color:#A6ACCD;"> *          Main-Class attribute gets properly passed through</span></span>
<span class="line"><span style="color:#A6ACCD;"> *          all environments,</span></span>
<span class="line"><span style="color:#A6ACCD;"> *     2)   Remove the vestages of maintaining main_class through</span></span>
<span class="line"><span style="color:#A6ACCD;"> *          the environment (and remove these comments).</span></span>
<span class="line"><span style="color:#A6ACCD;"> *</span></span>
<span class="line"><span style="color:#A6ACCD;"> * This method also correctly handles launching existing JavaFX</span></span>
<span class="line"><span style="color:#A6ACCD;"> * applications that may or may not have a Main-Class manifest entry.</span></span>
<span class="line"><span style="color:#A6ACCD;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">mainClass = LoadMainClass(env, mode, what);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>某些没有主方法的Java程序比如JavaFX应用，会获取ApplicationMainClass：</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">/*</span></span>
<span class="line"><span style="color:#A6ACCD;"> * In some cases when launching an application that needs a helper, e.g., a</span></span>
<span class="line"><span style="color:#A6ACCD;"> * JavaFX application with no main method, the mainClass will not be the</span></span>
<span class="line"><span style="color:#A6ACCD;"> * applications own main class but rather a helper class. To keep things</span></span>
<span class="line"><span style="color:#A6ACCD;"> * consistent in the UI we need to track and report the application main class.</span></span>
<span class="line"><span style="color:#A6ACCD;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">appClass = GetApplicationClass(env);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>初始化完成：</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">/*</span></span>
<span class="line"><span style="color:#A6ACCD;"> * PostJVMInit uses the class name as the application name for GUI purposes,</span></span>
<span class="line"><span style="color:#A6ACCD;"> * for example, on OSX this sets the application name in the menu bar for</span></span>
<span class="line"><span style="color:#A6ACCD;"> * both SWT and JavaFX. So we&#39;ll pass the actual application class here</span></span>
<span class="line"><span style="color:#A6ACCD;"> * instead of mainClass as that may be a launcher or helper class instead</span></span>
<span class="line"><span style="color:#A6ACCD;"> * of the application class.</span></span>
<span class="line"><span style="color:#A6ACCD;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">PostJVMInit(env, appClass, vm);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>接着就是获取主类中的主方法：</p></blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * The LoadMainClass not only loads the main class, it will also ensure</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * that the main method&#39;s signature is correct, therefore further checking</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * is not required. The main method is invoked here so that extraneous java</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * stacks are not in the application stack trace.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">mainID </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(*</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">-&gt;</span><span style="color:#82AAFF;">GetStaticMethodID</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mainClass</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                   </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">([Ljava/lang/String;)V</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><blockquote><p>在字节码中<code>void main(String[] args)</code>表示为<code>([Ljava/lang/String;)V</code>我们之后会详细介绍。接着就是调用主方法了：</p></blockquote><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/* Invoke main method. */</span></span>
<span class="line"><span style="color:#89DDFF;">(*</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">)-&gt;</span><span style="color:#82AAFF;">CallStaticVoidMethod</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mainClass</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mainID</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mainArgs</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><blockquote><p>调用后，我们的Java程序就开飞速运行起来，直到走到主方法的最后一行返回：</p></blockquote><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">/*</span></span>
<span class="line"><span style="color:#A6ACCD;"> * The launcher&#39;s exit code (in the absence of calls to</span></span>
<span class="line"><span style="color:#A6ACCD;"> * System.exit) will be non-zero if main threw an exception.</span></span>
<span class="line"><span style="color:#A6ACCD;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">ret = (*env)-&gt;ExceptionOccurred(env) == NULL ? 0 : 1;</span></span>
<span class="line"><span style="color:#A6ACCD;">LEAVE();</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p>至此，一个Java程序的运行流程结束，在最后LEAVE函数中会销毁JVM。</p></blockquote><h4 id="jni调用本地方法" tabindex="-1">JNI调用本地方法 <a class="header-anchor" href="#jni调用本地方法" aria-hidden="true">#</a></h4><blockquote><p>Java的JNI机制，它的全称：Java Native Interface，即Java本地接口。它允许在Java虚拟机内运行的Java代码与其他编程语言（如C/C++和汇编语言）编写的程序和库进行交互（在Android开发中用得比较多）</p></blockquote><h5 id="调试过程" tabindex="-1">调试过程 <a class="header-anchor" href="#调试过程" aria-hidden="true">#</a></h5><p>比如我们现在想要让C语言程序帮助我们的Java程序实现a+b的运算，首先我们需要创建一个本地方法：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">sum</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//本地方法使用native关键字标记，无需任何实现，交给C语言实现</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">native</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sum</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>创建好后，接着点击构建按钮，会出现一个out文件夹，也就是生成的class文件在其中，接着我们直接生成对应的C头文件：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">javah</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-classpath</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">out/production/SimpleHelloWorld</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./jni</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">com.test.Main</span></span>
<span class="line"></span></code></pre></div><p>生成的头文件位于jni文件夹下：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span>
<span class="line"><span style="color:#A6ACCD;">#include &lt;jni.h&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">/* Header for class com_test_Main */</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#ifndef _Included_com_test_Main</span></span>
<span class="line"><span style="color:#A6ACCD;">#define _Included_com_test_Main</span></span>
<span class="line"><span style="color:#A6ACCD;">#ifdef __cplusplus</span></span>
<span class="line"><span style="color:#A6ACCD;">extern &quot;C&quot; {</span></span>
<span class="line"><span style="color:#A6ACCD;">#endif</span></span>
<span class="line"><span style="color:#A6ACCD;">/*</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Class:     com_test_Main</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Method:    sum</span></span>
<span class="line"><span style="color:#A6ACCD;"> * Signature: (II)V</span></span>
<span class="line"><span style="color:#A6ACCD;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">JNIEXPORT void JNICALL Java_com_test_Main_sum</span></span>
<span class="line"><span style="color:#A6ACCD;">  (JNIEnv *, jclass, jint, jint);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#ifdef __cplusplus</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">#endif</span></span>
<span class="line"><span style="color:#A6ACCD;">#endif</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>接着我们在CLion中新建一个C++项目，并引入刚刚生成的头文件，并导入jni相关头文件（在JDK文件夹中）首先修改CMake文件：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">cmake_minimum_required(VERSION 3.21)</span></span>
<span class="line"><span style="color:#A6ACCD;">project(JNITest)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">include_directories(/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home/include)</span></span>
<span class="line"><span style="color:#A6ACCD;">include_directories(/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home/include/darwin)</span></span>
<span class="line"><span style="color:#A6ACCD;">set(CMAKE_CXX_STANDARD 14)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">add_executable(JNITest com_test_Main.cpp com_test_Main.h)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>接着就可以编写实现了，首先认识一下引用类型对照表：<img src="/assets/image-20220326132905761.e56ce339.png" alt="image-20220326132905761"></p><p>所以我们这里直接返回a+b即可：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">#include &quot;com_test_Main.h&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">JNIEXPORT jint JNICALL Java_com_test_Main_sum</span></span>
<span class="line"><span style="color:#A6ACCD;">        (JNIEnv * env, jclass clazz, jint a, jint b){</span></span>
<span class="line"><span style="color:#A6ACCD;">    return a + b;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>接着我们就可以将cpp编译为动态链接库，在MacOS下会生成<code>.dylib</code>文件，Windows下会生成<code>.dll</code>文件，我们这里就只以MacOS为例，命令有点长，因为还需要包含JDK目录下的头文件：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">gcc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">com_test_Main.cpp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-I</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home/include</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-I</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home/include/darwin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-fPIC</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-shared</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test.dylib</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-lstdc++</span></span>
<span class="line"></span></code></pre></div><p>编译完成后，得到<code>test.dylib</code>文件，这就是动态链接库了。</p><p>最后我们再将其放到桌面，然后在Java程序中加载：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">public class Main {</span></span>
<span class="line"><span style="color:#A6ACCD;">    static {</span></span>
<span class="line"><span style="color:#A6ACCD;">        System.load(&quot;/Users/nagocoler/Desktop/test.dylib&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    public static void main(String[] args) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        System.out.println(sum(1, 2));</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    public static native int sum(int a, int b);</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>运行，成功得到结果：<img src="/assets/image-20220326132930985.731650e4.png" alt="image-20220326132930985"></p><h2 id="jvm内存管理" tabindex="-1">JVM内存管理 <a class="header-anchor" href="#jvm内存管理" aria-hidden="true">#</a></h2><blockquote><p>C/C++开发中,可以通过C语言动态申请内存，并用于存放数据</p><p>在Java中,内存操作都是由JVM在进行控制</p></blockquote><h4 id="jvm内存模型" tabindex="-1">jvm内存模型 <a class="header-anchor" href="#jvm内存模型" aria-hidden="true">#</a></h4><p><img src="/assets/jvm内存模型图_00.21f9af48.png" alt="jvm内存模型图_00"></p><h4 id="内存区域划分" tabindex="-1">内存区域划分 <a class="header-anchor" href="#内存区域划分" aria-hidden="true">#</a></h4><p><img src="/assets/image-20220326133403516.d7830bcc.png" alt="image-20220326133403516"></p><blockquote><p>内存区域一共分为5个区域，其中方法区和堆是所有线程共享的区域，随着虚拟机的创建而创建，虚拟机的结束而销毁，而虚拟机栈、本地方法栈、程序计数器都是线程之间相互隔离的，每个线程都有一个自己的区域，并且线程启动时会自动创建，结束之后会自动销毁。内存划分完成之后，我们的JVM执行引擎和本地库接口，也就是Java程序开始运行之后就会根据分区合理地使用对应区域的内存了。</p></blockquote><h5 id="大致划分" tabindex="-1">大致划分 <a class="header-anchor" href="#大致划分" aria-hidden="true">#</a></h5><blockquote><p>总结各个内存区域的用途：</p><ul><li>（线程独有）程序计数器：保存当前程序的执行位置。</li><li>（线程独有）虚拟机栈：通过栈帧来维持方法调用顺序，帮助控制程序有序运行。</li><li>（线程独有）本地方法栈：同上，作用与本地方法。</li><li>堆：所有的对象和数组都在这里保存。(JDK7后<strong>字符串常量池</strong>从方法区移动到了堆中)</li><li>方法区：类信息、即时编译器的代码缓存、运行时常量池。</li></ul></blockquote><h6 id="程序计数器" tabindex="-1">程序计数器 <a class="header-anchor" href="#程序计数器" aria-hidden="true">#</a></h6><blockquote><p>JVM中的程序计数器可以看做是当前线程所执行字节码的行号指示器，而行号正好就指的是某一条指令，字节码解释器在工作时也会改变这个值，来指定下一条即将执行的指令。</p><p>Java的多线程也是依靠时间片轮转算法进行的，因此一个CPU同一时间也只会处理一个线程，当某个线程的时间片消耗完成后，会自动切换到下一个线程继续执行，而当前线程的执行位置会被保存到当前线程的程序计数器中，当下次轮转到此线程时，又继续根据之前的执行位置继续向下执行。</p><p>程序计数器因为只需要记录很少的信息，所以只占用很少一部分内存。</p></blockquote><h6 id="虚拟机栈" tabindex="-1">虚拟机栈 <a class="header-anchor" href="#虚拟机栈" aria-hidden="true">#</a></h6><blockquote><p>栈结构，每个方法被执行的时候，Java虚拟机都会同步创建一个栈帧（其实就是栈里面的一个元素），栈帧中包括了当前方法的一些信息，比如局部变量表、操作数栈、动态链接、方法出口等。</p><p><img src="/assets/image-20220326160110161.9657cd88.png" alt="image-20220326160110161"></p><p><strong>局部变量表</strong>就是我们方法中的局部变量,实际上局部变量表在class文件中就已经定义好了</p><p><strong>操作数栈</strong>就是字节码执行时使用到的栈结构</p><p>每个栈帧还保存了一个<strong>可以指向当前方法所在类</strong>的运行时常量池，目的是：当前方法中如果需要调用其他方法的时候，能够从运行时常量池中找到对应的符号引用，然后将符号引用转换为直接引用，然后就能直接调用对应方法，这就是<strong>动态链接</strong></p><p><strong>方法出口</strong>，也就是方法该如何结束，是抛出异常还是正常返回</p></blockquote><blockquote><p><strong>虚拟机栈的运作流程模拟</strong></p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">a</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">a</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">b</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">b</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">c</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">c</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>当我们的主方法执行后，会依次执行三个方法<code>a() -&gt; b() -&gt; c() -&gt; 返回</code>，反编译之后的结果：</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  public </span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">test</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Main</span><span style="color:#89DDFF;">();</span><span style="color:#F07178;">   #这个是构造方法</span></span>
<span class="line"><span style="color:#F07178;">    descriptor: </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;">V</span></span>
<span class="line"><span style="color:#F07178;">    flags: ACC_PUBLIC</span></span>
<span class="line"><span style="color:#F07178;">    Code:</span></span>
<span class="line"><span style="color:#F07178;">      stack</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> locals</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> args_size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">: aload_0</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">: invokespecial #</span><span style="color:#F78C6C;">1</span><span style="color:#676E95;font-style:italic;">                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">4</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">      LineNumberTable:</span></span>
<span class="line"><span style="color:#F07178;">        line </span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">      LocalVariableTable:</span></span>
<span class="line"><span style="color:#F07178;">        Start  Length  Slot  Name   Signature</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">       </span><span style="color:#F78C6C;">5</span><span style="color:#F07178;">     </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">  this   Lcom</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;">test</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;">Main</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  public </span><span style="color:#C792EA;">static</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">java</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lang</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">String</span><span style="color:#C792EA;">[]</span><span style="color:#89DDFF;">);</span><span style="color:#F07178;">    #主方法</span></span>
<span class="line"><span style="color:#F07178;">    descriptor: </span><span style="color:#89DDFF;">([</span><span style="color:#F07178;">Ljava</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;">lang</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;">String</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">)V</span></span>
<span class="line"><span style="color:#F07178;">    flags: ACC_PUBLIC</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> ACC_STATIC</span></span>
<span class="line"><span style="color:#F07178;">    Code:</span></span>
<span class="line"><span style="color:#F07178;">      stack</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> locals</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> args_size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">: invokestatic  #</span><span style="color:#F78C6C;">2</span><span style="color:#676E95;font-style:italic;">                  // Method a:()I</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">: istore_1</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">4</span><span style="color:#F07178;">: getstatic     #</span><span style="color:#F78C6C;">3</span><span style="color:#676E95;font-style:italic;">                  // Field java/lang/System.out:Ljava/io/PrintStream;</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">7</span><span style="color:#F07178;">: iload_1</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">8</span><span style="color:#F07178;">: invokevirtual #</span><span style="color:#F78C6C;">4</span><span style="color:#676E95;font-style:italic;">                  // Method java/io/PrintStream.println:(I)V</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#F78C6C;">11</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">      LineNumberTable:</span></span>
<span class="line"><span style="color:#F07178;">        line </span><span style="color:#F78C6C;">5</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">        line </span><span style="color:#F78C6C;">6</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">4</span></span>
<span class="line"><span style="color:#F07178;">        line </span><span style="color:#F78C6C;">7</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">11</span></span>
<span class="line"><span style="color:#F07178;">      LocalVariableTable:</span></span>
<span class="line"><span style="color:#F07178;">        Start  Length  Slot  Name   Signature</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">      </span><span style="color:#F78C6C;">12</span><span style="color:#F07178;">     </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">  args   </span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">Ljava</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;">lang</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;">String</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#F78C6C;">4</span><span style="color:#F07178;">       </span><span style="color:#F78C6C;">8</span><span style="color:#F07178;">     </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">   res   I</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  public </span><span style="color:#C792EA;">static</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">a</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#F07178;">    descriptor: </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;">I</span></span>
<span class="line"><span style="color:#F07178;">    flags: ACC_PUBLIC</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> ACC_STATIC</span></span>
<span class="line"><span style="color:#F07178;">    Code:</span></span>
<span class="line"><span style="color:#F07178;">      stack</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> locals</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> args_size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">: invokestatic  #</span><span style="color:#F78C6C;">5</span><span style="color:#676E95;font-style:italic;">                  // Method b:()I</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">: ireturn</span></span>
<span class="line"><span style="color:#F07178;">      LineNumberTable:</span></span>
<span class="line"><span style="color:#F07178;">        line </span><span style="color:#F78C6C;">10</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  public </span><span style="color:#C792EA;">static</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">b</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#F07178;">    descriptor: </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;">I</span></span>
<span class="line"><span style="color:#F07178;">    flags: ACC_PUBLIC</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> ACC_STATIC</span></span>
<span class="line"><span style="color:#F07178;">    Code:</span></span>
<span class="line"><span style="color:#F07178;">      stack</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> locals</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> args_size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">: invokestatic  #</span><span style="color:#F78C6C;">6</span><span style="color:#676E95;font-style:italic;">                  // Method c:()I</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">: ireturn</span></span>
<span class="line"><span style="color:#F07178;">      LineNumberTable:</span></span>
<span class="line"><span style="color:#F07178;">        line </span><span style="color:#F78C6C;">14</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  public </span><span style="color:#C792EA;">static</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">c</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#F07178;">    descriptor: </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;">I</span></span>
<span class="line"><span style="color:#F07178;">    flags: ACC_PUBLIC</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> ACC_STATIC</span></span>
<span class="line"><span style="color:#F07178;">    Code:</span></span>
<span class="line"><span style="color:#F07178;">      stack</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> locals</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> args_size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">: bipush        </span><span style="color:#F78C6C;">10</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">: istore_0</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">: bipush        </span><span style="color:#F78C6C;">20</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">5</span><span style="color:#F07178;">: istore_1</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">6</span><span style="color:#F07178;">: iload_0</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">7</span><span style="color:#F07178;">: iload_1</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">8</span><span style="color:#F07178;">: iadd</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#F78C6C;">9</span><span style="color:#F07178;">: ireturn</span></span>
<span class="line"><span style="color:#F07178;">      LineNumberTable:</span></span>
<span class="line"><span style="color:#F07178;">        line </span><span style="color:#F78C6C;">18</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">        line </span><span style="color:#F78C6C;">19</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#F07178;">        line </span><span style="color:#F78C6C;">20</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">6</span></span>
<span class="line"><span style="color:#F07178;">      LocalVariableTable:</span></span>
<span class="line"><span style="color:#F07178;">        Start  Length  Slot  Name   Signature</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">       </span><span style="color:#F78C6C;">7</span><span style="color:#F07178;">     </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">     a   I</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#F78C6C;">6</span><span style="color:#F07178;">       </span><span style="color:#F78C6C;">4</span><span style="color:#F07178;">     </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">     b   I</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span></code></pre></div><p>编译之后，我们整个方法的最大操作数栈深度、局部变量表都是已经确定好的，当我们程序开始执行时，会根据这些信息封装为对应的栈帧，我们从<code>main</code>方法开始看起：</p><p><img src="/assets/image-20220326160434325.916108c6.png" alt="image-20220326160434325"></p><p>接着我们继续往下，到了<code> 0: invokestatic #2 // Method a:()I</code>时，需要调用方法<code>a()</code>，这时当前方法就不会继续向下运行了，而是去执行方法<code>a()</code>，那么同样的，将此方法也入栈，注意是放入到栈顶位置，<code>main</code>方法的栈帧会被压下去：</p><p><img src="/assets/image-20220326160449689.1749ff89.png" alt="image-20220326160449689"></p><p>这时，进入方法a之后，又继而进入到方法b，最后在进入c，因此，到达方法c的时候，我们的虚拟机栈变成了：</p><p><img src="/assets/image-20220326160513446.5e8eb15d.png" alt="image-20220326160513446"></p><p>现在我们依次执行方法c中的指令，最后返回a+b的结果，在方法c返回之后，也就代表方法c已经执行结束了，栈帧4会自动出栈，这时栈帧3就得到了上一栈帧返回的结果，并继续执行，但是由于紧接着马上就返回，所以继续重复栈帧4的操作，此时栈帧3也出栈并继续将结果交给下一个栈帧2，最后栈帧2再将结果返回给栈帧1，然后栈帧1就可以继续向下运行了，最后输出结果。</p><p><img src="/assets/image-20220326160531200.cbdaf478.png" alt="image-20220326160531200"></p></blockquote><h6 id="本地方法栈" tabindex="-1">本地方法栈 <a class="header-anchor" href="#本地方法栈" aria-hidden="true">#</a></h6><blockquote><p>本地方法栈与虚拟机栈作用差不多,作用于<strong>本地方法</strong></p></blockquote><h6 id="堆" tabindex="-1">堆 <a class="header-anchor" href="#堆" aria-hidden="true">#</a></h6><blockquote><p>堆是整个Java应用程序共享的区域，也是整个虚拟机最大的一块内存空间，而此区域的职责就是存放和管理对象和数组，垃圾回收机制也是主要作用于这一部分内存区域</p></blockquote><h6 id="方法区" tabindex="-1">方法区 <a class="header-anchor" href="#方法区" aria-hidden="true">#</a></h6><blockquote><p>方法区也是整个Java应用程序共享的区域，它用于存储所有的类信息、常量、静态变量、动态编译缓存等数据，可以大致分为两个部分</p><p>一个是类信息表，一个是运行时常量池。<img src="/assets/image-20220326160711468.769858ef.png" alt="image-20220326160711468"></p></blockquote><blockquote><p><strong>类信息表</strong>中存放的是当前应用程序加载的所有类信息，包括类的版本、字段、方法、接口等信息，同时会将编译时生成的常量池数据全部存放到运行时常量池中。当然，常量也并不是只能从类信息中获取，在程序运行时，也有可能会有新的常量进入到常量池。</p></blockquote><h4 id="爆内存和爆栈" tabindex="-1">爆内存和爆栈 <a class="header-anchor" href="#爆内存和爆栈" aria-hidden="true">#</a></h4><h5 id="堆内存溢出" tabindex="-1">堆内存溢出 <a class="header-anchor" href="#堆内存溢出" aria-hidden="true">#</a></h5><p>在Java程序运行时，内存容量不可能是无限制的，当我们的对象创建过多或是数组容量过大时，就会导致我们的堆内存不足以存放更多新的对象或是数组，这时就会出现错误，比如：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 申请了一个容量为21亿多的int型数组 ---&gt;导致内存溢出错误 OutOfMemoryError</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">int</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">Integer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">MAX_VALUE</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>编写一个一定会导致内存溢出的程序：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Test</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> list </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ArrayList</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(true){</span></span>
<span class="line"><span style="color:#A6ACCD;">           list</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Test</span><span style="color:#89DDFF;">());</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">//无限创建Test对象并丢进List中</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Test</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>在程序运行之后：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">java.lang.OutOfMemoryError: Java heap space</span></span>
<span class="line"><span style="color:#A6ACCD;">Dumping heap to java_pid35172.hprof ...</span></span>
<span class="line"><span style="color:#A6ACCD;">Heap dump file created [12895344 bytes in 0.028 secs]</span></span>
<span class="line"><span style="color:#A6ACCD;">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</span></span>
<span class="line"><span style="color:#A6ACCD;">	at java.util.Arrays.copyOf(Arrays.java:3210)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at java.util.Arrays.copyOf(Arrays.java:3181)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at java.util.ArrayList.grow(ArrayList.java:267)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at java.util.ArrayList.ensureExplicitCapacity(ArrayList.java:241)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at java.util.ArrayList.ensureCapacityInternal(ArrayList.java:233)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at java.util.ArrayList.add(ArrayList.java:464)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at com.test.Main.main(Main.java:10)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>可以看到错误出现原因正是<code>Java heap space</code>，也就是堆内存满了，并且根据我们设定的VM参数，堆内存保存了快照信息。我们可以在IDEA内置的Profiler中进行查看：</p><p><img src="/assets/image-20220326162724008.9821d2cb.png" alt="image-20220326162724008"></p><p>可以很明显地看到，在创建了31619个Test对象之后，堆内存溢出。</p></blockquote><h5 id="栈内存溢出" tabindex="-1">栈内存溢出 <a class="header-anchor" href="#栈内存溢出" aria-hidden="true">#</a></h5><blockquote><p>虚拟机栈会在方法调用时插入栈帧，构建无限递归的场景</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#82AAFF;">test</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">test</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#82AAFF;">test</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">Exception in thread &quot;main&quot; java.lang.StackOverflowError</span></span>
<span class="line"><span style="color:#A6ACCD;">	at com.test.Main.test(Main.java:12)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at com.test.Main.test(Main.java:12)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at com.test.Main.test(Main.java:12)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at com.test.Main.test(Main.java:12)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at com.test.Main.test(Main.java:12)</span></span>
<span class="line"><span style="color:#A6ACCD;">	at com.test.Main.test(Main.java:12)</span></span>
<span class="line"><span style="color:#A6ACCD;">	....以下省略很多行</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">使用 -Xss 来设定栈容量</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></blockquote><h4 id="申请堆外内存" tabindex="-1">申请堆外内存 <a class="header-anchor" href="#申请堆外内存" aria-hidden="true">#</a></h4><blockquote><p>除了堆内存可以存放对象数据以外，我们也可以申请堆外内存（直接内存），也就是不受JVM管控的内存区域，这部分区域的内存需要我们自行去申请和释放，实际上本质就是JVM通过C/C++调用<code>malloc</code>函数申请的内存，当然得我们自己去释放了。不过虽然是直接内存，不会受到堆内存容量限制，但是依然会受到本机最大内存的限制，所以还是有可能抛出<code>OutOfMemoryError</code>异常。</p><p>一个堆外内存操作类：<code>Unsafe</code>，就像它的名字一样，虽然Java提供堆外内存的操作类，但是实际上它是不安全的，只有你完全了解底层原理并且能够合理控制堆外内存，才能安全地使用堆外内存。</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Unsafe</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">native</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">registerNatives</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#82AAFF;">registerNatives</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">       sun</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">reflect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Reflection</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">registerMethodsToFilter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Unsafe</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">getUnsafe</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Unsafe</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Unsafe</span><span style="color:#A6ACCD;"> theUnsafe </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Unsafe</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">CallerSensitive</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Unsafe</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getUnsafe</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">Class</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">?</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> caller </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Reflection</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getCallerClass</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(!</span><span style="color:#A6ACCD;">VM</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isSystemDomainLoader</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">caller</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getClassLoader</span><span style="color:#89DDFF;">()))</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;font-style:italic;">// 不是JDK的类，不让用</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SecurityException</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Unsafe</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> theUnsafe</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>通过反射获取<code>unSafe</code>：</p><p>成功拿到Unsafe类之后，开始申请堆外内存，比如我们现在想要申请一个int大小的内存空间，并在此空间中存放一个int类型的数据：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> throws IllegalAccessException </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">Field</span><span style="color:#A6ACCD;"> unsafeField </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Unsafe</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getDeclaredFields</span><span style="color:#89DDFF;">()[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">   unsafeField</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAccessible</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">Unsafe</span><span style="color:#A6ACCD;"> unsafe </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Unsafe</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> unsafeField</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(null);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//申请4字节大小的内存空间，并得到对应位置的地址</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> address </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> unsafe</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">allocateMemory</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//在对应的地址上设定int的值</span></span>
<span class="line"><span style="color:#A6ACCD;">   unsafe</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">putInt</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6666666</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//获取对应地址上的Int型数值</span></span>
<span class="line"><span style="color:#A6ACCD;">   System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">unsafe</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getInt</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//释放申请到的内容</span></span>
<span class="line"><span style="color:#A6ACCD;">   unsafe</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">freeMemory</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//由于内存已经释放，这时数据就没了</span></span>
<span class="line"><span style="color:#A6ACCD;">   System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">unsafe</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getInt</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>看一下<code>allocateMemory</code>底层是如何调用的，这是一个native方法，我们来看C++源码：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">UNSAFE_ENTRY(jlong, Unsafe_AllocateMemory0(JNIEnv *env, jobject unsafe, jlong size)) {</span></span>
<span class="line"><span style="color:#A6ACCD;"> size_t sz = (size_t)size;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"> sz = align_up(sz, HeapWordSize);</span></span>
<span class="line"><span style="color:#A6ACCD;"> void* x = os::malloc(sz, mtOther);   //这里调用了os::malloc方法</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"> return addr_to_java(x);</span></span>
<span class="line"><span style="color:#A6ACCD;">} UNSAFE_END</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><code>os::malloc方法</code></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">void* os::malloc(size_t size, MEMFLAGS flags) {</span></span>
<span class="line"><span style="color:#A6ACCD;"> return os::malloc(size, flags, CALLER_PC);</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">void* os::malloc(size_t size, MEMFLAGS memflags, const NativeCallStack&amp; stack) {</span></span>
<span class="line"><span style="color:#A6ACCD;">	...</span></span>
<span class="line"><span style="color:#A6ACCD;"> u_char* ptr;</span></span>
<span class="line"><span style="color:#A6ACCD;"> ptr = (u_char*)::malloc(alloc_size);   //调用C++标准库函数 malloc(size)</span></span>
<span class="line"><span style="color:#A6ACCD;">	....</span></span>
<span class="line"><span style="color:#A6ACCD;"> // we do not track guard memory</span></span>
<span class="line"><span style="color:#A6ACCD;"> return MemTracker::record_malloc((address)ptr, size, memflags, stack, level);</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>直接内存实际上就是JVM申请的一块额外的内存空间，但是它并不在受管控的几种内存空间中，当然这些内存依然属于是JVM的，由于JVM提供的堆内存会进行垃圾回收等工作，效率不如直接申请和操作内存来得快，一些比较追求极致性能的框架会用到堆外内存来提升运行速度，如nio框架。</p></blockquote><h4 id="垃圾回收机制" tabindex="-1">垃圾回收机制 <a class="header-anchor" href="#垃圾回收机制" aria-hidden="true">#</a></h4><h5 id="对象存活判定算法" tabindex="-1">对象存活判定算法 <a class="header-anchor" href="#对象存活判定算法" aria-hidden="true">#</a></h5><h6 id="引用计数法" tabindex="-1">引用计数法 <a class="header-anchor" href="#引用计数法" aria-hidden="true">#</a></h6><p>要经常操作一个对象，那么首先一定会创建一个引用变量：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//str就是一个引用类型的变量，它持有对后面字符串对象的引用，可以代表后面这个字符串对象本身</span></span>
<span class="line"><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">lbwnb</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//str.xxxxx...</span></span>
<span class="line"></span></code></pre></div><p>实际上，我们会发现，只要一个对象还有使用价值，我们就会通过它的引用变量来进行操作，那么可否这样判断一个对象是否还需要被使用：</p><ul><li>每个对象都包含一个 <strong>引用计数器</strong>，用于存放引用计数（其实就是存放被引用的次数）</li><li>每当有一个地方引用此对象时，引用计数<code>+1</code></li><li>当引用失效（ 比如离开了局部变量的作用域或是引用被设定为<code>null</code>）时，引用计数<code>-1</code></li><li>当引用计数为<code>0</code>时，表示此对象不可能再被使用，因为这时我们已经没有任何方法可以得到此对象的引用了</li></ul><p>但是这样存在一个问题，如果两个对象相互引用呢？</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Test</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Test</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Test</span><span style="color:#A6ACCD;"> b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Test</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        a</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">another </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        b</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">another </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> a</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//这里直接把a和b赋值为null，这样前面的两个对象我们不可能再得到了</span></span>
<span class="line"><span style="color:#A6ACCD;">        a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Test</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Test</span><span style="color:#A6ACCD;"> another</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>按照引用计数算法，那么当出现以上情况时，虽然我们无法在得到此对象的引用了，并且此对象我们也无需再使用，但是由于这两个对象直接存在相互引用的情况，那么引用计数器的值将会永远是<code>1</code>，但是实际上此对象已经没有任何用途了。所以引用计数法并不是最好的解决方案。</p><h6 id="可达性分析算法" tabindex="-1">可达性分析算法 <a class="header-anchor" href="#可达性分析算法" aria-hidden="true">#</a></h6><blockquote><p><strong>如果某个对象无法到达任何GC Roots，则证明此对象是不可能再被使用的。</strong></p></blockquote><p>目前比较主流的编程语言（包括Java），一般都会使用可达性分析算法来判断对象是否存活，它采用了类似于树结构的搜索机制。</p><p>首先每个对象的引用都有机会成为树的根节点（GC Roots），可以被选定作为根节点条件如下：</p><ul><li>位于虚拟机栈的栈帧中的本地变量表中所引用到的对象（其实就是我们方法中的局部变量）同样也包括本地方法栈中JNI引用的对象。</li><li>类的静态成员变量引用的对象。</li><li>方法区中，常量池里面引用的对象，比如我们之前提到的<code>String</code>类型对象。</li><li>被添加了锁的对象（比如synchronized关键字）</li><li>虚拟机内部需要用到的对象。</li></ul><p><img src="/assets/image-20220326164903503.d7f575f3.png" alt="image-20220326164903503"></p><p>一旦已经存在的根节点不满足存在的条件时，那么根节点与对象之间的连接将被断开。此时虽然对象1仍存在对其他对象的引用，但是由于其没有任何根节点引用，所以此对象即可被判定为不再使用。比如某个方法中的局部变量引用，在方法执行完成返回之后：</p><p><img src="/assets/image-20220326164916460.b5d33caf.png" alt="image-20220326164916460"></p><p>这样就能很好地解决我们刚刚提到的循环引用问题，我们再来重现一下出现循环引用的情况：<img src="/assets/image-20220326164959693.df7b62c5.png" alt="image-20220326164959693"></p><p>可以看到，对象1和对象2依然是存在循环引用的，但是只有他们各自的GC Roots断开，那么就会变成下面这样：</p><p><img src="/assets/image-20220326165021123.92a1560d.png" alt="image-20220326165021123"></p><h6 id="最终判定" tabindex="-1">最终判定 <a class="header-anchor" href="#最终判定" aria-hidden="true">#</a></h6><blockquote><p>虽然在经历了可达性分析算法之后基本可能判定哪些对象能够被回收，但是并不代表此对象一定会被回收，我们依然可以在最终判定阶段对其进行挽留。</p><p><img src="/assets/image-20220326165223418.0385732c.png" alt="image-20220326165223418"></p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">* Called by the garbage collector on an object when garbage collection</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">* determines that there are no more references to the object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">* A subclass overrides the {@code finalize} method to dispose of</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">* system resources or to perform other cleanup.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">* ...</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">*/</span></span>
<span class="line"><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">finalize</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> throws Throwable </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></blockquote><blockquote><p>此方法正是最终判定方法，如果子类重写了此方法，那么子类对象在被判定为可回收时，会进行二次确认，也就是执行<code>finalize()</code>方法，而在此方法中，当前对象是完全有可能重新建立GC Roots的！所以，如果在二次确认后对象不满足可回收的条件，那么此对象不会被回收，巧妙地逃过了垃圾回收的命运。比如下面这个例子：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Test</span><span style="color:#A6ACCD;"> a</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Test</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">//这里直接把a赋值为null，这样前面的对象我们不可能再得到了</span></span>
<span class="line"><span style="color:#A6ACCD;">       a  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">//手动申请执行垃圾回收操作（注意只是申请，并不一定会执行，但是一般情况下都会执行）</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">gc</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">//等垃圾回收一下()</span></span>
<span class="line"><span style="color:#A6ACCD;">       Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">//我们来看看a有没有被回收</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Test</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">finalize</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Throwable</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">           System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(this+</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> 开始了它的救赎之路！</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">           a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">this;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>注意<code>finalize()</code>方法并不是在主线程调用的，而是虚拟机自动建立的一个低优先级的<code>Finalizer</code>线程（正是因为优先级比较低，所以前面才需要等待1秒钟）进行处理，我们可以稍微修改一下看看：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Test</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">finalize</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Throwable</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">       a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">this;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">Thread[Finalizer,8,system]</span></span>
<span class="line"><span style="color:#A6ACCD;">com.test.Main$Test@232204a1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>同时，同一个对象的<code>finalize()</code>方法只会有一次调用机会，也就是说，如果我们连续两次这样操作，那么第二次，对象必定被回收：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> throws InterruptedException </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Test</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//这里直接把a赋值为null，这样前面的对象我们不可能再得到了</span></span>
<span class="line"><span style="color:#A6ACCD;">   a  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//手动申请执行垃圾回收操作（注意只是申请，并不一定会执行，但是一般情况下都会执行）</span></span>
<span class="line"><span style="color:#A6ACCD;">   System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">gc</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//等垃圾回收一下</span></span>
<span class="line"><span style="color:#A6ACCD;">   Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#A6ACCD;">   System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//这里直接把a赋值为null，这样前面的对象我们不可能再得到了</span></span>
<span class="line"><span style="color:#A6ACCD;">   a  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//手动申请执行垃圾回收操作（注意只是申请，并不一定会执行，但是一般情况下都会执行）</span></span>
<span class="line"><span style="color:#A6ACCD;">   System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">gc</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">//等垃圾回收一下</span></span>
<span class="line"><span style="color:#A6ACCD;">   Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#A6ACCD;">   System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>当然，<code>finalize()</code>方法也并不是专门防止对象被回收的，我们可以使用它来释放一些程序使用中的资源等。</p></blockquote><h5 id="垃圾回收算法" tabindex="-1">垃圾回收算法 <a class="header-anchor" href="#垃圾回收算法" aria-hidden="true">#</a></h5><h6 id="分代收集机制" tabindex="-1">分代收集机制 <a class="header-anchor" href="#分代收集机制" aria-hidden="true">#</a></h6><blockquote><p>Java虚拟机将堆内存划分为<strong>新生代</strong>、<strong>老年代</strong>和<strong>永久代</strong>（其中永久代是HotSpot虚拟机特有的概念，在JDK8之前方法区实际上就是采用的永久代作为实现，而在JDK8之后，方法区由元空间实现，并且使用的是本地内存，容量大小取决于物理机实际大小，之后会详细介绍）这里我们主要讨论的是<strong>新生代</strong>和<strong>老年代</strong>。</p><p>不同的分代内存回收机制也存在一些不同之处，在HotSpot虚拟机中，新生代被划分为三块，一块较大的Eden空间和两块较小的Survivor空间，默认比例为8：1：1，老年代的GC评率相对较低，永久代一般存放类信息等（其实就是方法区的实现）如图所示：</p><p><img src="/assets/image-20220326165326942.b45f114f.png" alt="image-20220326165326942"></p><p>那么它是如何运作的呢？</p><p>首先，所有新创建的对象，在一开始都会进入到新生代的Eden区（如果是大对象会被直接丢进老年代），在进行新生代区域的垃圾回收时，首先会对所有新生代区域的对象进行扫描，并回收那些不再使用对象：<img src="/assets/image-20220326165352470.9697d44f.png" alt="image-20220326165352470"></p><p>接着，在一次垃圾回收之后，Eden区域没有被回收的对象，会进入到Survivor区。在一开始From和To都是空的，而GC之后，所有Eden区域存活的对象都会直接被放入到From区，最后From和To会发生一次交换，也就是说目前存放我们对象的From区，变为To区，而To区变为From区：</p><p><img src="/assets/image-20220326165407720.783be523.png" alt="image-20220326165407720"></p><p>接着就是下一次垃圾回收了，操作与上面是一样的，不过这时由于我们From区域中已经存在对象了，所以，在Eden区的存活对象复制到From区之后，所有To区域中的对象会进行年龄判定（每经历一轮GC年龄<code>+1</code>，如果对象的年龄大于<code>默认值为15</code>，那么会直接进入到老年代，否则移动到From区）</p><p><img src="/assets/image-20220326165419289.eceff473.png" alt="image-20220326165419289"></p><p>最后像上面一样交换To区和From区，之后不断重复以上步骤。</p><p>而垃圾收集也分为：</p><ul><li>Minor GC - 次要垃圾回收，主要进行新生代区域的垃圾收集。</li><li>触发条件：新生代的Eden区容量已满时。</li><li>Major GC - 主要垃圾回收，主要进行老年代的垃圾收集。</li><li>Full GC - 完全垃圾回收，对整个Java堆内存和方法区进行垃圾回收。</li><li>触发条件1：每次晋升到老年代的对象平均大小大于老年代剩余空间</li><li>触发条件2：Minor GC后存活的对象超过了老年代剩余空间</li><li>触发条件3：永久代内存不足（JDK8之前）</li><li>触发条件4：手动调用<code>System.gc()</code>方法</li></ul></blockquote><blockquote><p>我们可以添加启动参数来查看JVM的GC日志：</p><p><img src="/assets/e6c9d24egy1gzmd9jj8djj21m20gktav.5d855ce1.jpg" alt="image-20220222162536616"></p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">Object</span><span style="color:#A6ACCD;"> o </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Object</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">       o </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">gc</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">[GC (System.gc()) [PSYoungGen: 2621K-&gt;528K(76288K)] 2621K-&gt;528K(251392K), 0.0006874 secs] [Times: user=0.01 sys=0.01, real=0.00 secs] </span></span>
<span class="line"><span style="color:#A6ACCD;">[Full GC (System.gc()) [PSYoungGen: 528K-&gt;0K(76288K)] [ParOldGen: 0K-&gt;332K(175104K)] 528K-&gt;332K(251392K), [Metaspace: 3073K-&gt;3073K(1056768K)], 0.0022693 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span></span>
<span class="line"><span style="color:#A6ACCD;">Heap</span></span>
<span class="line"><span style="color:#A6ACCD;">PSYoungGen      total 76288K, used 3277K [0x000000076ab00000, 0x0000000770000000, 0x00000007c0000000)</span></span>
<span class="line"><span style="color:#A6ACCD;"> eden space 65536K, 5% used [0x000000076ab00000,0x000000076ae334d8,0x000000076eb00000)</span></span>
<span class="line"><span style="color:#A6ACCD;"> from space 10752K, 0% used [0x000000076eb00000,0x000000076eb00000,0x000000076f580000)</span></span>
<span class="line"><span style="color:#A6ACCD;"> to   space 10752K, 0% used [0x000000076f580000,0x000000076f580000,0x0000000770000000)</span></span>
<span class="line"><span style="color:#A6ACCD;">ParOldGen       total 175104K, used 332K [0x00000006c0000000, 0x00000006cab00000, 0x000000076ab00000)</span></span>
<span class="line"><span style="color:#A6ACCD;"> object space 175104K, 0% used [0x00000006c0000000,0x00000006c00532d8,0x00000006cab00000)</span></span>
<span class="line"><span style="color:#A6ACCD;">Metaspace       used 3096K, capacity 4496K, committed 4864K, reserved 1056768K</span></span>
<span class="line"><span style="color:#A6ACCD;"> class space    used 333K, capacity 388K, committed 512K, reserved 1048576K</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></blockquote><h6 id="空间分配担保" tabindex="-1">空间分配担保 <a class="header-anchor" href="#空间分配担保" aria-hidden="true">#</a></h6><blockquote><p>在一次GC后，新生代Eden区仍然存在大量的对象（因为GC之后存活对象会进入到一个Survivor区，但是很明显这时已经超出Survivor区的容量了，肯定是装不下的）那么现在该怎么办？</p><p>这时就需要用到<strong>空间分配担保机制</strong>了，可以把Survivor区无法容纳的对象直接送到老年代，让老年代进行分配担保（当然老年代也得装得下才行）在现实生活中，贷款会指定担保人，就是当借款人还不起钱的时候由担保人来还钱。</p><p>当新生代无法容纳更多的的对象时，可以把新生代中的对象移动到老年代中，这样新生代就腾出了空间来容纳更多的对象。</p><p>好，那既然新生代装不下就丢给老年代，那么要是老年代也装不下新生代的数据呢？这时，老年代肯定担保人是当不成了，那么这样的话，首先会判断一下之前的每次垃圾回收进入老年代的平均大小是否小于当前老年代的剩余空间，如果小于，那么说明也许可以放得下（不过也仅仅是也许，依然有可能放不下，因为判断的实际上只是平均值，万一这一次突然非常大呢），否则，会先来一次Full GC，进行一次大规模垃圾回收，来尝试腾出空间，再次判断老年代是否有空间存放，要是还是装不下，直接抛出OOM错误。</p><p>总结一下一次<strong>Minor GC</strong>的整个过程：<img src="/assets/image-20220326165742818.a9cfbc7f.png" alt="image-20220326165742818"></p></blockquote><h6 id="标记-清除算法" tabindex="-1">标记-清除算法 <a class="header-anchor" href="#标记-清除算法" aria-hidden="true">#</a></h6><blockquote><p>首先标记出所有需要回收的对象，然后再依次回收掉被标记的对象，或是标记出所有不需要回收的对象，只回收未标记的对象。</p><p><img src="/assets/image-20220326165854189.0d5b15ea.png" alt="image-20220326165854189"></p><p>此方法非常简单，但是缺点也是非常明显的 ，首先如果内存中存在大量的对象，那么可能就会存在大量的标记，并且大规模进行清除。并且一次标记清除之后，连续的内存空间可能会出现许许多多的空隙，碎片化会导致连续内存空间利用率降低。</p></blockquote><h6 id="标记-复制算法" tabindex="-1">标记-复制算法 <a class="header-anchor" href="#标记-复制算法" aria-hidden="true">#</a></h6><blockquote><p>标记复制算法，实际上就是将内存区域划分为大小相同的两块区域，每次只使用其中的一块区域，每次垃圾回收结束后，将所有存活的对象全部复制到另一块区域中，并一次性清空当前区域。虽然浪费了一些时间进行复制操作，但是这样能够很好地解决对象大面积回收后空间碎片化严重的问题。</p><p><img src="/assets/image-20220326165926520.e83b3e6a.png" alt="image-20220326165926520"></p><p>这种算法就非常适用于新生代（因为新生代的回收效率极高，一般不会留下太多的对象）的垃圾回收，而我们之前所说的新生代Survivor区其实就是这个思路，包括8:1:1的比例也正是为了对标记复制算法进行优化而采取的。</p></blockquote><h6 id="标记-整理算法" tabindex="-1">标记-整理算法 <a class="header-anchor" href="#标记-整理算法" aria-hidden="true">#</a></h6><blockquote><p>虽然标记-复制算法能够很好地应对新生代高回收率的场景，但是放到老年代，它就显得很鸡肋了。我们知道，一般长期都回收不到的对象，才有机会进入到老年代，所以老年代一般都是些钉子户，可能一次GC后，仍然存留很多对象。而标记复制算法会在GC后完整复制整个区域内容，并且会折损50%的区域，显然这并不适用于老年代。</p><p>那么我们能否这样，在标记所有待回收对象之后，不急着去进行回收操作，而是将所有待回收的对象整齐排列在一段内存空间中，而需要回收的对象全部往后丢，这样，前半部分的所有对象都是无需进行回收的，而后半部分直接一次性清除即可。</p><p><img src="/assets/image-20220326170026794.0c86812a.png" alt="image-20220326170026794"></p><p>虽然这样能保证内存空间充分使用，并且也没有标记复制算法那么繁杂，但是缺点也是显而易见的，它的效率比前两者都低。甚至，由于需要修改对象在内存中的位置，此时程序必须要暂停才可以，在极端情况下，可能会导致整个程序发生停顿（被称为“Stop The World”）。</p><p>所以，我们可以将标记清除算法和标记整理算法混合使用，在内存空间还不是很凌乱的时候，采用标记清除算法其实是没有多大问题的，当内存空间凌乱到一定程度后，我们可以进行一次标记整理算法。</p></blockquote><h5 id="垃圾收集器实现" tabindex="-1">垃圾收集器实现 <a class="header-anchor" href="#垃圾收集器实现" aria-hidden="true">#</a></h5><h6 id="serial收集器" tabindex="-1">Serial收集器 <a class="header-anchor" href="#serial收集器" aria-hidden="true">#</a></h6><blockquote><p>在JDK1.3.1之前，是虚拟机新生代区域收集器的唯一选择。这是一款单线程的垃圾收集器，也就是说，当开始进行垃圾回收时，需要暂停所有的线程，直到垃圾收集工作结束。它的新生代收集算法采用的是标记复制算法，老年代采用的是标记整理算法。</p><p><img src="/assets/image-20220326170108369.a9866dba.png" alt="image-20220326170108369"></p><p>可以看到，当进入到垃圾回收阶段时，所有的用户线程必须等待GC线程完成工作，就相当于你打一把LOL 40分钟，中途每隔1分钟网络就卡5秒钟，可能这时你正在打团，结果你被物理控制直接在那里站了5秒钟，这确实让人难以接受。</p><p>虽然缺点很明显，但是优势也是显而易见的：</p><ol><li>设计简单而高效。</li><li>在用户的桌面应用场景中，内存一般不大，可以在较短时间内完成垃圾收集，只要不频繁发生，使用串行回收器是可以接受的。</li></ol><p>所以，在客户端模式（一般用于一些桌面级图形化界面应用程序）下的新生代中，默认垃圾收集器至今依然是Serial收集器。我们可以在<code>java -version</code>中查看默认的客户端模式：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">openjdk version &quot;1.8.0_322&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">OpenJDK Runtime Environment (Zulu 8.60.0.21-CA-macos-aarch64) (build 1.8.0_322-b06)</span></span>
<span class="line"><span style="color:#A6ACCD;">OpenJDK 64-Bit Server VM (Zulu 8.60.0.21-CA-macos-aarch64) (build 25.322-b06, mixed mode)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>我们可以在jvm.cfg文件中切换JRE为Server VM或是Client VM，默认路径为：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">JDK安装目录/jre/lib/jvm.cfg</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>比如我们需要将当前模式切换为客户端模式，那么我们可以这样编辑：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">-client KNOWN</span></span>
<span class="line"><span style="color:#A6ACCD;">-server IGNORE</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></blockquote><h6 id="parnew收集器" tabindex="-1">ParNew收集器 <a class="header-anchor" href="#parnew收集器" aria-hidden="true">#</a></h6><blockquote><p>这款垃圾收集器相当于是Serial收集器的多线程版本，它能够支持多线程垃圾收集：<img src="/assets/image-20220326170143444.5c7abe8d.png" alt="image-20220326170143444"></p><p>除了多线程支持以外，其他内容基本与Serial收集器一致，并且目前某些JVM默认的服务端模式新生代收集器就是使用的ParNew收集器。</p></blockquote><h6 id="parallel-scavenge-parallel-old收集器" tabindex="-1">Parallel Scavenge/Parallel Old收集器 <a class="header-anchor" href="#parallel-scavenge-parallel-old收集器" aria-hidden="true">#</a></h6><blockquote><p>Parallel Scavenge同样是一款面向新生代的垃圾收集器，同样采用标记复制算法实现，在JDK6时也推出了其老年代收集器Parallel Old，采用标记整理算法实现：<img src="/assets/image-20220326170218573.19637529.png" alt="image-20220326170218573"></p><p>与ParNew收集器不同的是，它会自动衡量一个吞吐量，并根据吞吐量来决定每次垃圾回收的时间，这种自适应机制，能够很好地权衡当前机器的性能，根据性能选择最优方案。</p><p>目前<strong>JDK8采用的就是这种 Parallel Scavenge + Parallel Old 的垃圾回收方案</strong></p></blockquote><h6 id="cms收集器" tabindex="-1">CMS收集器 <a class="header-anchor" href="#cms收集器" aria-hidden="true">#</a></h6><blockquote><p>在JDK1.5，HotSpot推出了一款在强交互应用中几乎可认为有划时代意义的垃圾收集器：CMS（Concurrent-Mark-Sweep）收集器，这款收集器是HotSpot虚拟机中第一款真正意义上的并发（注意这里的并发和之前的并行是有区别的，并发可以理解为同时运行用户线程和GC线程，而并行可以理解为多条GC线程同时工作）收集器，它第一次实现了让垃圾收集线程与用户线程同时工作。</p><p>它主要采用标记清除算法：<img src="/assets/image-20220326170309111.e19fdfe6.png" alt="image-20220326170309111"></p><p>它的垃圾回收分为4个阶段：</p><ul><li>初始标记（需要暂停用户线程）：这个阶段的主要任务仅仅只是标记出GC Roots能直接关联到的对象，速度比较快，不用担心会停顿太长时间。</li><li>并发标记：从GC Roots的直接关联对象开始遍历整个对象图的过程，这个过程耗时较长但是不需要停顿用户线程，可以与垃圾收集线程一起并发运行。</li><li>重新标记（需要暂停用户线程）：由于并发标记阶段可能某些用户线程会导致标记产生变得，因此这里需要再次暂停所有线程进行并行标记，这个时间会比初始标记时间长一丢丢。</li><li>并发清除：最后就可以直接将所有标记好的无用对象进行删除，因为这些对象程序中也用不到了，所以可以与用户线程并发运行。</li></ul><p>虽然它的优点非常之大，但是缺点也是显而易见的，我们之前说过，标记清除算法会产生大量的内存碎片，导致可用连续空间逐渐变少，长期这样下来，会有更高的概率触发Full GC，并且在与用户线程并发执行的情况下，也会占用一部分的系统资源，导致用户线程的运行速度一定程度上减慢。</p><p>不过，如果你希望的是最低的GC停顿时间，这款垃圾收集器无疑是最佳选择，不过<strong>自从G1收集器问世之后，CMS收集器不再推荐使用了</strong>。</p></blockquote><h6 id="garbage-first-g1-收集器" tabindex="-1">Garbage First (G1) 收集器 <a class="header-anchor" href="#garbage-first-g1-收集器" aria-hidden="true">#</a></h6><blockquote><p>此垃圾收集器也是一款划时代的垃圾收集器，在JDK7的时候正式走上历史舞台，它是一款主要面向于服务端的垃圾收集器，并且在JDK9时，取代了JDK8默认的 Parallel Scavenge + Parallel Old 的回收方案。</p><p>垃圾回收分为<code>Minor GC</code>、<code>Major GC </code>和<code>Full GC</code>，它们分别对应的是新生代，老年代和整个堆内存的垃圾回收，而G1收集器巧妙地绕过了这些约定，它将整个Java堆划分成<code>2048</code>个大小相同的独立<code>Region</code>块，每个<code>Region块</code>的大小根据堆空间的实际大小而定，整体被控制在1MB到32MB之间，且都为2的N次幂。所有的<code>Region</code>大小相同，且在JVM的整个生命周期内不会发生改变。</p><p>每一个<code>Region</code>都可以根据需要，自由决定扮演哪个角色（Eden、Survivor和老年代），收集器会根据对应的角色采用不同的回收策略。此外，G1收集器还存在一个Humongous区域，它专门用于存放大对象（一般认为大小超过了Region容量一半的对象为大对象）这样，新生代、老年代在物理上，不再是一个连续的内存区域，而是到处分布的。</p><p><img src="/assets/image-20220326170452371.b074b758.png" alt="image-20220326170452371"></p><p>它的回收过程与CMS大体类似：<img src="/assets/image-20220326170503748.6dc41539.png" alt="image-20220326170503748"></p><p>分为以下四个步骤：</p><ul><li>初始标记（暂停用户线程）：仅仅只是标记一下GC Roots能直接关联到的对象，并且修改TAMS指针的值，让下一阶段用户线程并发运行时，能正确地在可用的Region中分配新对象。这个阶段需要停顿线程，但耗时很短，而且是借用进行Minor GC的时候同步完成的，所以G1收集器在这个阶段实际并没有额外的停顿。</li><li>并发标记：从GC Root开始对堆中对象进行可达性分析，递归扫描整个堆里的对象图，找出要回收的对象，这阶段耗时较长，但可与用户程序并发执行。</li><li>最终标记（暂停用户线程）：对用户线程做一个短暂的暂停，用于处理并发标记阶段漏标的那部分对象。</li><li>筛选回收：负责更新Region的统计数据，对各个Region的回收价值和成本进行排序，根据用户所期望的停顿时间来制定回收计划，可以自由选择任意多个Region构成回收集，然后把决定回收的那一部分Region的存活对象复制到空的Region中，再清理掉整个旧Region的全部空间。这里的操作涉及存活对象的移动，是必须暂停用户线程，由多个收集器线程并行完成的。</li></ul></blockquote><h2 id="类加载" tabindex="-1">类加载 <a class="header-anchor" href="#类加载" aria-hidden="true">#</a></h2><h4 id="类文件结构" tabindex="-1">类文件结构 <a class="header-anchor" href="#类文件结构" aria-hidden="true">#</a></h4><h5 id="类文件信息" tabindex="-1">类文件信息 <a class="header-anchor" href="#类文件信息" aria-hidden="true">#</a></h5><blockquote><p>使用<code>javap</code>命令来对字节码文件进行反编译查看的，那么，它以二进制格式是怎么保存呢？我们可以使用WinHex软件来以十六进制查看字节码文件。</p></blockquote><h5 id="字节码指令" tabindex="-1">字节码指令 <a class="header-anchor" href="#字节码指令" aria-hidden="true">#</a></h5><blockquote><p>虚拟机的指令是由一个字节长度的、代表某种特定操作含义的数字（操作码，类似于机器语言），操作后面也可以携带0个或多个参数一起执行。</p><p>JVM实际上并不是面向寄存器架构的，而是面向操作数栈，所以大多数指令都是不带参数的。</p><p>以当前的Main类中的main方法作为教材进行讲解：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">public static void main(String[] args) {</span></span>
<span class="line"><span style="color:#A6ACCD;">   int i = 10;</span></span>
<span class="line"><span style="color:#A6ACCD;">   int a = i++;</span></span>
<span class="line"><span style="color:#A6ACCD;">   int b = ++i;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>main方法中首先是定义了一个int类型的变量i，并赋值为10，然后变量a接收<code>i++</code>的值，变量b接收<code>++i</code>的值。</p><p>编译成字节码之后:</p><p><img src="/assets/image-20220326172930880.a65ca4b1.png" alt="image-20220326172930880"></p><ul><li>首先第一句，<code>bipush</code>，将10送至操作数栈顶。</li><li>接下来将操作数栈顶的数值存进1号本地变量，也就是变量i中。</li><li>接着将变量i中的值又丢向操作数栈顶</li><li>这里使用<code>iinc</code>指令，将1号本地变量的值增加1（结束之后i的值就是11了）</li><li>接着将操作数栈顶的值（操作数栈顶的值是10）存入2号本地变量（这下彻底知道i++到底干了啥才会先返回后自增了吧，从原理角度来说，实际上i是先自增了的，但由于这里取的是操作数栈中的值，所以说就得到了i之前的值）</li><li>接着往下，我们看到++i是先直接将i的值自增1</li><li>然后在将其值推向操作数栈顶</li></ul><p><img src="/assets/image-20220326172941902.aafb123d.png" alt="image-20220326172941902"></p></blockquote><h5 id="asm字节码编程" tabindex="-1">ASM字节码编程 <a class="header-anchor" href="#asm字节码编程" aria-hidden="true">#</a></h5><blockquote><p>既然字节码文件结构如此清晰，那么我们能否通过编程，来直接创建一个字节码文件呢？如果我们可以直接编写一个字节码文件，那么我们就可以省去编译的过程。ASM（某些JDK中内置）框架正是用于支持字节码编程的框架。</p><p>比如现在我们需要创建一个普通的Main类（暂时不写任何内容）</p><p>首先我们来看看如何通过编程创建一个Main类的字节码文件：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">public class Main {</span></span>
<span class="line"><span style="color:#A6ACCD;">   public static void main(String[] args) {</span></span>
<span class="line"><span style="color:#A6ACCD;">       ClassWriter writer = new ClassWriter(ClassWriter.COMPUTE_MAXS);</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>首先需要获取<code>ClassWriter</code>对象，我们可以使用它来编辑类的字节码文件，在构造时需要传入参数：</p><ul><li>0 这种方式不会自动计算操作数栈和局部临时变量表大小，需要自己手动来指定</li><li>ClassWriter.COMPUTE_MAXS(1) 这种方式会自动计算上述操作数栈和局部临时变量表大小，但需要手动触发。</li><li>ClassWriter.COMPUTE_FRAMES(2) 这种方式不仅会计算上述操作数栈和局部临时变量表大小，而且会自动计算StackMapFrames</li></ul><p>这里我们使用<code>ClassWriter.COMPUTE_MAXS</code>即可。</p><p>接着我们首先需要指定类的一些基本信息：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">public class Main {</span></span>
<span class="line"><span style="color:#A6ACCD;">   public static void main(String[] args) {</span></span>
<span class="line"><span style="color:#A6ACCD;">       ClassWriter writer = new ClassWriter(ClassWriter.COMPUTE_MAXS);</span></span>
<span class="line"><span style="color:#A6ACCD;">       //因为这里用到的常量比较多，所以说直接一次性静态导入：import static jdk.internal.org.objectweb.asm.Opcodes.*;</span></span>
<span class="line"><span style="color:#A6ACCD;">       writer.visit(V1_8, ACC_PUBLIC,&quot;com/test/Main&quot;, null, &quot;java/lang/Object&quot;,null);</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>这里我们将字节码文件的版本设定位Java8，然后修饰符设定为<code>ACC_PUBLIC</code>代表<code>public class Main</code>，类名称注意要携带包名，标签设置为<code>null</code>，父类设定为Object类，然后没有实现任何接口，所以说最后一个参数也是<code>null</code>。</p><p>接着，一个简答的类字节码文件就创建好了，我们可以尝试将其进行保存：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">public class Main {</span></span>
<span class="line"><span style="color:#A6ACCD;">   public static void main(String[] args) {</span></span>
<span class="line"><span style="color:#A6ACCD;">       ClassWriter writer = new ClassWriter(ClassWriter.COMPUTE_MAXS);</span></span>
<span class="line"><span style="color:#A6ACCD;">       writer.visit(V1_8, ACC_PUBLIC,&quot;com/test/Main&quot;, null, &quot;java/lang/Object&quot;,null);</span></span>
<span class="line"><span style="color:#A6ACCD;">       //调用visitEnd表示结束编辑</span></span>
<span class="line"><span style="color:#A6ACCD;">       writer.visitEnd();</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">       try(FileOutputStream stream = new FileOutputStream(&quot;./Main.class&quot;)){</span></span>
<span class="line"><span style="color:#A6ACCD;">           stream.write(writer.toByteArray());  //直接通过ClassWriter将字节码文件转换为byte数组，并保存到根目录下</span></span>
<span class="line"><span style="color:#A6ACCD;">       } catch (IOException e) {</span></span>
<span class="line"><span style="color:#A6ACCD;">           e.printStackTrace();</span></span>
<span class="line"><span style="color:#A6ACCD;">       }</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>可以看到，在IDEA中反编译的结果为：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">package com.test;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">public class Main {</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>我们知道，正常的类在编译之后，如果没有手动添加构造方法，那么会自带一个无参构造，但是我们这个类中还没有，所以我们来手动添加一个无参构造方法：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">//通过visitMethod方法可以添加一个新的方法</span></span>
<span class="line"><span style="color:#A6ACCD;">writer.visitMethod(ACC_PUBLIC, &quot;&lt;init&gt;&quot;, &quot;()V&quot;, null, null);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>可以看到反编译的结果中已经存在了我们的构造方法：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">package com.test;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">public class Main {</span></span>
<span class="line"><span style="color:#A6ACCD;">   public Main() {</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>但是这样是不合法的，因为我们的构造方法还没有添加父类构造方法调用，所以说我们还需要在方法中添加父类构造方法调用指令：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">public com.test.Main();</span></span>
<span class="line"><span style="color:#A6ACCD;">   descriptor: ()V</span></span>
<span class="line"><span style="color:#A6ACCD;">   flags: ACC_PUBLIC</span></span>
<span class="line"><span style="color:#A6ACCD;">   Code:</span></span>
<span class="line"><span style="color:#A6ACCD;">     stack=1, locals=1, args_size=1</span></span>
<span class="line"><span style="color:#A6ACCD;">        0: aload_0</span></span>
<span class="line"><span style="color:#A6ACCD;">        1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span>
<span class="line"><span style="color:#A6ACCD;">        4: return</span></span>
<span class="line"><span style="color:#A6ACCD;">     LineNumberTable:</span></span>
<span class="line"><span style="color:#A6ACCD;">       line 11: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">     LocalVariableTable:</span></span>
<span class="line"><span style="color:#A6ACCD;">       Start  Length  Slot  Name   Signature</span></span>
<span class="line"><span style="color:#A6ACCD;">           0       5     0  this   Lcom/test/Main;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>我们需要对方法进行详细编辑：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//通过MethodVisitor接收返回值，进行进一步操作</span></span>
<span class="line"><span style="color:#C792EA;">MethodVisitor</span><span style="color:#A6ACCD;"> visitor </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> writer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitMethod</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ACC_PUBLIC</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;init&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">()V</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//开始编辑代码</span></span>
<span class="line"><span style="color:#A6ACCD;">visitor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitCode</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Label用于存储行号</span></span>
<span class="line"><span style="color:#C792EA;">Label</span><span style="color:#A6ACCD;"> l1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Label</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//当前代码写到哪行了，l1得到的就是多少行</span></span>
<span class="line"><span style="color:#A6ACCD;">visitor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLabel</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">l1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//添加源码行数对应表（其实可以不用）</span></span>
<span class="line"><span style="color:#A6ACCD;">visitor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLineNumber</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">11</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> l1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//注意不同类型的指令需要用不同方法来调用，因为操作数不一致，具体的注释有写</span></span>
<span class="line"><span style="color:#A6ACCD;">visitor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitVarInsn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ALOAD</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">visitor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitMethodInsn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">INVOKESPECIAL</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">java/lang/Object</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;init&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">()V</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false);</span></span>
<span class="line"><span style="color:#A6ACCD;">visitor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitInsn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">RETURN</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">Label</span><span style="color:#A6ACCD;"> l2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Label</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">visitor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLabel</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">l2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//添加本地变量表，这里加的是this关键字，但是方法中没用到，其实可以不加</span></span>
<span class="line"><span style="color:#A6ACCD;">visitor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLocalVariable</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">this</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Lcom/test/Main;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#A6ACCD;"> l1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> l2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//最后设定最大栈深度和本地变量数</span></span>
<span class="line"><span style="color:#A6ACCD;">visitor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitMaxs</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//结束编辑</span></span>
<span class="line"><span style="color:#A6ACCD;">visitor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitEnd</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre></div><p>我们可以对编写好的class文件进行反编译，看看是不是和IDEA编译之后的结果差不多：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> public com.test.Main();</span></span>
<span class="line"><span style="color:#A6ACCD;">   descriptor: ()V</span></span>
<span class="line"><span style="color:#A6ACCD;">   flags: ACC_PUBLIC</span></span>
<span class="line"><span style="color:#A6ACCD;">   Code:</span></span>
<span class="line"><span style="color:#A6ACCD;">     stack=1, locals=1, args_size=1</span></span>
<span class="line"><span style="color:#A6ACCD;">        0: aload_0</span></span>
<span class="line"><span style="color:#A6ACCD;">        1: invokespecial #8     // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span>
<span class="line"><span style="color:#A6ACCD;">        4: return</span></span>
<span class="line"><span style="color:#A6ACCD;">     LocalVariableTable:</span></span>
<span class="line"><span style="color:#A6ACCD;">       Start  Length  Slot  Name   Signature</span></span>
<span class="line"><span style="color:#A6ACCD;">           0       5     0  this   Lcom/test/Main</span></span>
<span class="line"><span style="color:#A6ACCD;">     LineNumberTable:</span></span>
<span class="line"><span style="color:#A6ACCD;">       line 11: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>可以看到和之前的基本一致了，到此为止我们构造方法就编写完成了，接着我们来写一下main方法，一会我们就可以通过main方法来运行Java程序了。比如我们要编写这样一个程序：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>看起来很简单的一个程序对吧，但是我们如果手动去组装指令，会极其麻烦！首先main方法是一个静态方法，并且方法是public权限，然后还有一个参数<code>String[] args</code>，所以说我们这里要写的内容有点小多：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//开始安排main方法</span></span>
<span class="line"><span style="color:#C792EA;">MethodVisitor</span><span style="color:#A6ACCD;"> v2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> writer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitMethod</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ACC_PUBLIC </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> ACC_STATIC</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">([Ljava/lang/String;)V</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null);</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitCode</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//记录起始行信息</span></span>
<span class="line"><span style="color:#C792EA;">Label</span><span style="color:#A6ACCD;"> l3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Label</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLabel</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">l3</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLineNumber</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">13</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> l3</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//首先是int a = 10的操作，执行指令依次为：</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// bipush 10     将10推向操作数栈顶</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// istore_1      将操作数栈顶元素保存到1号本地变量a中</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitIntInsn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">BIPUSH</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitVarInsn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ISTORE</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#C792EA;">Label</span><span style="color:#A6ACCD;"> l4 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Label</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLabel</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">l4</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//记录一下行信息</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLineNumber</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">14</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> l4</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//这里是获取System类中的out静态变量（PrintStream接口），用于打印</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitFieldInsn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">GETSTATIC</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">java/lang/System</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">out</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Ljava/io/PrintStream;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//把a的值取出来</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitVarInsn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ILOAD</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//调用接口中的抽象方法println</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitMethodInsn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">INVOKEVIRTUAL</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">java/io/PrintStream</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">println</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">(I)V</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//再次记录行信息</span></span>
<span class="line"><span style="color:#C792EA;">Label</span><span style="color:#A6ACCD;"> l6 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Label</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLabel</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">l6</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLineNumber</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> l6</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitInsn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">RETURN</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#C792EA;">Label</span><span style="color:#A6ACCD;"> l7 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Label</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLabel</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">l7</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//最后是本地变量表中的各个变量</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLocalVariable</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">args</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[Ljava/lang/String;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#A6ACCD;"> l3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> l7</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitLocalVariable</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">I</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#A6ACCD;"> l4</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> l7</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitMaxs</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//终于OK了</span></span>
<span class="line"><span style="color:#A6ACCD;">v2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">visitEnd</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre></div><p>可以看到，虽然很简单的一个程序，但是如果我们手动去编写字节码，实际上是非常麻烦的，但是要实现动态代理之类的操作（可以很方便地修改字节码创建子类），（其实Spring实现动态代理的CGLib框架底层正是调用了ASM框架来实现的）</p></blockquote><h4 id="类加载机制" tabindex="-1">类加载机制 <a class="header-anchor" href="#类加载机制" aria-hidden="true">#</a></h4><h5 id="类加载过程" tabindex="-1">类加载过程 <a class="header-anchor" href="#类加载过程" aria-hidden="true">#</a></h5><blockquote><p>一般在这些情况下，如果类没有被加载，那么会被自动加载：</p><ul><li>使用new关键字创建对象时</li><li>使用某个类的静态成员（包括方法和字段）的时候（当然，final类型的静态字段有可能在编译的时候被放到了当前类的常量池中，这种情况下是不会触发自动加载的）</li><li>使用反射对类信息进行获取的时候（之前的数据库驱动就是这样的）</li><li>加载一个类的子类时</li><li>加载接口的实现类，且接口带有<code>default</code>的方法默认实现时</li></ul></blockquote><blockquote><p>比如这种情况，那么需要用到另一个类中的成员字段，所以就必须将另一个类加载之后才能访问：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Test</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Test</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">           System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">我被初始化了！</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">都看到这里了，不给个三连+关注吗？</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>这里我们就演示一个不太好理解的情况，我们现在将静态成员变量修改为final类型的：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Test</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Test</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">           System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">我被初始化了！</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">都看到这里了，不给个三连+关注吗？</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>可以看到，在主方法中，我们使用了Test类的静态成员变量，并且此静态成员变量是一个final类型的，也就是说不可能再发生改变。那么各位觉得，Test类会像上面一样被初始化吗？</p><p>按照正常逻辑来说，既然要用到其他类中的字段，那么肯定需要加载其他类，但是这里我们结果发现，并没有对Test类进行加载，那么这是为什么呢？我们来看看Main类编译之后的字节码指令就知道了：<img src="/assets/image-20220326173153800.fef96f80.png" alt="image-20220326173153800"></p><p>很明显，这里使用的是<code>ldc</code>指令从常量池中将字符串取出并推向操作数栈顶，也就是说，在编译阶段，整个<code>Test.str</code>直接被替换为了对应的字符串（因为final不可能发生改变的，编译就会进行优化，直接来个字符串比你去加载类在获取快得多不是吗，反正结果都一样），所以说编译之后，实际上跟Test类半毛钱关系都没有了。</p><p>所以说，当你在某些情况下疑惑为什么类加载了或是没有加载时，可以从字节码指令的角度去进行分析，一般情况下，只要遇到<code>new</code>、<code>getstatic</code>、<code>putstatic</code>、<code>invokestatic</code>这些指令时，都会进行类加载，比如：<img src="/assets/image-20220326173205668.f57aaa48.png" alt="image-20220326173205668"></p><p>这里很明显，是一定会将Test类进行加载的。</p></blockquote><p>类的详细加载流程</p><blockquote><p><img src="/assets/image-20220326173258780.a9fa3edb.png" alt="image-20220326173258780"></p><p>首先类的生命周期一共有7个阶段，而首当其冲的就是加载，加载阶段需要获取此类的二进制数据流，比如我们要从硬盘中读取一个class文件，那么就可以通过文件输入流来获取类文件的<code>byte[]</code>，也可以是其他各种途径获取类文件的输入流，甚至网络传输并加载一个类也不是不可以。然后交给类加载器进行加载（类加载器可以是JDK内置的，也可以是开发者自己撸的，后面会详细介绍）类的所有信息会被加载到方法区中，并且在堆内存中会生成一个代表当前类的Class类对象（那么思考一下，同一个Class文件加载的类，是唯一存在的吗？），我们可以通过此对象以及反射机制来访问这个类的各种信息。</p><p>数组类要稍微特殊一点，通过前面的检验，我没发现数组在创建后是不会导致类加载的，数组类型本身不会通过类加载器进行加载的，不过你既然要往里面丢对象进去，那最终依然是要加载类的。</p><p>接着我们来看验证阶段，验证阶段相当于是对加载的类进行一次规范校验（因为一个类并不一定是由我们使用IDEA编译出来的，有可能是像我们之前那样直接用ASM框架写的一个），如果说类的任何地方不符合虚拟机规范，那么这个类是不会验证通过的，如果没有验证机制，那么一旦出现危害虚拟机的操作，整个程序会出现无法预料的后果。</p><p>验证阶段，首先是文件格式的验证：</p><ul><li>是否魔数为CAFEBABE开头。</li><li>主、次版本号是否可以由当前Java虚拟机运行</li><li>Class文件各个部分的完整性如何。</li></ul><p>有关类验证的详细过程，可以参考《深入理解Java虚拟机 第三版》268页。</p><p>接下来就是准备阶段了，这个阶段会为类变量分配内存，并为一些字段设定初始值，注意是系统规定的初始值，不是我们手动指定的初始值。</p><p>再往下就是解析阶段，此阶段是将常量池内的符号引用替换为直接引用的过程，也就是说，到这个时候，所有引用变量的指向都是已经切切实实地指向了内存中的对象了。</p><p>到这里，链接过程就结束了，也就是说这个时候类基本上已经完成大部分内容的初始化了。</p><p>最后就是真正的初始化阶段了，从这里开始，类中的Java代码部分，才会开始执行，还记得我们之前介绍的<code>&lt;clinit&gt;</code>方法吗，它就是在这个时候执行的，比如我们的类中存在一个静态成员变量，并且赋值为10，或是存在一个静态代码块，那么就会自动生成一个<code>&lt;clinit&gt;</code>方法来进行赋值操作，但是这个方法是自动生成的。</p><p>全部完成之后，我们的类就算是加载完成了。</p></blockquote><h5 id="类加载器" tabindex="-1">类加载器 <a class="header-anchor" href="#类加载器" aria-hidden="true">#</a></h5><blockquote><p>Java提供了类加载器，以便我们自己可以更好地控制类加载，我们可以自定义类加载器，也可以使用官方自带的类加载器去加载类。对于任意一个类，都必须由加载它的类加载器和这个类本身一起共同确立其在Java虚拟机中的唯一性。</p><p>也就是说，一个类可以由不同的类加载器加载，并且，不同的类加载器加载的出来的类，即使来自同一个Class文件，也是不同的，只有两个类来自同一个Class文件并且是由同一个类加载器加载的，才能判断为是同一个。默认情况下，所有的类都是由JDK自带的类加载器进行加载</p></blockquote><p>创建一个Test类用于测试：</p><blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">test</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Test</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>接着我们自己实现一个ClassLoader来加载我们的Test类，同时使用官方默认的类加载器来加载：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ReflectiveOperationException</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">Class</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">?</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> testClass1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Main</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getClassLoader</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">loadClass</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">com.test.Test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">CustomClassLoader</span><span style="color:#A6ACCD;"> customClassLoader </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CustomClassLoader</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">Class</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">?</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> testClass2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> customClassLoader</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadClass</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">com.test.Test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    	</span><span style="color:#676E95;font-style:italic;">//看看两个类的类加载器是不是同一个  --&gt;不是</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">testClass1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getClassLoader</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">testClass2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getClassLoader</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span></span>
<span class="line"><span style="color:#89DDFF;">     	</span><span style="color:#676E95;font-style:italic;">//看看两个类是不是长得一模一样</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">testClass1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">testClass2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">     	</span><span style="color:#676E95;font-style:italic;">//两个类是同一个吗？ --&gt;不是</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">testClass1 </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> testClass2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span></span>
<span class="line"><span style="color:#89DDFF;">     	</span><span style="color:#676E95;font-style:italic;">//能成功实现类型转换吗？  --&gt;ClassCastException</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">Test</span><span style="color:#A6ACCD;"> test </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Test</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> testClass2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">newInstance</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">CustomClassLoader</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ClassLoader</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Class</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">?</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">loadClass</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ClassNotFoundException</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">FileInputStream</span><span style="color:#A6ACCD;"> stream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FileInputStream</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./target/classes/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)+</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.class</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)){</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#C792EA;">byte</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">byte</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">stream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">available</span><span style="color:#89DDFF;">()];</span></span>
<span class="line"><span style="color:#A6ACCD;">               stream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadClass</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineClass</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> data</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">IOException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadClass</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>通过结果我们发现，即使两个类是同一个Class文件加载的，只要类加载器不同，那么这两个类就是不同的两个类。</p><p>实际上，JDK内部提供的类加载器一共有三个，比如上面我们的Main类，其实是被AppClassLoader加载的，而JDK内部的类，都是由BootstrapClassLoader加载的，这其实就是为了实现双亲委派机制而做的。</p><p><img src="/assets/image-20220326174303809.78a2c82b.png" alt="image-20220326174303809"></p></blockquote><h2 id="扩展" tabindex="-1">扩展 <a class="header-anchor" href="#扩展" aria-hidden="true">#</a></h2><h4 id="jvm常量池优化" tabindex="-1">jvm常量池优化 <a class="header-anchor" href="#jvm常量池优化" aria-hidden="true">#</a></h4><p>String类正是利用了常量池进行优化，编写测试用例：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str1 </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> str2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str2</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>得到的结果也是显而易见的，由于<code>str1</code>和<code>str2</code>是单独创建的两个对象，那么这两个对象实际上会在堆中存放，保存在不同的地址：<img src="/assets/image-20220326161127752.632a6f28.png" alt="image-20220326161127752"></p><p>当我们使用<code>==</code>判断时，得到的结果<code>false</code>，而使用<code>equals</code>时因为比较的是值，所以得到<code>true</code>。</p><p>现在我们来稍微修改一下：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str1 </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> str2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str2</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>没有使用new的形式，而是直接使用双引号创建，那么这时得到的结果就变成了两个<code>true</code>，这是为什么呢？这其实是因为我们直接使用双引号赋值，会先在常量池中查找是否存在相同的字符串，若存在，则将引用直接指向该字符串；若不存在，则在常量池中生成一个字符串，再将引用指向该字符串：<img src="/assets/image-20220326161230868.cbd9edbd.png" alt="image-20220326161230868"></p><p>实际上两次调用String类的<code>intern()</code>方法，和上面的效果差不多，也是第一次调用会将堆中字符串复制并放入常量池中，第二次通过此方法获取字符串时，会查看常量池中是否包含，如果包含那么会直接返回常量池中字符串的地址：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//不能直接写&quot;abc&quot;，双引号的形式，写了就直接在常量池里面吧abc创好了</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ab</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)+</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ab</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)+</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">intern</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> str2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">intern</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str2</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><img src="/assets/image-20220326161254257.43476872.png" alt="image-20220326161254257"></p><p>所以上述结果中得到的依然是两个<code>true</code>。在JDK1.7之后，稍微有一些区别，在调用<code>intern()</code>方法时，当常量池中没有对应的字符串时，不会再进行复制操作，而是将其直接修改为指向当前字符串堆中的的引用：<img src="/assets/image-20220326161308486.471af3a5.png" alt="image-20220326161308486"></p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  	</span><span style="color:#676E95;font-style:italic;">//不能直接写&quot;abc&quot;，双引号的形式，写了就直接在常量池里面吧abc创好了</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ab</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)+</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">intern</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> str1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ab</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)+</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> str2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ab</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)+</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str1 </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> str1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">intern</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">intern</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> str1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>所以最后我们会发现，<code>str1.intern()</code>和<code>str1</code>都是同一个对象，结果为<code>true</code>。</p><p><strong>值得注意的是，在JDK7之后，字符串常量池从方法区移动到了堆中</strong></p><h4 id="通过参数来控制堆内存" tabindex="-1">通过参数来控制堆内存 <a class="header-anchor" href="#通过参数来控制堆内存" aria-hidden="true">#</a></h4><blockquote><p><strong>堆内存参数</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">-Xms最小值 -Xmx最大值</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>比如我们现在限制堆内存为固定值1M大小，并且在抛出内存溢出异常时保存当前的内存堆转储快照：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">-Xms1m -Xmx1m -XX:+HeapDumpOnOutOfMemoryError</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><img src="/assets/image-20220326162257457.403fb011.png" alt="image-20220326162257457"></p></blockquote><h4 id="元空间" tabindex="-1">元空间 <a class="header-anchor" href="#元空间" aria-hidden="true">#</a></h4><blockquote><p>JDK8之前，Hotspot虚拟机的方法区实际上是永久代实现的。在JDK8之后，Hotspot虚拟机不再使用永久代，而是采用了全新的元空间。类的元信息被存储在元空间中。元空间没有使用堆内存，而是与堆不相连的本地内存区域。所以，理论上系统可以使用的内存有多大，元空间就有多大，所以不会出现永久代存在时的内存溢出问题。这项改造也是有必要的，永久代的调优是很困难的，虽然可以设置永久代的大小，但是很难确定一个合适的大小，因为其中的影响因素很多，比如类数量的多少、常量数量的多少等。</p><p><img src="/assets/image-20220326164605690.7f1dbbcf.png" alt="image-20220326164605690"></p><p>JDK8时直接将本地内存作为元空间（<strong>Metaspace</strong>）的区域，物理内存有多大，元空间内存就可以有多大，这样永久代的空间分配问题就讲解了，所以最终它变成了这样：<img src="/assets/image-20220326164653256.b88efe8e.png" alt="image-20220326164653256"></p></blockquote><h4 id="引用类型" tabindex="-1">引用类型 <a class="header-anchor" href="#引用类型" aria-hidden="true">#</a></h4><blockquote><p>Java中4种引用的级别由高到低依次为： <strong>强引用 &gt; 软引用 &gt; 弱引用 &gt; 虚引用</strong></p></blockquote><h5 id="强引用" tabindex="-1">强引用 <a class="header-anchor" href="#强引用" aria-hidden="true">#</a></h5><h5 id="软引用" tabindex="-1">软引用 <a class="header-anchor" href="#软引用" aria-hidden="true">#</a></h5><blockquote><p>软引用不像强引用那样不可回收，当 JVM 认为内存不足时，会去试图回收软引用指向的对象，即JVM 会确保在抛出 OutOfMemoryError 之前，清理软引用指向的对象。当然，如果内存充足，那么是不会轻易被回收的。</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">//强引用写法：Object obj = new Object();</span></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">//软引用写法：</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">SoftReference</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Object</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> reference </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">SoftReference</span><span style="color:#89DDFF;">&lt;&gt;(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Object</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">//使用get方法就可以获取到软引用所指向的对象了</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">reference</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>软引用还存在一个带队列的构造方法，软引用可以和一个引用队列（ReferenceQueue）联合使用，如果软引用所引用的对象被垃圾回收器回收，Java虚拟机就会把这个软引用加入到与之关联的引用队列中。</p></blockquote><h5 id="弱应用" tabindex="-1">弱应用 <a class="header-anchor" href="#弱应用" aria-hidden="true">#</a></h5><blockquote><p>弱引用比软引用的生命周期还要短，在进行垃圾回收时，不管当前内存空间是否充足，都会回收它的内存。</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">//弱引用写法：</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">WeakReference</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Object</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> reference </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">WeakReference</span><span style="color:#89DDFF;">&lt;&gt;(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Object</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">reference</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>使用方法和软引用是差不多的，但是如果我们在这之前手动进行一次GC：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">SoftReference</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Object</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> softReference </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">SoftReference</span><span style="color:#89DDFF;">&lt;&gt;(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Object</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">WeakReference</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Object</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> weakReference </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">WeakReference</span><span style="color:#89DDFF;">&lt;&gt;(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Object</span><span style="color:#89DDFF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">//手动GC</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">gc</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">软引用对象：</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">softReference</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">弱引用对象：</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">weakReference</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>可以看到，弱引用对象直接就被回收了，而软引用对象没有被回收。同样的，它也支持ReferenceQueue</p><p><code>WeakHashMap</code>正是一种类似于弱引用的HashMap类，如果Map中的Key没有其他引用那么此Map会自动丢弃此键值对。</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">Integer</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Integer</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">WeakHashMap</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Integer</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> weakHashMap </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">WeakHashMap</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#A6ACCD;">       weakHashMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">put</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">yyds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">weakHashMap</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">       a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">gc</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">weakHashMap</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>可以看到，当变量a的引用断开后，这时只有WeakHashMap本身对此对象存在引用，所以在GC之后，这个键值对就自动被舍弃了。所以说这玩意，就挺适合拿去做缓存的。</p></blockquote><h5 id="虚引用" tabindex="-1">虚引用 <a class="header-anchor" href="#虚引用" aria-hidden="true">#</a></h5><blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PhantomReference</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Reference</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   /**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * Returns this reference object&#39;s referent.  Because the referent of a</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * phantom reference is always inaccessible, this method always returns</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * &lt;code&gt;null&lt;/code&gt;.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * </span><span style="color:#F78C6C;font-style:italic;">@return</span><span style="color:#676E95;font-style:italic;">  &lt;code&gt;null&lt;/code&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    */</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">T</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   /**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * Creates a new phantom reference that refers to the given object and</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * is registered with the given queue.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * &lt;p&gt; It is possible to create a phantom reference with a &lt;tt&gt;null&lt;/tt&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * queue, but such a reference is completely useless: Its &lt;tt&gt;get&lt;/tt&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * method will always return null and, since it does not have a queue, it</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * will never be enqueued.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">referent</span><span style="color:#676E95;font-style:italic;"> the object the new phantom reference will refer to</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">q</span><span style="color:#676E95;font-style:italic;"> the queue with which the reference is to be registered,</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    *          or &lt;tt&gt;null&lt;/tt&gt; if registration is not required</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    */</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PhantomReference</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">T</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">referent</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ReferenceQueue</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">?</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">super</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">q</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       super</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">referent</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> q</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>无论调用多少次<code>get()</code>方法得到的永远都是<code>null</code>，因为虚引用本身就不算是个引用，相当于这个对象不存在任何引用，并且只能使用带队列的构造方法，以便对象被回收时接到通知。</p></blockquote><h4 id="jdk8-升级g1" tabindex="-1">JDK8 升级G1 <a class="header-anchor" href="#jdk8-升级g1" aria-hidden="true">#</a></h4><blockquote><p><code>jdk8需要设置参数指定:</code></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">// 最大堆内存24G 使用G1GC，设置预期停顿时间是95ms</span></span>
<span class="line"><span style="color:#A6ACCD;">-Xms24g -Xmx24g -XX:+UseG1GC -XX:MaxGCPauseMillis=95</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>使用G1的主要原因是：G1的Stop The World(STW)更可控，G1在停顿时间上添加了预测机制，用户可以指定期望停顿时间</p><p>G1的常用参数配置：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-XX:G1HeapRegionSize=n</td><td>设置Region大小，并非最终值</td></tr><tr><td>-XX:MaxGCPauseMillis</td><td>设置G1收集过程目标时间，默认值200ms，不是硬性条件</td></tr><tr><td>-XX:G1NewSizePercent</td><td>新生代最小值，默认值5%</td></tr><tr><td>-XX:G1MaxNewSizePercent</td><td>新生代最大值，默认值60%</td></tr><tr><td>-XX:ParallelGCThreads</td><td>STW期间，并行GC线程数</td></tr><tr><td>-XX:ConcGCThreads=n</td><td>并发标记阶段，并行执行的线程数</td></tr><tr><td>-XX:InitiatingHeapOccupancyPercent</td><td>设置触发标记周期的 Java 堆占用率阈值。默认值是45%。</td></tr></tbody></table><p><code>查看jdk8默认的垃圾收集器</code></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">java -XX:+PrintCommandLineFlags -version</span></span>
<span class="line"><span style="color:#A6ACCD;">   -XX:InitialHeapSize=264885120 </span></span>
<span class="line"><span style="color:#A6ACCD;">   -XX:MaxHeapSize=4238161920 </span></span>
<span class="line"><span style="color:#A6ACCD;">   -XX:+PrintCommandLineFlags </span></span>
<span class="line"><span style="color:#A6ACCD;">   -XX:+UseCompressedClassPointers </span></span>
<span class="line"><span style="color:#A6ACCD;">   -XX:+UseCompressedOops </span></span>
<span class="line"><span style="color:#A6ACCD;">   -XX:-UseLargePagesIndividualAllocation </span></span>
<span class="line"><span style="color:#A6ACCD;">   -XX:+UseParallelGC</span></span>
<span class="line"><span style="color:#A6ACCD;">java version &quot;1.8.0_281&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Java(TM) SE Runtime Environment (build 1.8.0_281-b09)</span></span>
<span class="line"><span style="color:#A6ACCD;">Java HotSpot(TM) 64-Bit Server VM (build 25.281-b09, mixed mode)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></blockquote><h4 id="双亲委派模型的意义" tabindex="-1">双亲委派模型的意义 <a class="header-anchor" href="#双亲委派模型的意义" aria-hidden="true">#</a></h4><blockquote><p>反射就是把Java类中的各个成分映射成一个个的Java对象。即在运行状态中，对于任意一个类，都能够知道这个类所有的属性和方法，对于任意一个对象，都能调用它的任意一个方法和属性。这种动态获取信息及动态调用对象方法的功能叫Java的反射机制。</p><p>**思考：**那如果我们手动创建一个与JDK包名一样，同时类名也保持一致，那么JVM会加载这个类吗？</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">java</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">//JDK提供的String类也是</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">双亲委派模型</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>我们发现，会出现以下报错：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">错误</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#A6ACCD;"> 在类 java</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lang</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">String 中找不到 main 方法</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 请将 main 方法定义为</span><span style="color:#89DDFF;font-style:italic;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>但是我们明明在自己写的String类中定义了main方法啊，为什么会找不到此方法呢？实际上这是ClassLoader的<code>双亲委派机制</code>在保护Java程序的正常运行：</p><p>实际上我们的类最开始是由BootstarpClassLoader进行加载，BootstarpClassLoader用于加载JDK提供的类，而我们自己编写的类实际上是AppClassLoader，只有BootstarpClassLoader都没有加载的类，才会让AppClassLoader来加载，因此我们自己编写的同名包同名类不会被加载，而实际要去启动的是真正的String类，也就自然找不到<code>main</code>方法了！</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Main</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getClassLoader</span><span style="color:#89DDFF;">());</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">//查看当前类的类加载器 --&gt;AppClassLoader</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Main</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getClassLoader</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getParent</span><span style="color:#89DDFF;">());</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">//父加载器 --&gt;ExtClassLoader</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Main</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getClassLoader</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getParent</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getParent</span><span style="color:#89DDFF;">());</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">//根加载器 --&gt; BootstarpClassLoader</span></span>
<span class="line"><span style="color:#89DDFF;">       </span><span style="color:#676E95;font-style:italic;">// String类的加载器 --&gt;BootstarpClassLoader是C++编写的，我们在Java中是获取不到的。</span></span>
<span class="line"><span style="color:#A6ACCD;">       System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getClassLoader</span><span style="color:#89DDFF;">());</span><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></blockquote><h4 id="怎么选择垃圾收集器" tabindex="-1">怎么选择垃圾收集器 <a class="header-anchor" href="#怎么选择垃圾收集器" aria-hidden="true">#</a></h4><blockquote><ol><li>优先调整堆的大小让服务器自己来选择</li><li>如果内存小于100m，使用串行收集器</li><li>如果是单核，并且没有停顿时间的要求，串行或JVM自己选择</li><li>如果允许停顿时间超过1秒，选择并行或者JVM自己选</li><li>如果响应时间最重要，并且不能超过1秒，使用并发收</li></ol><p>官方推荐<strong>G1</strong>，性能高。</p></blockquote><h4 id="jvm实战" tabindex="-1">JVM实战 <a class="header-anchor" href="#jvm实战" aria-hidden="true">#</a></h4><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">OOMTest</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Object</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> list </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ArrayList</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Object</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> list </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ArrayList</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> j </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(true)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            list</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">User</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">++,</span><span style="color:#A6ACCD;"> UUID</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">randomUUID</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">toString</span><span style="color:#89DDFF;">()));</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">User</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">j</span><span style="color:#89DDFF;">--,</span><span style="color:#A6ACCD;"> UUID</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">randomUUID</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">toString</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>VM参数设置</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">-Xms10M -Xmx10M </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCDetails </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+HeapDumpOnOutOfMemoryError </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:HeapDumpPath=D:\jvm.dump </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>打印GC日志</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">-Xloggc:./gc-%t.log </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCDetails </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCDateStamps </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCTimeStamps </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCCause</span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+UseGCLogFileRotation </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:NumberOfGCLogFiles=10 </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:GCLogFileSize=100M</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>启动应用程序</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">java</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-jar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-Xloggc:./gc-%t.log</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-XX:+PrintGCDetails</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-XX:+PrintGCDateStamps</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-XX:+PrintGCTimeStamps</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-XX:+PrintGCCause</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-XX:+UseGCLogFileRotation</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-XX:NumberOfGCLogFiles=10</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-XX:GCLogFileSize=100M</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">xxx.jar</span></span>
<span class="line"></span></code></pre></div></blockquote><h5 id="gc调优步骤" tabindex="-1">GC调优步骤 <a class="header-anchor" href="#gc调优步骤" aria-hidden="true">#</a></h5><blockquote><p>1、打印GC日志 -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -Xloggc:./gc.log Tomcat则直接加在JAVA_OPTS变量里</p></blockquote><blockquote><p>2、分析日志得到关键性指标</p></blockquote><blockquote><p>3、分析GC原因，调优JVM参数</p></blockquote><h5 id="cms" tabindex="-1">cms <a class="header-anchor" href="#cms" aria-hidden="true">#</a></h5><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">-Xloggc:d:/gc-cms-%t.log </span></span>
<span class="line"><span style="color:#A6ACCD;">-Xms50M -Xmx50M </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:MetaspaceSize=256M </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:MaxMetaspaceSize=256M </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCDetails </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCDateStamps</span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCTimeStamps </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCCause </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+UseGCLogFileRotation </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:NumberOfGCLogFiles=10 </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:GCLogFileSize=100M</span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+UseParNewGC </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+UseConcMarkSweepGC</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h5 id="g1" tabindex="-1">G1 <a class="header-anchor" href="#g1" aria-hidden="true">#</a></h5><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">-Xloggc:d:/gc-g1-%t.log </span></span>
<span class="line"><span style="color:#A6ACCD;">-Xms50M -Xmx50M </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:MetaspaceSize=256M </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:MaxMetaspaceSize=256M </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCDetails </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCDateStamps</span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCTimeStamps </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+PrintGCCause </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+UseGCLogFileRotation </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:NumberOfGCLogFiles=10 </span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:GCLogFileSize=100M</span></span>
<span class="line"><span style="color:#A6ACCD;">-XX:+UseG1GC</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-cfb513e0 data-v-21f75714><!----><div class="prev-next" data-v-21f75714><div class="pager" data-v-21f75714><a class="pager-link prev" href="/study/java/JUC.html" data-v-21f75714><span class="desc" data-v-21f75714>Previous page</span><span class="title" data-v-21f75714>Java多线程</span></a></div><div class="has-prev pager" data-v-21f75714><a class="pager-link next" href="/study/algorithm/%E6%95%B0%E7%BB%84%E4%B8%8E%E9%93%BE%E8%A1%A8.html" data-v-21f75714><span class="desc" data-v-21f75714>Next page</span><span class="title" data-v-21f75714>数组与链表</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"book0002_05演进-分布式服务_22-微服务架构：微服务化后系统架构要如何改造？.md\":\"a49d9fb7\",\"book0002_01基础_04-系统设计目标（二）：系统怎样做到高可用？.md\":\"01241333\",\"book0002_05演进-分布式服务_29-service mesh：如何屏蔽服务化系统的服务治理细节？.md\":\"f8d79986\",\"book0002_02演进-数据库_10-发号器：如何保证分库分表后id的全局唯一性？.md\":\"61b6e855\",\"book0002_01基础_01-高并发系统：它的通用设计方法是什么？.md\":\"cd6383ce\",\"book0002_06演进-维护_30-给系统加上眼睛：服务端监控要怎么做？.md\":\"f4cea8ac\",\"book0002_07实战_38-计数系统设计（二）：50万qps下如何设计未读数系统？.md\":\"e53a1291\",\"book0002_04演进-消息队列_20-当问到项目经历时，面试官究竟想要了解什么？.md\":\"4ca2ec3b\",\"catalogue_index.md\":\"16a31a06\",\"second_standard_p3c.md\":\"8fca9310\",\"study_bigdata_index.md\":\"57f86f5d\",\"book0002_05演进-分布式服务_21-系统架构：每秒1万次请求的系统要做服务化拆分吗？.md\":\"0183563e\",\"second_standard_sonarlint.md\":\"a14dabca\",\"second_server_linux.md\":\"e6476a7c\",\"book0002_02演进-数据库_07-池化技术：如何减少频繁创建数据库连接的性能损耗？.md\":\"51257ed7\",\"book0002_00开篇_00-开篇词-为什么你要学习高并发系统设计？.md\":\"ac815b6f\",\"book0002_02演进-数据库_11-nosql：在高并发场景下，数据库和nosql如何做到互补？.md\":\"1be9ab3d\",\"book0002_03演进-缓存_13-缓存的使用姿势（一）：如何选择缓存的读写策略？.md\":\"c0dadcb8\",\"book0002_03演进-缓存_12-缓存：数据库成为瓶颈后，动态数据的查询要如何加速？.md\":\"854f8e33\",\"book0002_06演进-维护_32-压力测试：怎样设计全链路压力测试平台？.md\":\"ba495994\",\"study_database_clickhouse.md\":\"b336ba9c\",\"design_高可用架构设计.md\":\"a2e8a8e3\",\"design_秒杀系统架构设计.md\":\"c7162221\",\"book0002_01基础_03-系统设计目标（一）：如何提升系统性能？.md\":\"f21717d6\",\"study_database_fastdfs.md\":\"c63b4674\",\"book0002_04演进-消息队列_17-消息队列：秒杀如何处理每秒上万的下单请求？.md\":\"24f96a32\",\"book0002_05演进-分布式服务_25-分布式trace：横跨几十个分布式组件的慢请求要如何排查？.md\":\"4f73935b\",\"study_algorithm_队列与栈.md\":\"e3696f54\",\"book0002_03演进-缓存_15-缓存的使用姿势（三）：缓存穿透了怎么办？.md\":\"9437b19d\",\"study_algorithm_动态规划.md\":\"0f8d7184\",\"book0002_04演进-消息队列_18-消息投递：如何保证消息仅仅被消费一次？.md\":\"62691ff9\",\"book0002_04演进-消息队列_19-消息队列如何降低消息队列系统中消息的延迟？.md\":\"e4983700\",\"book0002_01基础_02-架构分层：我们为什么一定要这么做？.md\":\"262ab58b\",\"second_cloud_alibaba_zookeeper.md\":\"d755f86d\",\"book0002_02演进-数据库_08-数据库优化方案（一）：查询请求增加时，如何做主从分离？.md\":\"d7f2261b\",\"study_container_k8s.md\":\"0dc5b079\",\"second_cloud_spring_openfeign.md\":\"76319fb4\",\"book0002_06演进-维护_35-流量控制：高并发系统中我们如何操纵流量？.md\":\"db4760eb\",\"second_cloud_spring_skywalking.md\":\"ba8996f6\",\"study_algorithm_二叉树.md\":\"74171616\",\"second_flow_compileflow.md\":\"0154d8c1\",\"study_database_hbase.md\":\"adf62f45\",\"second_mq_kafka.md\":\"101e5bd5\",\"design_index.md\":\"f85f8519\",\"second_cloud_spring_springcloudgateway.md\":\"57e72a03\",\"study_database_mongodb.md\":\"5bcdb4f2\",\"study_database_memcached.md\":\"d225d529\",\"second_cloud_spring_springcloudstream.md\":\"11b89ff2\",\"study_middleware_server.md\":\"627edb6e\",\"second_test_charles.md\":\"e60a2eed\",\"book0002_03演进-缓存_加餐-数据的签约应该如何做？.md\":\"f4acf726\",\"second_cloud_alibaba_nacos.md\":\"e47ef239\",\"book0002_05演进-分布式服务_26-负载均衡：怎样提升系统的横向扩展能力？.md\":\"d58eaf46\",\"book0002_08结束_结束语-学不可以已.md\":\"b0482458\",\"second_mq_rabbitmq.md\":\"687486b8\",\"second_test_apachejmeter.md\":\"42202fa3\",\"book0002_06演进-维护_34-降级熔断：如何屏蔽非核心系统故障的影响？.md\":\"3d8ce79c\",\"book0002_07实战_40-信息流设计（二）：通用信息流系统的拉模式要如何做？.md\":\"e3987c21\",\"book0002_03演进-缓存_14-缓存的使用姿势（二）：缓存如何做到高可用？.md\":\"9582697d\",\"study_orm_mybatisplus.md\":\"111c317d\",\"book0002_07实战_37-计数系统设计（一）：面对海量数据的计数器要如何做？.md\":\"3c1b4261\",\"study_util_asynctool.md\":\"73f2f8c7\",\"study_util_mapstruct.md\":\"538d4e27\",\"updated_index.md\":\"978c3c3f\",\"second_test_jmh.md\":\"e294de45\",\"design_分布式id方案.md\":\"095c1928\",\"study_test_index.md\":\"f7cec1c6\",\"second_server_tomcat.md\":\"27625349\",\"study_database_postgresql.md\":\"68f919c2\",\"study_middleware_satoken.md\":\"a9c45141\",\"study_springcloud_index.md\":\"bf8fc74d\",\"book0002_06演进-维护_33-配置管理：成千上万的配置项要如何管理？.md\":\"697a3943\",\"design_分布式事务方案.md\":\"97c8720e\",\"study_java_java8新特性.md\":\"d1383fb9\",\"design_接口性能优化方案.md\":\"3a8f98ac\",\"second_flow_liteflow.md\":\"970d2464\",\"study_middleware_flow.md\":\"1ee7e386\",\"study_util_feilong.md\":\"9b737c08\",\"book0002_05演进-分布式服务_28-多机房部署：跨地域的分布式系统如何做？.md\":\"f02dff08\",\"second_cloud_alibaba_sentinel.md\":\"34203a78\",\"design_架构图设计方案.md\":\"71949d89\",\"study_orm_mybatis.md\":\"509cd9a4\",\"book0002_06演进-维护_31-应用性能管理：用户的使用体验应该如何监控？.md\":\"b9430a58\",\"study_alibaba_index.md\":\"2c7f002e\",\"second_test_mockito.md\":\"bbf922d4\",\"book0002_05演进-分布式服务_24-注册中心：分布式系统如何寻址？.md\":\"8ca6a0da\",\"book0002_05演进-分布式服务_27-api网关：系统的门面要如何做呢？.md\":\"510f4107\",\"book0002_05演进-分布式服务_23-rpc框架：10万qps下如何实现毫秒级的服务调用？.md\":\"f841844f\",\"book0002_01基础_05-系统设计目标（三）：如何让系统易于扩展？.md\":\"88268f05\",\"study_middleware_mq.md\":\"9c708785\",\"second_standard_checkstyle.md\":\"cda64564\",\"study_middleware_canal.md\":\"428aab8f\",\"navigation_voice.md\":\"48122795\",\"second_test_testablemock.md\":\"0c7e557f\",\"second_server_openresty.md\":\"44e797bb\",\"second_cloud_alibaba_dubbo.md\":\"eeb37350\",\"study_algorithm_数组与链表.md\":\"0ca9bebe\",\"design_多级缓存架构设计.md\":\"fc4d26f2\",\"study_database_elasticsearch.md\":\"bb63a185\",\"design_电商业务架构设计.md\":\"92d6a56d\",\"second_server_nginx.md\":\"9d072cd0\",\"book0002_02演进-数据库_09-数据库优化方案（二）：写入数据量增加时，如何实现分库分表？.md\":\"66090a93\",\"study_util_guava.md\":\"8580e86d\",\"second_cloud_alibaba_seata.md\":\"92f1824b\",\"index.md\":\"1291ea6e\",\"design_订单系统架构设计.md\":\"37b0f88b\",\"design_灰度方案设计.md\":\"c91f4aa1\",\"study_database_oracle.md\":\"17373dd1\",\"book0002_07实战_39-信息流设计（一）：通用信息流系统的推模式要如何做？.md\":\"af697f3b\",\"second_cloud_spring_hystrix.md\":\"bf0eff90\",\"design_日志系统架构设计.md\":\"030a9987\",\"book0002_03演进-缓存_16-cdn：静态资源如何加速？.md\":\"7cdc9e9f\",\"study_util_tlog.md\":\"ca483b6f\",\"second_standard_ide.md\":\"ec3905f7\",\"study_algorithm_数据结构设计.md\":\"56c5bcd6\",\"study_orm_jpa.md\":\"993f9fde\",\"study_java_java响应式编程.md\":\"33639322\",\"study_container_docker.md\":\"d2e5e652\",\"study_util_forest.md\":\"ec13a034\",\"study_orm_druid.md\":\"48687664\",\"design_单点登录架构设计.md\":\"b291e73d\",\"book0003_如何设计一个秒杀系统-许令波.md\":\"c75fe870\",\"study_util_hutool.md\":\"6e4f4b51\",\"book0001_线上问题详解.md\":\"4320f2d7\",\"study_util_swagger.md\":\"84148050\",\"study_util_vavr.md\":\"228bb0f3\",\"study_database_mysql.md\":\"ddd18639\",\"study_database_mysqlextend.md\":\"0cccd61d\",\"study_framework_springboot.md\":\"eaa0f737\",\"study_util_easyexcel.md\":\"c8db27bb\",\"second_server_netty.md\":\"03eefb15\",\"study_database_redis.md\":\"4c50ae59\",\"study_middleware_shardingjdbc.md\":\"e20f6b0d\",\"second_mq_rocketmq.md\":\"a7bf28ef\",\"study_java_jvm.md\":\"c51125c8\",\"study_java_java基础.md\":\"75382df2\",\"study_framework_spring.md\":\"578e894a\",\"study_java_juc.md\":\"82b29de8\"}")</script>
    <script type="module" async src="/assets/app.467f35a9.js"></script>
    
  </body>
</html>